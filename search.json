[
  {
    "objectID": "providers/aws_bedrock.html",
    "href": "providers/aws_bedrock.html",
    "title": "AWS Bedrock Models",
    "section": "",
    "text": "See: AWS Bedrock source docs\n\n# üöß Under Construction üèóÔ∏è",
    "crumbs": [
      "üöÄ Quickstart",
      "üîå Model Providers",
      "AWS Bedrock Models"
    ]
  },
  {
    "objectID": "providers/ollama.html",
    "href": "providers/ollama.html",
    "title": "Ollama Models",
    "section": "",
    "text": "See: Ollama source docs\n\n# üöß Under Construction üèóÔ∏è",
    "crumbs": [
      "üöÄ Quickstart",
      "üîå Model Providers",
      "Ollama Models"
    ]
  },
  {
    "objectID": "installing.html",
    "href": "installing.html",
    "title": "üì° Install Lasagna AI",
    "section": "",
    "text": "WarningDon‚Äôt Install the WRONG library\n\n\n\nThe correct PyPI library is lasagna-ai (not lasagna).\n\n\npip install lasagna-ai     # &lt;-- üéâüéâüéâ\n\n\nYou‚Äôll likely want some of the optional dependencies (depending on which providers you plan to use):\npip install lasagna-ai[openai,anthropic,bedrock]",
    "crumbs": [
      "üöÄ Quickstart",
      "üì° Install Lasagna AI"
    ]
  },
  {
    "objectID": "installing.html#installing",
    "href": "installing.html#installing",
    "title": "üì° Install Lasagna AI",
    "section": "",
    "text": "WarningDon‚Äôt Install the WRONG library\n\n\n\nThe correct PyPI library is lasagna-ai (not lasagna).\n\n\npip install lasagna-ai     # &lt;-- üéâüéâüéâ\n\n\nYou‚Äôll likely want some of the optional dependencies (depending on which providers you plan to use):\npip install lasagna-ai[openai,anthropic,bedrock]",
    "crumbs": [
      "üöÄ Quickstart",
      "üì° Install Lasagna AI"
    ]
  },
  {
    "objectID": "installing.html#check-your-version",
    "href": "installing.html#check-your-version",
    "title": "üì° Install Lasagna AI",
    "section": "Check your version!",
    "text": "Check your version!\n\nimport lasagna\n\nprint(lasagna.__version__)\n\n‚ö†Ô∏è Make sure you have the most recent version. ‚ö†Ô∏è\nSee all versions on PyPI:",
    "crumbs": [
      "üöÄ Quickstart",
      "üì° Install Lasagna AI"
    ]
  },
  {
    "objectID": "agent_features/recursive_agent.html",
    "href": "agent_features/recursive_agent.html",
    "title": "Recursive Agent",
    "section": "",
    "text": "Ever wanted a recursive agent? Now you can have one! ü§Ø\n# This page will use the following imports:\n\nfrom __future__ import annotations\n\nfrom lasagna import Model, EventCallback, AgentRun, Message\nfrom lasagna import (\n    override_system_prompt,\n    extraction,\n    chained_runs,\n    to_str,\n    make_model_binder,\n    noop_callback,\n)\nfrom lasagna import known_models\n\nfrom pydantic import BaseModel, Field\n\nimport io\nimport os\nimport sys\nimport copy\nimport asyncio\nfrom contextlib import redirect_stdout\n\nfrom dotenv import load_dotenv\nWe need to set up our ‚Äúbinder‚Äù (see the quickstart guide for what this is).\nload_dotenv()\n\nif os.environ.get('OLLAMA'):\n    model_name = os.environ['OLLAMA']\n    print('Using Ollama model:', model_name)\n    BINDER = make_model_binder('ollama', model_name)\n\nelif os.environ.get('ANTHROPIC_API_KEY'):\n    print('Using Anthropic')\n    BINDER = known_models.anthropic_claude_haiku_4_5_binder\n\nelif os.environ.get('OPENAI_API_KEY'):\n    print('Using OpenAI')\n    BINDER = known_models.openai_gpt_5_mini_binder\n\nelse:\n    assert False, \"Neither OLLAMA nor ANTHROPIC_API_KEY nor OPENAI_API_KEY is set! We need at least one to do this demo.\"\n\nUsing Anthropic\nEnsure the recursion doesn‚Äôt go forever!\nMAX_DEPTH = int(os.environ.get('MAX_DEPTH', '3'))",
    "crumbs": [
      "üöÄ Quickstart",
      "‚öôÔ∏è Agent Features",
      "Recursive Agent"
    ]
  },
  {
    "objectID": "agent_features/recursive_agent.html#example-recursive-plot-outline-builder",
    "href": "agent_features/recursive_agent.html#example-recursive-plot-outline-builder",
    "title": "Recursive Agent",
    "section": "Example: Recursive Plot Outline Builder",
    "text": "Example: Recursive Plot Outline Builder\nLet‚Äôs write a recursive agent that builds a plot outline. It will recursively add detail to the plot outline until it is sufficiently detailed (or until the MAX_DEPTH is reached).\n\nSystem Prompt\n\nSYSTEM_PROMPT = \"\"\"\nYou expand the plot outline to add detail, nuance, and time-tested\nstory-telling techniques.\n\nYou will be given a plot outline, and you will be instructed to expand\n**one** part of it. Your output should be the expansion of that **single**\npart.\n\"\"\".strip()\n\n\n\nData Models\nThe following data model will be used to extract (i.e.¬†generate structured output) plot revisions at each step in the recursive process:\n\nclass PlotRevision(BaseModel):\n    thoughts: str = Field(description=\"your free-form thoughts about the entire plot and about the part you are asked to expand, and then brainstorm ideas for how it can be modified or expanded\")\n    revised_plot_point: str = Field(description=\"output a revised plot point that will **replace** the plot point you were instructed to expand; you may, if you choose, output the **same** plot point verbatim if it does not need modification\")\n    has_sufficient_detail: bool = Field(description=\"`true` if this plot point has sufficient detail to easily write the script from it; else `false` if this plot point needs to have further expounding; if `false`, then fill in `sub_plot_points` with the sub-plot points to add detail\")\n    sub_plot_points: list[str] = Field(description=\"output a chronological list of sub-plot points; these are details about the `revised_plot_point` to add detail, nuance, and time-tested story-telling techniques; output an empty list if `has_sufficient_detail` is `true`\")\n\nThe following data model will be used to hold the full plot (capturing everything generated up to this point). Note: It does not need prompts since it will not be used for extraction by AI models.\n\nclass FullPlotPoint(BaseModel):\n    plot_point: str\n    sub_plot_points: list[FullPlotPoint]\n\n\n\nThe Recursive Agent\nNow, the recursive agent! See comments below for details, but the high level is that it:\n\ngenerates a prompt to extract a PlotRevision,\npatches the current FullPlotPoint using that PlotRevision, and\nfor each generated subplot, recurses to continue filling in lower-level detail.\n\n\n@BINDER\nasync def plot_builder(\n    model: Model,\n    event_callback: EventCallback,\n    prev_runs: list[AgentRun],\n) -&gt; AgentRun:\n    # Capture all the generated output:\n    output_runs: list[AgentRun] = []\n\n    # Build the extraction input:\n    assert len(prev_runs) == 2\n    plot_agentrun = prev_runs[0]\n    assert plot_agentrun['type'] == 'extraction'\n    full_plot = copy.deepcopy(plot_agentrun['result'])   # COPYING IS IMPORTANT HERE! WE MUST BE A PURE FUNCTION!\n    assert isinstance(full_plot, FullPlotPoint)\n    revise_indices_agentrun = prev_runs[1]\n    assert revise_indices_agentrun['type'] == 'extraction'\n    revise_indices = revise_indices_agentrun['result']\n    assert isinstance(revise_indices, list)\n    specific_point = full_plot\n    for index in revise_indices:\n        assert isinstance(index, int)\n        specific_point = specific_point.sub_plot_points[index]\n    messages_orig: list[Message] = [\n        {\n            'role': 'human',\n            'text': f'Given this plot outline: {full_plot}',\n        },\n        {\n            'role': 'human',\n            'text': f'Revise this plot point: {specific_point.plot_point}',\n        },\n    ]\n    messages_new_system_prompt = override_system_prompt(messages_orig, SYSTEM_PROMPT)\n\n    # Extract (generate with structured output) the plot revision at this level:\n    extraction_message, extraction_result = await model.extract(\n        event_callback,\n        messages = messages_new_system_prompt,\n        extraction_type = PlotRevision,\n    )\n    extraction_run = extraction('extraction_run', [extraction_message], extraction_result)\n    output_runs.append(extraction_run)\n\n    # Patch the plot:\n    specific_point.plot_point = extraction_result.revised_plot_point\n    specific_point.sub_plot_points = [\n        FullPlotPoint(\n            plot_point = point,\n            sub_plot_points = [],\n        )\n        for point in extraction_result.sub_plot_points\n    ]\n\n    # Can we afford to go deeper?\n    can_go_deeper = len(revise_indices) + 1 &lt; MAX_DEPTH\n\n    # Recursively expand all the sub-plot points:\n    if can_go_deeper and not extraction_result.has_sufficient_detail:\n        subplot_runs: list[AgentRun] = []\n        for i, _ in enumerate(extraction_result.sub_plot_points):\n            subplot_input: list[AgentRun] = [\n                extraction('plot_agentrun', [], full_plot),\n                extraction('revise_indices_agentrun', [], [*revise_indices, i]),\n            ]\n            subplot_run = await plot_builder(event_callback, subplot_input)\n            subplot_runs.append(subplot_run)\n        subplot_chain = chained_runs('subplot_chain', subplot_runs)\n        output_runs.append(subplot_chain)\n\n    # Return everything that we generated:\n    return chained_runs('plot_builder', output_runs)\n\n\n\n\n\n\n\nNoteA note about the INPUT to the agent\n\n\n\nRecall, we designed Lasagna so that all agents have the same signature; specifically, a core input to all Lasagna agents is prev_runs: list[AgentRun]. It represents the contextual input to the agent, and it often becomes (through whatever transformation the agent wishes to do) the prompt to the model.\nDespite all agents having the same input signature, some agents will expect certain contents inside prev_runs. The agent above is one of those agents. You cannot call plot_builder with anything you want; rather, it expects its prev_runs input to be precisely what it needs (details not important - see the code for those details if you want).\nSo, therefore, the caller of plot_builder has to follow the contract it expects! Complicated agents might have to be this way, where they aren‚Äôt as ‚Äúswappable‚Äù as we‚Äôd like them to be, but alas. In this case, to make the recursion work, we have to assume strong structure in the input.\nNote within a note: Be pure! Lasagna agents, being functional-inspired, should be pure. Note how the agent above makes a copy; if it didn‚Äôt, it wouldn‚Äôt be pure, and the recursion logic would fail.\n\n\n\n\n\n\n\n\nNoteA note about the OUTPUT of the agent\n\n\n\nRecall, the output of all agents in Lasagna is a single AgentRun object.\nThis output should represent as closely as possible the content that the agent generated. The output should be quite literal: ‚Äúthe agent generated this stuff in this order‚Äù. If you want to do some transformations of this (as we will do below), do it outside the agent (as we will do below).\nKeeping the output AgentRun literal is important so that:\n\nmultiple downstream transformations can be done (maybe even some you haven‚Äôt thought of yet!),\nyou can track and debug agent output in its unaltered form, and\nso that you can chain/stack/parallelize agents and the outputs will form together nicely (indeed, that is the reason AgentRun is the way that it is).\n\n\n\n\n\nUtility Functions\nHere is a utility function to print the resulting plot outline using the final AgentRun returned by the agent above.\n\ndef print_plot(run: AgentRun, depth: int = 0) -&gt; int:\n    \"\"\"\n    Prints the full plot outline, and returns the number of _extractions_ that were generated along the way. \n    \"\"\"\n    assert run['agent'] == 'plot_builder'\n    assert run['type'] == 'chain'\n    extraction_run = run['runs'][0]\n    assert extraction_run['agent'] == 'extraction_run'\n    assert extraction_run['type'] == 'extraction'\n    plot_revision = extraction_run['result']\n    assert isinstance(plot_revision, PlotRevision)\n    print(f\"{' ' * 2*depth}- {plot_revision.revised_plot_point}\")\n    sum_ = 1  # count _this_ run\n    if len(run['runs']) &gt; 1:\n        subplot_chain = run['runs'][1]\n        assert subplot_chain['agent'] == 'subplot_chain'\n        assert subplot_chain['type'] == 'chain'\n        for subplot_run in subplot_chain['runs']:\n            sum_ += print_plot(subplot_run, depth = depth + 1)\n    else:\n        for leaf_plot_point in plot_revision.sub_plot_points:\n            print(f\"{' ' * 2*(depth+1)}- {leaf_plot_point}\")\n    return sum_\n\n\n\nDriver\nHere is a driver function to make use of the plot_builder.\nIt:\n\nkicks off the first call to the plot_builder,\nwrites a file (for inspection outside this notebook) of the full AgentRun that is returned by the agent,\nwrites a file of the full plot outline generated by the agent, and\nprints the full plot outline here in the notebook as well.\n\n\nasync def run_plot_builder(prompt: str) -&gt; None:\n    plot_agentrun = extraction('plot_agentrun', [], FullPlotPoint(\n        plot_point = prompt,\n        sub_plot_points = [],\n    ))\n    revise_indices_agentrun = extraction('revise_indices_agentrun', [], [])\n\n    run = await plot_builder(noop_callback, [plot_agentrun, revise_indices_agentrun])\n\n    with open('plot_builder_output.json', 'wt') as f:\n        f.write(to_str(run))\n\n    with redirect_stdout(io.StringIO()) as f:\n        total_extractions = print_plot(run)\n    plot_outline = f.getvalue()\n\n    print(plot_outline)\n    print(f\"Did a total of {total_extractions} extractions.\")\n\n    with open('plot_builder_output.txt', 'wt') as f:\n        f.write(plot_outline)\n\n\n\nExample Execution\n\nPROMPT = \"\"\"\nA short film about a motocross race.\n\"\"\".strip()\n\nawait run_plot_builder(PROMPT)  # type: ignore[top-level-await]\n\n- A determined rider fights to redeem themselves at a prestigious motocross championship after a career-defining setback, navigating personal demons, fierce competition, and their fraught relationship with a rival they once mentored.\n  - At the regional qualifier‚Äîbilled as the final pathway to the nationals‚Äîthe aging protagonist makes an uncharacteristic tactical error during a crucial heat, losing control on a line they've executed flawlessly for decades. They crash hard in front of the crowds and sponsors, then remount to finish out of the points entirely. Shaken and visibly injured, they face their lead sponsor in the pits afterward, who delivers an ultimatum: place in the top three at the nationals in three weeks, or the sponsorship deal‚Äîtheir primary source of income‚Äîis terminated.\n    - In the immediate aftermath of the crash, the protagonist clings to a fortress of rationalizations, fixating on external culprits‚Äîa setup issue they swear was present all week, a slick patch of track they blame for the loss of traction, even the humidity or tire warmup‚Äîanything to avoid the creeping suspicion that their own reflexes, not the bike or conditions, betrayed them. They become almost manic in this denial, rehashing technical details with their crew and demanding changes that they believe will prevent a \"repeat\" of this \"anomaly,\" while refusing to slow down or adjust their riding line to account for the reality they won't acknowledge.\n      - In the pits immediately after the crash, before fully processing what happened, the protagonist snaps at their crew, demanding to know what they changed on the bike setup, insisting something felt 'off' in ways they can't quite articulate‚Äîbut they're certain it wasn't rider error.\n      - They seek out other riders or mechanics to validate their theory, fishing for confirmation that the track conditions were treacherous that day, or that 'everyone' was struggling with grip‚Äîanything to normalize their crash as environmental rather than personal.\n      - Alone that night, the protagonist mentally reframes the crash as a 'one-off,' similar to a crash they had five years ago (which they recovered from instantly), convincing themselves that champions have bad days and this proves nothing about their capability.\n      - They convince their crew to make aggressive setup changes for the nationals, framing it as 'optimization' rather than compensation for diminished reflexes; they insist on new tires, a rebalanced chassis, or a different suspension geometry‚Äîtreating the bike as the variable that needs fixing, not themselves.\n      - In a conversation with someone close to them, when gently confronted about the crash, the protagonist becomes defensive and dismissive, interpreting concern as doubt and shutting down the conversation before it can go deeper, silently vowing to prove the doubters wrong through sheer willpower and performance.\n    - In the garage that evening, as the veteran mechanic inspects the bike for damage and prepares for the nationals, they make a seemingly casual observation about the bike's setup and handling. They gently suggest that everything checked out fine‚Äîthe suspension, tire pressure, geometry‚Äîleading them to wonder aloud if perhaps the rider's timing was off on that line, or if they came in a fraction late, which could explain the loss of grip. The mechanic delivers this with genuine care, not accusation, but it plants a destabilizing seed of doubt: the crash wasn't about the machine or the conditions, but about the rider themselves. The protagonist's immediate reaction is defensive‚Äîthey over-explain, make excuses, or fall silent in a way that reveals how deeply the suggestion has landed. After the mechanic leaves, the protagonist sits with this implication, desperately trying to convince themselves it's not true while fearing it might be.\n    - Alone in their motorhome late at night, bruised and wrapped in ice packs from the crash, the protagonist scrolls through footage on their phone‚Äîstarting with highlight reels of their greatest victories, then cutting to today's race footage. They watch their younger self attack a signature rhythm section with liquid grace, body position perfect, throttle modulation confident; then they watch today's version hesitate into the same section, body stiff, line fractured. They rewind and rewatch, searching for an explanation‚Äîa gust of wind, a bike malfunction, anything‚Äîbut with each replay, the truth becomes harder to deny: their reflexes are slower, their instincts less sharp, and no amount of grit can compensate for a body that no longer responds the way it once did.\n      - The protagonist finds a specific video‚Äîa legendary performance from a decade ago where they won their most iconic championship‚Äîand watches it in full, allowing themselves to feel the pride and invincibility of that moment before forcing themselves to play today's footage alongside it.\n      - They notice small, devastating details: how their younger self's weight transitions are imperceptible while today's are obvious and clumsy; how the younger version reads the track's micro-variations while today's version seems to be always one decision behind.\n      - They attempt to rationalize the differences‚Äî'I'm injured from the crash,' 'The bike setup is wrong,' 'The track was dusty'‚Äîbut each excuse crumbles as they rewatch, because they can see these aren't equipment or condition issues, they're rider issues.\n      - Physical exhaustion and pain from the crash intensify the emotional weight; their body aches in sync with their spiraling doubts, making it impossible to separate physical decline from psychological despair.\n      - They fast-forward through social media clips, catching fragments of commentary from broadcast analysts or spectators‚Äî'Did you see him hesitate?' 'He used to flow through there like water'‚Äîand realize the decline isn't just something they feel internally; it's visible to everyone.\n      - In a moment of desperate hope, they wonder if they're just having an off day, that tomorrow they'll feel sharper, faster, younger‚Äîbut this hope feels increasingly hollow as the evidence accumulates.\n      - They set the phone down and sit in the dark, physically exhausted but mentally wired, facing the question they've been avoiding: Is this the body telling them what their pride won't admit?\n    - That evening, the protagonist scrolls through social media in their motorhome, unable to stop themselves despite knowing better. Early comments are harsh but expected‚Äî\"over the hill,\" \"should retire with dignity.\" But one video clip catches their eye: footage of their crash set to mocking music, already viewed thousands of times. The comments range from cruel to clinical. Then, while grabbing food at the motorhome park, they overhear two younger spectators at the concession stand openly discussing whether the protagonist should even be allowed to compete‚Äîone suggests age should have a hard limit in professional motocross. The protagonist tries to move past them, but one rider they used to know casually‚Äîsomeone they respected years ago‚Äîcatches their eye and gives a sympathetic but unmistakable look of pity. That night cuts deeper than the strangers' mockery: pity means people who know the sport believe the judgment is fair. The protagonist returns to their motorhome and resets their phone, finding a cryptic post from their rival's Instagram account‚Äîa training montage set to aggressive music, captioned \"The future is now\"‚Äîand realizes that even their prot√©g√© is using their age as a narrative weapon.\n    - The sponsor meeting takes place in a sleek corporate office far from the track‚Äîa cold, glass-and-steel environment that makes the protagonist feel out of place in their racing gear. The sponsor, flanked by a contracts manager, opens by acknowledging their years together but immediately pivots to \"restructuring priorities\" and \"tightening ROI margins.\" They slide a contract across the table showing a performance clause: top-three finish at nationals, or the sponsorship terminates immediately with no buyout. The protagonist hears phrases like \"aging demographic\" and \"market refresh\" while the sponsor avoids direct eye contact. A small moment breaks the protagonist: when they glance at their own photo on the sponsor's wall‚Äîa glossy, triumphant image from five years ago‚Äîand notice the sponsor hasn't bothered to look at it during the entire meeting. Outside the office afterward, the protagonist realizes the sponsor never once referred to them by name, only as \"the rider\" or \"this partnership.\" The meeting feels less like a negotiation and more like a courtesy notification before an execution.\n    - After the sponsorship ultimatum, the protagonist is forced to confront a brutal financial reality: without this deal, they'll lose access to top-tier equipment, premium coaching, and travel funds, reducing them from a professional competitor to someone who can barely afford entry fees‚Äîmaking them question whether they can realistically compete at the nationals, let alone win.\n      - The protagonist sits down with their finances for the first time in months and realizes that almost everything‚Äîbike maintenance, new parts, coaching fees, travel to regional events, even their motorhome payments‚Äîhas been covered by the sponsorship; their personal savings are negligible and their credit cards are carrying high balances from years of lifestyle creep.\n      - They reach out to their equipment supplier to get a ballpark quote for essential race-ready parts without the sponsor's bulk discount, only to be quoted a price that represents months of their personal income, forcing them to confront the gap between what they need and what they can actually afford.\n      - A conversation with their crew member or mechanic turns tense when the protagonist realizes their loyal team has been underpaid or working for reduced rates because the sponsor's money was supposed to cover payroll; without it, they'll have to release key staff members who've been with them for years.\n      - The protagonist drives past their motorhome‚Äîthe only real estate they own‚Äîand calculates how much longer they can afford to keep it parked at the facility; the thought of living in a van and traveling to races, like they did as a hungry young competitor, triggers both desperation and a buried shame about how far they've fallen.\n      - In a quiet moment, they research entry fees, travel costs, and pit pass expenses for the nationals, adding up the total with their phone calculator, and the final number makes their stomach drop‚Äîit's more than they've saved in the last year.\n      - They receive a call or message from a younger, less established rider asking for advice, and the protagonist has to consciously remind themselves that they no longer have the resources to mentor or help anyone else; this small loss of generosity reinforces how their circumstances have narrowed.\n      - Late at night, the protagonist lies awake and allows themselves to imagine the alternative: walking away, finding a desk job or coaching position, living a 'normal' life‚Äîand realizes that no part of them can accept that future; the race isn't just about money or sponsors anymore, it's about refusing to become ordinary.\n    - That night, unable to sleep in the motorhome, the protagonist's mind spirals through the crash obsessively‚Äîreplaying it frame by frame from different angles, searching for the moment they lost control. Physical pain keeps them awake as their body reminds them of their age; they drift between moments of doubt about whether this is indeed the beginning of the end, and fragile, desperate hope that they still have one last championship run left in them.\n      - The protagonist's battered body won't let them rest‚Äîbruised ribs ache with each breath, and when they try to shift position on the narrow motorhome bunk, a sharp pain in their shoulder (old injury aggravated in the crash) shoots through them, forcing them upright. They check the mirror: swollen jaw, road rash on their neck. Recovery from falls used to take days; they wonder how long this will take, and if their body can even handle three more weeks of training.\n      - Unable to distract themselves, they pull up the race footage on their phone or laptop‚Äîthe same 30-second clip of the crash, watched dozens of times. Each viewing, they freeze-frame at a different moment: their body position into the turn, the exact angle of the bike, the instant their line goes wrong. They search for proof it was the bike, the track, anything‚Äîbut deep down they see the hesitation, the fractional delay that cost them.\n      - Desperate for escape from their own thoughts, they reach for something‚Äîa half-empty bottle of bourbon left over from weeks ago, prescription pain medication, maybe just scrolling through their phone. They catch themselves and stop, recognizing the coping mechanism, knowing it won't help but feeling the temptation anyway. The fact that they're even considering it frightens them more than the crash did.\n      - Around 3 AM, in the suffocating darkness of the motorhome, they confront the unspoken question: Who are they if they're not a motocross champion? Without racing, without sponsors, without the roar of crowds‚Äîdo they have anything left? The fear isn't just about losing income; it's about losing their identity.\n      - They find themselves scrolling through old photos or videos on their phone‚Äîthemselves as a young, hungry rookie, podiums they've stood on, the exhilaration frozen in still images. In one, they're hoisting the national championship trophy, arms raised, pure joy on their face. They wonder if they'll ever feel that again, or if they're about to spend the rest of their life as 'that rider who had it all and let it slip away.'\n      - In the darkest hour before dawn, a thought breaks through the despair‚Äîa memory of a come-from-behind win in their early career, a moment when everyone had counted them out. They'd found something then. Maybe, just maybe, they could find it again. It's fragile, barely a whisper, but it's enough to break the paralysis, and as exhaustion finally pulls them under just before sunrise, they don't wake in panic‚Äîthey wake with a question instead of a verdict: What if I'm not done yet?\n  - A respected promoter who once worked with the protagonist extends an unexpected invitation to compete in the national championship‚Äîthe last held under the classic format before major rule changes‚Äîbut only if they can navigate qualifying rounds under tight timelines and prove their fitness to insurance assessors still wary of their age and injury history.\n    - A former associate‚Äîa respected promoter or team owner with deep ties to the protagonist's past‚Äîtracks them down days after the regional loss, deliberately choosing a moment of private vulnerability to present a high-stakes opportunity: a wild card entry to the national championship, contingent on passing qualifiers. The associate reveals they've been watching the protagonist's decline and saw something in that catastrophic loss that the protagonist missed: not failure, but the ghost of their old fearlessness breaking through. They make it clear the offer is selfish‚Äîthey need a specific narrative for the championship's final year under the classic format‚Äîbut genuine: they believe the protagonist can still be great.\n      - The associate attends or learns of the regional loss shortly after it happens, and unlike others who see only an aging rider's embarrassment, they notice something: a moment mid-race where the protagonist's old instincts flickered before doubt reasserted itself.\n      - Days later, they track the protagonist down at a private, quiet moment‚Äîperhaps at home nursing injuries, or at a dive bar away from the motocross scene‚Äîdeliberately avoiding the protagonist's defensive public persona.\n      - The associate reminds the protagonist of their shared history: a specific race, a mentorship, or a decision the protagonist made that changed the associate's career or perspective, establishing why this person's judgment carries weight.\n      - Rather than offering hollow inspiration, the associate is frank about their own motivations: they're curating a historic final season before rule changes, and they need a redemption story‚Äîa veteran defying age and skepticism‚Äîto market the championship. They need the protagonist, but the protagonist also needs them.\n      - The associate reveals they've kept tabs on the protagonist over the years, noticing the slow retreat from confidence into caution, and they argue that the regional crash was the protagonist finally showing up to the track like they used to‚Äîwilling to risk everything. They frame the wild card as a chance to finish that thought.\n      - The protagonist resists, citing practical reasons: age, injuries, career inertia‚Äîbut the associate counters each objection not with motivational platitudes but with specific logistics: sponsors exist for this very comeback narrative, insurers have cleared older riders before, and the championship's qualifying window aligns with the protagonist's current sponsor ultimatum.\n      - The associate extends the offer verbally but makes the protagonist sit with it for 48 hours before formally committing, forcing them to confront whether this is real desire or just escape from shame‚Äîand giving the associate plausible deniability if the protagonist refuses.\n      - When the protagonist finally responds (either yes or with conditions), the associate's relief reveals their genuine belief: this isn't a business transaction to them alone. They've bet something of themselves on the protagonist's untapped potential.\n    - The protagonist initially resists the wild card invitation, their pride recoiling from charity and their self-doubt insisting they're finished, until a crushing conversation about their sponsor ultimatum reveals an unexpected alignment: the championship window falls precisely within their final deadline to prove their worth‚Äîmaking this not just an opportunity, but their literal last chance before falling into obscurity or forced retirement.\n      - The protagonist initially dismisses the wild card offer with bitterness, interpreting the outreach as pity rather than genuine belief in their potential, and refuses contact with the former associate for several days.\n      - Mounting financial pressure arrives when the protagonist's primary sponsor issues a formal ultimatum: deliver podium finishes at upcoming events within the next eight weeks, or lose their contract and income‚Äîa deadline the protagonist initially keeps private, fearing it signals the end.\n      - The protagonist confides in someone close to them (family member, longtime friend, or mechanic) about the sponsor situation, initially framing it as \"time to hang it up,\" but this conversation forces them to articulate what losing the sport would actually mean beyond lost income.\n      - The former associate makes a second outreach, more direct, revealing they've done their homework: they mention specific dates and deadlines, subtly confirming they know the protagonist's situation is dire‚Äîa moment that shifts the dynamic from charity to strategic necessity.\n      - The protagonist reluctantly reviews the championship schedule and realizes the national championship dates align perfectly within the sponsor ultimatum window‚Äîfinishing strong there could save their contract, while missing it guarantees failure.\n      - A moment of brutal honesty: the protagonist sits alone and confronts the choice between the comfort of a dignified fade-out versus the terrifying vulnerability of one final, all-in attempt where failure is public and devastating.\n      - The protagonist makes the decision to accept, but frames it internally not as redemption or proving themselves, but as a simple fact: it's the only rational play left; they're already drowning, so they might as well swing for the fences.\n    - The protagonist must undergo a grueling series of fitness evaluations and medical clearances orchestrated by insurance assessors skeptical of aging riders, forcing them to confront not only their physical limitations but also systemic prejudice, while navigating tight deadlines and the looming threat that a single failed test could permanently disqualify them from the championship.\n      - The protagonist receives the official list of required evaluations: cardiovascular stress tests, bone density scans, reaction time assessments, and psychological evaluations‚Äîeach designed with age thresholds that effectively bias against older competitors.\n      - During the first cardiovascular test, the protagonist struggles more than expected, triggering anxiety that this entire comeback might be physically impossible; however, they push through and barely pass, learning they'll need to improve stamina dramatically before the next phase.\n      - A sympathetic team physician (perhaps the promoter's contact or someone with a stake in the protagonist's success) privately warns them that the insurance company is looking for any excuse to deny clearance, and hints at which tests are most likely to disqualify them.\n      - The protagonist discovers an old injury‚Äîa previously undiagnosed hairline fracture or chronic issue‚Äîshows up on imaging, forcing an emergency consultation with an orthopedic specialist who must sign off or condemn their candidacy.\n      - The psychological evaluation becomes unexpectedly confrontational when the evaluator questions whether the protagonist is mentally fit to compete, probing for signs of desperation, death wish, or cognitive decline; the protagonist must defend not just their mental state but their very right to attempt this comeback.\n      - As deadlines approach and tests pile up, the protagonist is forced to choose: spend more time recovering and risk missing the championship window, or rush through remaining evaluations and risk failing from overexertion.\n      - A final conversation with the insurance company's representative‚Äîsomeone rigid and bureaucratic‚Äîforces the protagonist to advocate fiercely for themselves, arguing that their experience and caution actually make them safer than reckless younger riders.\n      - With days to spare before the championship, the protagonist receives conditional clearance with restrictions (reduced practice time, mandatory pit stops, medical monitoring), a pyrrhic victory that feels like both validation and humiliation.\n    - The protagonist unexpectedly discovers their prot√©g√© is already registered as a top seed‚Äîa realization that transforms the championship from a personal redemption arc into a direct confrontation, forcing them to confront not only the aging body before them but the ghost of a mentorship gone wrong.\n      - While reviewing the official entry list on the championship website late one night, the protagonist sees their former prot√©g√©'s name prominently seeded in the top three‚Äîa moment of cold recognition that hits like a second loss.\n      - The protagonist learns the prot√©g√© has had a dominant season on the professional circuit, accumulating sponsorships and accolades that dwarf what the protagonist once achieved, amplifying the question: 'What can I possibly prove now?'\n      - The protagonist grapples with conflicting emotions: pride in what they taught this rider, resentment that those teachings are being used against them, and deep uncertainty about whether confronting this prot√©g√© is redemption or just ego.\n      - The protagonist reaches out through back channels to determine if the prot√©g√© knows about their wild card entry, discovering the information hasn't been shared yet‚Äîcreating a strategic advantage but also raising the stakes of their eventual reunion on the track.\n      - Rather than backing down, the protagonist feels a strange pull toward this matchup: facing the prot√©g√© feels less like a sporting competition and more like a reckoning with their own failure to maintain their edge and legacy.\n      - The protagonist considers withdrawing‚Äîcompeting is one thing, but deliberately stepping into the ring with someone who represents their obsolescence feels like self-sabotage until a mentor figure or close confidant reframes it as the only way to truly move forward.\n    - The protagonist accepts the invitation in a moment of defiant clarity, but realizes immediately that this commitment means burning their escape hatches: rejecting the comfortable team owner job they'd been quietly offered, cashing out savings set aside for post-racing stability, and publicly declaring their entry‚Äîmaking it impossible to quietly retreat if things go wrong. They confront what \"one last race\" truly means: not just a final competition, but a final act of self-definition before accepting that their body and the sport have moved on.\n      - The protagonist is offered a lucrative but emotionally hollow position as a team consultant or trainer at a respected stable‚Äîsteady income, security, a dignified off-ramp from competition‚Äîbut accepting it would feel like surrendering their identity to the injury and age they've been fighting.\n      - In a private moment, the protagonist makes an active choice to turn down the job, explicitly telling the team owner they're going to race one more time, knowing this decision cuts off a safety net.\n      - They begin liquidating savings and gear to fund the championship push themselves, a series of small financial commitments that accumulate into a point of no return.\n      - The protagonist confides in someone close to them (family member or longtime friend/mechanic) about the full weight of what they're risking‚Äînot just money and reputation, but their physical health and the peace they might have found in retirement.\n      - News leaks or the protagonist deliberately announces their wild card entry on social media or through media outlets, making it public and irrevocable; backing out now would mean public humiliation on top of private failure.\n      - The protagonist visits their old track or a sacred personal space, and in a moment of solitude, they acknowledge they're not just fighting for a championship‚Äîthey're fighting to prove they haven't become irrelevant, that they still matter.\n      - They prepare their bike and gear with ritualistic care, treating each maintenance task as a physical commitment, each dollar spent as a vote for believing in themselves one more time.\n    - News of the protagonist's wild card entry spreads through the motocross community, generating conflicting narratives‚Äîsome celebrating an inspiring last stand, others dismissing it as a desperate gamble by an aging rider‚Äîwhile rivals and their teams actively analyze vulnerabilities and devise tactical strategies to exploit the protagonist's physical limitations and psychological fragility.\n      - Word spreads quickly through the tight-knit motocross circuit: social media explodes with mixed commentary, longtime fans posting nostalgic highlights of the protagonist's glory days alongside skeptical takes about age and injury risks, while younger riders express admiration for the comeback attempt.\n      - A prominent motocross journalist or media personality covers the story, framing it as either an inspiring redemption arc or a reckless bid by someone past their prime‚Äîthe framing depends on which narrative feeds better engagement, putting the protagonist at the mercy of public perception they cannot control.\n      - The protagonist's rival team holds a tactical meeting where engineers and the prot√©g√© analyze footage of the protagonist's recent performances, identifying specific weaknesses: slower acceleration out of certain turns, favoring one side due to old injuries, signs of fatigue in later heats‚Äîthey develop targeted strategies to expose these vulnerabilities during the championship.\n      - Rival riders and their sponsors begin trash-talking publicly or in interviews, with some dismissing the protagonist as a nostalgia act, others warning the field that a cornered veteran is dangerous, creating psychological noise designed to unsettle the protagonist and prove they don't belong.\n      - The protagonist overhears or accidentally discovers evidence of the rival teams' strategic planning‚Äîperhaps through a leaked email, a conversation overheard at a sponsor event, or seeing footage of their own weakness being discussed‚Äîforcing them to confront that they're not just competing; they're being hunted because they're perceived as vulnerable.\n      - Conversely, a smaller contingent of respected figures in the community‚Äîolder retired riders, loyal mechanics, grassroots fans‚Äîpublicly voice support, but their voices are often drowned out by the larger cynical narrative, leaving the protagonist uncertain which version of their comeback story is winning the cultural battle.\n      - The protagonist must decide whether to engage with or ignore the narrative forming around them, and their choice‚Äîwhether to embrace the underdog role, defend themselves publicly, or focus purely on training‚Äîreveals character and sets the tone for how they'll handle the mounting psychological pressure heading into qualifying rounds.\n  - Through vivid flashbacks, we see the protagonist taking a raw, undisciplined younger rider under their wing‚Äîteaching them precision lines, mental toughness, and the philosophy that champions race with respect for the sport and their competitors. A crucial moment shows the protagonist recognizing the prot√©g√©'s exceptional raw talent during a breakthrough practice session, offering genuine mentorship and life advice. However, subtle tensions hint that the prot√©g√©'s hunger is starting to transform into a desire to surpass rather than learn from their mentor.\n    - The protagonist watches the young rider execute an impossibly smooth line through a technical section, only to lose control entirely moments later in a reckless overtake attempt, crashing hard into the barriers. Seeing the rider immediately remount‚Äîbruised and bleeding but determined‚Äîthe protagonist recognizes their younger self: raw talent coupled with dangerous hunger and self-destructive pride. After initial hesitation, they decide to mentor the rider, believing they can channel this hunger into greatness before it destroys them, while secretly hoping to pass on the wisdom they wish someone had given them.\n      - The protagonist is at the track for their own training session when they notice the young rider‚Äîsomeone with no major sponsorships, desperate energy, and a hunger that's almost predatory. They watch from the sidelines, initially dismissive.\n      - In one lap, the young rider threads through a series of turns with unexpected precision and grace, revealing legitimate talent beneath the recklessness‚Äîa moment that catches the protagonist's attention and makes them lean forward.\n      - On the very next lap, seeking to prove something or impress observers, the young rider attempts an aggressive pass in an inappropriate place, misjudges the entry, and crashes violently into the barrier, sliding hard across the track.\n      - The protagonist's breath catches‚Äînot from shock at the crash, but from recognition. The young rider's desperation, that need to prove themselves regardless of consequence, mirrors the protagonist's own younger self before experience taught them (painfully) about limits.\n      - The young rider immediately remounts their bike and limps back to the pits, refusing help, blood dripping from their nose, eyes blazing with frustration and determination rather than fear. They're already replaying the crash, analyzing what went wrong tactically.\n      - The protagonist finds themselves walking toward the young rider in the pits, uncertain why they're doing it. A conversation ensues where the rider reveals their story: no family money, no connections, this is their last real shot before age makes it impossible.\n      - The protagonist recognizes something else: the rider's raw desperation mirrors their own current state‚Äîboth are fighting against inevitable decline or obscurity, both are willing to risk everything. In offering to mentor, the protagonist is partly trying to save a version of themselves.\n      - The protagonist makes a quiet offer: 'You've got talent. But that death wish you're carrying will kill you before anyone else can beat you. Train with me for the next two weeks. If you're serious, I can open some doors.'\n      - The young rider's response‚Äîskeptical but hungry‚Äîsuggests they see this as transactional, a means to an end, not a genuine mentorship. But the protagonist, still caught in their own need for purpose, chooses not to see this warning sign.\n    - In an isolated desert practice track at dawn, the protagonist teaches the prot√©g√© \"the Switchback\"‚Äîa deceptively technical turn that demands reading the terrain's subtle grade change and timing the throttle with millimeter precision. The mentor demonstrates it first: smooth, controlled, almost meditative. When the prot√©g√© attacks it aggressively, sliding wide and nearly clipping the berm, the mentor stops them cold. Over multiple takes, the mentor breaks down the psychology: \"You're trying to force it. The track tells you when to turn in. Listen to it.\" A moment of frustration flickers across the prot√©g√©'s face‚Äîthey're used to winning through raw speed, not patience. But when they finally nail it, executing the line with unexpected elegance, the mentor's genuine praise and a nod of deep respect create a real human connection. The mentor reveals a small scar on their arm: \"Tried to muscle that turn for five years before I learned to dance with it instead.\" It's vulnerability wrapped in wisdom, and the prot√©g√© receives it as truth‚Äîthough later, in the rival arc, this same scar will become a point of leverage, a physical reminder of the mentor's \"mistakes.\"\n    - During a private training session, the protagonist notices the prot√©g√© taking increasingly aggressive, unnecessary risks‚Äîtrying to match the mentor's pace through sheer force rather than technique. When the prot√©g√© nearly crashes attempting a dangerous pass during a practice run, the protagonist pulls them aside and shares their hard-won philosophy: \"The track humbles everyone. The riders who last are the ones who respect it, not the ones trying to prove something.\" The prot√©g√© nods and seems to accept this wisdom, but when the mentor asks what the lesson is, the prot√©g√© reframes it as \"respect the track\" rather than \"respect the sport\"‚Äîa subtle linguistic shift that hints they're already reinterpreting the mentor's advice through a competitive lens. Later, the protagonist overhears the prot√©g√© telling another rider, \"My mentor says I need to race smarter, not harder. I guess that's because they can't race hard anymore,\" a comment that stings precisely because it reveals the prot√©g√© has already begun viewing age‚Äîand mortality‚Äîas a weakness to exploit.\n    - During an early morning session at an abandoned track, the prot√©g√© executes the protagonist's signature technique‚Äîa precise, high-speed line through a treacherous double-apex turn‚Äîflawlessly for the first time. The protagonist witnesses it from the pit, their composed demeanor cracking into genuine amazement; they immediately rush out, physically embrace the prot√©g√© as they dismount, and share an unguarded moment of pride. Yet as the prot√©g√© removes their helmet, the protagonist catches a flash of something unexpected in their eyes‚Äînot just joy, but a hunger to claim mastery of this technique as their own‚Äîa moment that plants a seed of doubt the protagonist quickly dismisses.\n      - The protagonist deliberately arranges an early morning training session before anyone else arrives at the track, wanting isolation and quiet focus‚Äîshowing how much they've invested in this prot√©g√©'s growth.\n      - The prot√©g√© has attempted this double-apex turn dozens of times over weeks, each attempt ending in either a near-crash or a compromised exit; the tension builds as they've grown increasingly frustrated and doubting themselves.\n      - The protagonist positions themselves at a specific vantage point in the pits, their body language tense‚Äîthey're invested but trying to appear casual, revealing how much they care about this moment.\n      - On the approach, the protagonist can see the prot√©g√©'s hesitation‚Äîa micro-pause before committing to the line‚Äîbut nods encouragement, a silent signal that says 'trust it.'\n      - The prot√©g√© enters the turn with perfect throttle control and lean angle; the bike holds the line through both apexes with precision that mirrors the protagonist's own technique, creating an almost spiritual moment of transmission.\n      - As the prot√©g√© exits cleanly and accelerates away, the protagonist's carefully maintained composure shatters‚Äîthey visibly react with shock and pride, pulling off their sunglasses.\n      - The prot√©g√© completes the lap and pulls into the pit area; before they've fully stopped, the protagonist is there, physically steadying the bike and pulling the rider off‚Äîan uncharacteristic display of emotion and physical affection.\n      - In the embrace, the protagonist whispers something like, 'That's it. That's exactly it. You own that now'‚Äîwords meant to be empowering but that carry a seed of future contention.\n      - As the prot√©g√©'s face emerges from the helmet, the protagonist glimpses something in their expression‚Äîa triumphant gleam that goes beyond joy‚Äîa flash suggesting the prot√©g√© views this mastery as a conquest or milestone toward surpassing their teacher.\n      - The protagonist's smile falters imperceptibly as they consciously register this look; they rationalize it as intensity or competitive fire (healthy traits in a rider), but subconsciously file it away as a warning sign.\n      - The two sit together afterward, the protagonist explaining the philosophy behind the technique‚Äîhow respecting the bike and the track is what makes it work‚Äîwhile the prot√©g√© listens intently but asks strategic questions about how to execute it even faster, subtly shifting the framing from learning to racing.\n      - The scene ends with the protagonist placing a hand on the prot√©g√©'s shoulder, believing they've successfully imparted not just technique but wisdom; the prot√©g√©, meanwhile, is already mentally deconstructing how to beat this move in the future.\n    - The protagonist leverages their fading sponsorship connections to secure the prot√©g√©'s entry into a regional qualifying event, incurring a personal debt that will later complicate their own championship bid. The prot√©g√© wins convincingly, but in the victory circle, they accept congratulations from sponsors without mentioning their mentor‚Äîa moment that stings more than the protagonist expects. Later, when the protagonist tries to debrief the prot√©g√© about race strategy and what they learned, the young rider deflects with casual arrogance (\"I just did what I always do\"), suggesting they've already begun to internalize the victory as proof of their own innate superiority rather than the culmination of mentorship.\n      - The protagonist makes a phone call to an old contact at a major sponsorship agency‚Äîsomeone they haven't spoken to in years and to whom they still owe a personal favor. After some awkward negotiation, they successfully secure an entry slot for the prot√©g√©, but in doing so, they commit to promoting that sponsor's products for free at upcoming events, a concession that later costs them financially during their own championship preparation.\n      - The regional event unfolds with the prot√©g√© executing the techniques and strategies the protagonist taught them; from the stands, the protagonist watches with genuine pride, seeing their legacy in action.\n      - The prot√©g√© crosses the finish line first, a convincing victory with no close competition; the win is decisive and undeniable, proof that the mentorship worked.\n      - In the victory circle, photographers and reporters from the sponsorship company swarm the prot√©g√©, celebrating their breakthrough. The prot√©g√© accepts their praise with enthusiasm but makes no mention of their mentor‚Äînot out of malice, but out of unconscious ego, as if their own talent and instinct alone were responsible for the win.\n      - The protagonist watches from the sidelines, their hand raised in an attempt to wave or acknowledge the moment, but the prot√©g√© doesn't see them. A camera operator positions themselves between the protagonist and the victory celebration, and the protagonist instinctively steps back, suddenly aware they're now on the periphery of this success.\n      - After the event, the protagonist finds the prot√©g√© and tries to have a post-race debrief, asking questions about how the prot√©g√© felt executing the turn they'd practiced, or how they managed pressure on the final lap. The prot√©g√© responds with short, dismissive answers: 'felt natural,' 'just rode,' 'instinct took over.'\n      - The prot√©g√© casually says something like, 'I think I'm ready for the next level. I don't need to overthink it anymore‚ÄîI just need to trust myself.' The comment is meant innocently, but it implicitly suggests they've outgrown the need for their mentor's guidance.\n      - The protagonist feels a chill of recognition: this is the moment the dynamic shifts. The prot√©g√© has begun to see their mentor's teachings not as ongoing wisdom but as training wheels they've now outgrown.\n    - The prot√©g√©'s questions subtly shift from seeking understanding to seeking advantage; they begin studying the mentor's vulnerabilities, asking pointed questions about past injuries, race strategy, and sponsorship relationships‚Äîno longer asking \"how do I improve?\" but \"what do you know that I don't?\" The mentor senses the change in energy but chalks it up to the prot√©g√©'s growing confidence, initially taking pride in their assertiveness before realizing something darker has taken root in their dynamic.\n      - The prot√©g√©'s initial questions about technique gradually become less frequent; instead, they begin asking the mentor about their injury history, recovery methods, and psychological strategies for handling pressure‚Äîframed casually, but with a probing intensity.\n      - During a training session, the prot√©g√© asks the mentor to demonstrate their signature technique on a section of track the prot√©g√© has been struggling with; when the mentor complies, the prot√©g√© films it on their phone, saying casually 'for analysis later'‚Äîa small moment that makes the mentor slightly uncomfortable but seems innocent enough.\n      - The prot√©g√© shifts to asking about the mentor's sponsorship deals and how they secured funding early in their career; the questions feel less about advice and more about understanding the business side, as if mapping out a competitive advantage.\n      - A revealing conversation: the prot√©g√© asks the mentor about their greatest fear or weakness on the track, framed as 'so I know what to watch out for in myself,' but the mentor notices the prot√©g√© is genuinely cataloging their limitations rather than seeking guidance.\n      - The mentor begins to sense something is off and tries to return to deeper mentorship conversations about philosophy or respect for the sport, but the prot√©g√© deflects, increasingly focused on extracting practical competitive information rather than absorbing wisdom.\n      - A moment where the prot√©g√© casually mentions studying footage of one of the mentor's past losses in detail, analyzing 'where they went wrong'‚Äîsaid with a smile, but it stings the mentor because it reveals the prot√©g√© is now viewing them as a competitor to study and defeat rather than a guide to emulate.\n      - The mentor confides this unease to someone else (a friend, family member, or fellow rider), expressing confusion: 'They're asking all the right questions, but something feels off‚Äîlike they're preparing for battle instead of learning.'\n    - The protagonist, after watching the prot√©g√© push themselves to a dangerous limit during a late-night practice session, sits them down in a quiet moment and confesses about a specific past injury‚Äîperhaps a chronic weakness or a previous failure caused by overconfidence‚Äîthat still haunts their racing decisions. The mentor shares not just the injury, but the psychological toll: fear, self-doubt, the shame of having to sit out races. The prot√©g√© listens with apparent empathy, asking follow-up questions that seem supportive but are strategically designed to map their mentor's vulnerabilities and limitations. The mentor, grateful for the apparent understanding and connection, interprets the prot√©g√©'s focused questions as genuine interest in learning from their mistakes. But in a revealing moment‚Äîa slight hardening of the prot√©g√©'s eyes, a mental shift from listener to evaluator‚Äîwe see them mentally file away this information as tactical advantage: a weakness to exploit when they eventually compete directly.\n      - The prot√©g√© executes a reckless maneuver in practice that nearly causes a crash, and the protagonist intervenes, genuinely concerned rather than critical, which prompts the late-night conversation.\n      - The protagonist chooses a secluded location (perhaps the garage or empty track at dusk) to share the story, establishing this as an intimate, unguarded moment.\n      - The mentor reveals a specific injury‚Äîperhaps a lingering shoulder injury that affects certain types of turns, or a mental block around a particular race condition‚Äîthat forced them to adapt their technique years ago.\n      - The mentor admits they still sometimes take conservative lines because of fear, and that this caution has likely cost them races; this admission comes with visible emotion, showing real vulnerability.\n      - The prot√©g√© asks seemingly innocent follow-up questions ('Does it still limit you on the sharp left turns?' or 'Does fatigue make it worse?') that are actually reconnaissance, identifying exploitable weaknesses.\n      - A physical tell reveals the prot√©g√©'s shift: they lean back from their mentor, their expression transitions from concerned to calculating, suggesting the moment they stop seeing their mentor as a guide and start seeing them as an opponent.\n      - The protagonist, misreading the prot√©g√©'s withdrawal as respect for the magnitude of the confession, feels the mentorship has deepened‚Äîthey've 'broken through' to real connection by being honest.\n      - Later, the prot√©g√© is shown in solitude, reviewing notes or mentally cataloging what they learned; we see them practice specifically targeting the weak shoulder or the line the mentor avoids, cementing their tactical advantage.\n    - A final mentorship moment‚Äîwhere the protagonist offers to step back and publicly support the prot√©g√©'s rise, believing they've successfully passed their legacy‚Äîbecomes a turning point neither realizes: the protagonist sees it as graceful succession, while the prot√©g√© hears permission to eclipse their former teacher and views the gesture as confirmation that they no longer need their mentor's guidance.\n      - The protagonist arranges a private moment with the prot√©g√© before the prot√©g√©'s breakthrough regional win, offering to use their remaining sponsorship capital to sponsor the prot√©g√©'s climb to nationals‚Äîa significant sacrifice of their own competing opportunities.\n      - The protagonist tells the prot√©g√©, 'You've got what it takes. More than I ever did. I want to see you win at nationals. That's what this was all about‚Äînot me staying on top, but making sure you get your shot.' The words are genuine and selfless.\n      - The prot√©g√©'s response is studied and measured: 'I learned everything from you. I wouldn't be here without you.' The words are technically true, but their tone is hollow, and they're already mentally moving on.\n      - The protagonist interprets the gratitude as validation of a job well done and feels a deep sense of purpose and legacy‚Äîthey believe they've transcended ego and truly mentored.\n      - However, the prot√©g√©'s eyes betray a different calculation: they're silently tallying everything the protagonist has taught them and simultaneously cataloging the mentor's weaknesses‚Äîtheir aging body, their caution, the techniques that no longer work against faster, hungrier riders.\n      - In a subtle but crucial moment, the prot√©g√© asks the protagonist, 'Do you ever regret not pushing harder? Like, what if you'd been more ruthless?' The question feels innocent, but it reveals the prot√©g√© now views gentleness and respect as limitations rather than strengths.\n      - The protagonist misreads this as the prot√©g√© seeking reassurance, when it's actually the prot√©g√© confirming that their mentor's philosophy‚Äîracing with integrity‚Äîhas become expendable in their pursuit of victory.\n      - As the prot√©g√© leaves the conversation, the protagonist feels the warmth of a successful mentorship and whispers something like, 'That's my legacy right there'‚Äîcompletely unaware they've just released a rider who now sees them as yesterday's knowledge, not tomorrow's inspiration.\n  - The prot√©g√© has since become the protagonist's primary rival‚Äîtheir relationship fractured by years of unresolved tension, misaligned expectations, and the prot√©g√©'s struggle to escape their mentor's long shadow; though the prot√©g√© harbors genuine bitterness and is driven to prove superiority, traces of admiration and hurt remain beneath the surface.\n    - Years after their mentorship ended, the prot√©g√© achieved early success in the circuit, winning regional races and attracting sponsorships. However, every achievement became shadowed by insistent comparisons to their mentor‚Äîcommentators framed victories through the lens of \"the mentor's techniques,\" fans credited the protagonist's teachings, and sponsorships often highlighted the prot√©g√© as an extension of the protagonist's legacy rather than a rising talent in their own right. What initially felt like proud acknowledgment gradually became suffocating erasure, each win feeling hollow as the prot√©g√©'s own raw talent and relentless hard work went unrecognized.\n      - Early in the prot√©g√©'s solo career, they win their first significant regional race; local media coverage frames it as 'the mentor's prot√©g√© proving their teachings work,' rather than celebrating the prot√©g√© as an emerging individual talent.\n      - The prot√©g√© notices sponsorship interest ties directly to their connection to the protagonist; meetings with potential sponsors focus on 'riding like their mentor' rather than the prot√©g√©'s unique style or marketability.\n      - After a breakout win, the prot√©g√© gives an enthusiastic interview crediting their own training regimen and instincts; clips from the interview circulate alongside commentary that reframes everything through the mentor's influence, making the prot√©g√© feel erased despite speaking up.\n      - The prot√©g√© experiences a moment of vulnerability‚Äîdoubt creeping in‚Äîwondering if they actually are just riding on the protagonist's reputation and not truly talented in their own right, a psychological wound that festers.\n      - A turning point interview where a prominent racing journalist explicitly says the prot√©g√© is 'riding in their mentor's shadow' and speculates whether they can ever truly be their own rider; the prot√©g√© sees this clip blow up on social media.\n      - The prot√©g√© begins tracking every mention of their name online, noticing the ratio of praise for 'their mentor's teachings' versus acknowledgment of their own skill and work; resentment compounds with each new comparison.\n      - The prot√©g√© starts subtly rebelling‚Äîmaking unorthodox tactical choices in races to assert independence, seeking interviews where they deliberately minimize the mentor's influence, even as results begin to suffer from the distraction of this internal battle.\n    - At a major regional championship, the prot√©g√© secures a hard-won, come-from-behind victory through aggressive late-race maneuvers. Flush with triumph and independence, the prot√©g√© is mobbed by media and sponsors when the protagonist approaches‚Äînot with congratulations, but with a private-turned-public critique of one specific risky pass, framed as protective wisdom but landing as a fundamental doubt in the prot√©g√©'s judgment. The prot√©g√©'s elation curdles into shame and resentment, interpreting the criticism as the protagonist unable to accept that their former student has evolved beyond their conservative teachings and now succeeds *despite* rather than *because of* their mentorship.\n      - The prot√©g√© wins the regional championship through a series of bold, calculated passes in the final laps‚Äîa victory that feels like definitive proof that they've transcended their mentor's cautious approach and forged their own winning identity.\n      - The protagonist watches from the sidelines, genuinely impressed but also noticing one particular move‚Äîa pass on the inside line of turn seven‚Äîthat was audacious and effective but, in the protagonist's experience, carried unnecessary margin-of-error risk.\n      - Post-race, the prot√©g√© is signing autographs and conducting media interviews, riding an emotional high, when the protagonist approaches and pulls them aside (or attempts to in semi-public view), asking about that turn-seven pass.\n      - What the protagonist intends as wisdom ('That line had a razor-thin margin; if conditions shift even slightly, you eat dirt. You won when you could have won safer‚Äîwhy not bank that?') gets delivered in a tone tinged with parental concern or condescension.\n      - The prot√©g√©, hyper-attuned to years of the protagonist's implicit message that their talent is incomplete without the mentor's guidance, hears: 'You got lucky. You're reckless. You need me to keep you from destroying yourself.'\n      - The prot√©g√© responds coldly, pulling away: 'I won *my way*. Not your way. Not despite your way‚Äîmy way,' making clear that this contradiction of their autonomy in front of lingering onlookers is the final straw.\n      - The protagonist realizes too late the words were misunderstood, attempts to clarify or soften the message, but the prot√©g√© has already hardened, offering a polite but distant brush-off and retreating into their team's circle.\n      - In the following days, the prot√©g√© begins refusing the protagonist's calls and texts, and when a mutual friend tries to mediate, the prot√©g√© articulates a narrative: the protagonist could never let them grow, could never truly see their talent as separate from the mentorship, and the relationship had become stifling rather than nurturing.\n    - The prot√©g√© makes a calculated but emotionally driven decision to publicly distance themselves from the protagonist: they ignore calls, decline to acknowledge their mentor's influence in interviews, and strategically position themselves as the next generation breaking free from their mentor's 'outdated' conservative approach. Through a series of carefully orchestrated media appearances, the prot√©g√© crafts a rival narrative that reframes the mentor-prot√©g√© relationship as limiting rather than foundational, gaining traction with younger fans and new sponsors eager for a fresh story.\n      - The prot√©g√© initially ignores a series of calls from the protagonist after the unsolicited criticism, not blocking them entirely but creating pointed silence‚Äîthe first public signal of the rift when the prot√©g√© is photographed at a sponsor event wearing gear bearing a rival's logo, conspicuously absent any of the protagonist's branding.\n      - A prominent motocross journalist reaches out for an interview, asking the prot√©g√© directly about their mentor's influence; the prot√©g√©, having rehearsed this moment privately, delivers a polished answer about 'forging my own path' and 'learning to trust my instincts over someone else's rulebook,' each word designed to sound respectful while implying the mentor was holding them back.\n      - The interview goes viral among younger fans and generates social media buzz; momentum builds as the prot√©g√© gives a second, bolder interview where they specifically contrast their 'aggressive, modern' racing style with the mentor's 'defensive, old-school' philosophy‚Äîcareful not to name the protagonist directly, but everyone in the paddock knows exactly who they're referencing.\n      - New sponsors approach the prot√©g√©, attracted by the fresh narrative of youth versus established tradition; one deal explicitly markets them as 'the next generation,' subtly positioning them against the previous era and the mentor who represents it.\n      - At a televised pre-race event, the prot√©g√© and protagonist appear in the same paddock; when directly asked by a reporter if they've spoken, the prot√©g√© responds with cool professionalism: 'We all learn from different sources. I respect the past, but I'm focused on the future'‚Äîa statement that cuts deeper than any direct criticism, its civility making it more damaging.\n      - The protagonist attempts one final outreach, a handwritten letter sent to the prot√©g√©'s team manager; the prot√©g√© never responds, and the silence becomes its own answer, solidifying the narrative that the mentor has been definitively left behind.\n    - Despite the public animosity, the prot√©g√© harbors conflicted feelings that betray their carefully curated rival narrative‚Äîthey secretly watch replays of the protagonist's races, find themselves unconsciously mirroring techniques they were taught, and experience guilt when they catch themselves hoping their mentor will prove them wrong about being \"outdated,\" creating an internal tug-of-war between the need to assert independence and the pull of genuine admiration.\n      - The prot√©g√© obsessively rewatches the protagonist's races on their laptop late at night, analyzing lines and techniques with an intensity they don't apply to any other rider's footage, then deletes the browser history afterward, embarrassed by the behavior.\n      - During their own training sessions, the prot√©g√© catches themselves executing a particular cornering technique exactly as the protagonist taught them years ago‚Äîmuscle memory betraying their narrative of independence‚Äîand they aggressively overcompensate by attempting riskier, less refined methods.\n      - A fellow rider or friend casually mentions how impressed they are by the protagonist's upcoming performance or recent recovery from injury, and the prot√©g√©'s defensive reaction‚Äîtoo sharp, too hostile‚Äîreveals the emotional wound beneath their antagonism.\n      - The prot√©g√© notices they've unconsciously adopted mannerisms from the protagonist: a specific pre-race ritual, a way of reading terrain, even phrases used in interviews‚Äîreminders that separation from their mentor was never complete, triggering both shame and a bittersweet sense of connection.\n      - In a vulnerable moment alone (after a frustrating race or personal setback), the prot√©g√© permits themselves to imagine reaching out to their former mentor, rehearsing an apology or conversation in their head, before quickly shutting down the fantasy and reinforcing their public stance of indifference.\n      - When the protagonist suffers a public setback or injury, the prot√©g√© experiences a complex emotional response: a brief, guilty satisfaction quickly overwhelmed by genuine concern and the realization that they don't actually want to see their mentor destroyed‚Äîonly to bury these feelings again.\n    - At pre-race events and in the paddock, the protagonist and rival engage in carefully orchestrated avoidance that masks deep pain‚Äîbrief nods across crowded spaces, awkward moments where their paths nearly cross forcing stilted pleasantries, and interactions mediated by team personnel; these encounters reignite old wounds, with each side interpreting casual words as barbs and reading rejection into neutral gestures, while observers sense the electric tension between them.\n      - At the national championship registration, they arrive simultaneously; the protagonist instinctively heads toward the rival to offer encouragement, but catches themselves mid-stride, instead pretending to check their phone, creating an awkward frozen moment where the rival notices the almost-greeting and turns away first, stung by the rejection they caused.\n      - The rival watches the protagonist's practice session from behind the pit garage, hidden from view, studying their technique and body language for signs of decline‚Äîbut instead sees the old fire and precision, triggering a rush of conflicting emotions (admiration, jealousy, loss).\n      - During a mandatory pre-race media event, they're positioned near each other; the rival's team strategically keeps them separated, but their body language is hyperaware of each other's presence‚Äîthe protagonist speaks louder than necessary about their comeback, while the rival's answers become shorter and more aggressive, each performance aimed at the other.\n      - The rival's crew chief, noticing the prot√©g√©'s distraction, casually asks about their history; the prot√©g√© dismisses it as 'ancient history,' but then can't stop themselves from adding defensive comments about how they've surpassed their mentor's limitations‚Äîthe crew chief senses unresolved tension.\n      - In the paddock, a mutual acquaintance (commentator, rival driver, sponsor representative) runs into both separately and foolishly attempts to bridge the gap, telling each how much the other 'still talks about them'; both deny it, but show visible reactions, later obsessing over what the other supposedly said.\n      - The protagonist sees the rival stretching before a qualifying round and is flooded with muscle memory of teaching those exact stretches years ago; they want to call out a form correction but stop themselves, turning away instead‚Äîthe rival catches this moment of near-connection and feels a complex wave of longing and resentment.\n      - They briefly make eye contact across the championship hall; for a split second, the masks drop and something raw flickers between them (recognition, hurt, maybe regret)‚Äîthen both quickly look away, shaken by how close they came to genuine connection, each replaying the moment alone later.\n  - The protagonist, working with a grizzled ex-racer turned trainer, undergoes a grueling three-phase training regimen: rebuilding cardiovascular endurance and grip strength despite chronic shoulder pain, mastering aggressive new techniques to match their rival's speed, and undertaking psychological work to overcome the trauma of their humiliating loss and the terror of repeating it on the national stage.\n    - Phase 1 - Brutal Basics: The protagonist begins pre-dawn training sessions under their grizzled trainer, expecting muscle memory to carry them through; instead, early morning rides ruthlessly expose how their body has deteriorated‚Äîtheir grip fails mid-maneuver, their shoulders scream in protest, and their cardiovascular system betrays them within minutes. Each session becomes a cascading series of humbling failures that forces them to confront the physical cost of years away from competition and acknowledge that nostalgia cannot substitute for conditioning.\n      - The protagonist arrives at pre-dawn training brimming with false confidence, believing their body will 'remember' what it needs to do; they attempt their signature aggressive maneuver on the first lap and nearly low-side the bike, shocking themselves with how sluggish their reflexes have become.\n      - In the following days, the trainer deliberately keeps rides short and controlled, but the protagonist can't make it through even abbreviated sessions without their grip hand going numb and their breathing becoming labored; the humiliation of physical limitations compounds each time.\n      - A specific moment: during a simple figure-eight drill, the protagonist's chronic shoulder injury flares violently, causing them to drop the bike; lying on the dirt, they can feel the ghost of who they used to be warring with the fragile reality of who they are now.\n      - The trainer offers minimal sympathy, forcing the protagonist to get back on immediately; this tough-love approach triggers conflicting emotions‚Äîresentment at the cruelty and gratitude that someone still believes they're worth pushing.\n      - Late one morning, the protagonist experiences a cruel tease: for one perfect lap, everything clicks‚Äîmuscle memory floods back, instincts align, and they feel invincible for exactly 90 seconds before their cardiovascular system crashes and they're forced to stop, gasping and shaking.\n      - That night, the protagonist reviews video of their pre-dawn rides for the first time and confronts the visual evidence: sloppy lines, hesitant entries, jerky corrections‚Äînothing like the smooth, predatory precision they remember from their championship days.\n      - A turning point arrives when the protagonist, stubborn and desperate, tries to push through a session against the trainer's advice; they injure themselves again (minor but significant), and in the moment after, forced to sit out while the trainer waits silently, they finally verbalize the fear: 'I'm not the same person. I don't know if I can be.'\n      - The trainer responds not with reassurance but with a challenge: 'You're not supposed to be. You're building something different. But first you have to stop mourning what's gone and start respecting what you've still got left.'\n    - The protagonist's doctor delivers a brutal medical reality: imaging reveals chronic rotator cuff damage and accelerated cartilage loss; they're warned that another serious shoulder injury could result in permanent nerve damage or loss of arm function, and that their recovery rate has slowed dramatically due to age. The protagonist dismisses the warning with brittle confidence, but the next training session, their shoulder throbs with a new, terrifying intensity, planting seeds of doubt they cannot fully suppress.\n      - During the appointment, the doctor shows the protagonist imaging results side-by-side with scans from five years prior, visually demonstrating the deterioration; this clinical evidence is harder to deny than vague warnings.\n      - The doctor specifically mentions the risk of 'permanent nerve damage' and asks the protagonist point-blank: 'Is finishing one race worth losing use of your arm for the rest of your life?'‚Äîa question that hangs unanswered.\n      - Driving home from the appointment, the protagonist is unusually quiet, gripping the steering wheel and testing their shoulder's range of motion obsessively, their denial already fracturing.\n      - That evening, they research nerve damage and permanent injury outcomes online, falling into a rabbit hole of worst-case scenarios before forcing themselves to close the laptop, rationalizing that doctors are always overly cautious.\n      - At the next training session, within the first thirty minutes, their shoulder flares with sharp pain during an aggressive turn; they push through it, but the sensation lingers‚Äîno longer just chronic ache, but a warning signal their body is literally screaming.\n      - The trainer notices the protagonist favoring their left side and asks if they're okay; the protagonist lies and says it's nothing, but the lie itself feels like a small betrayal‚Äîof the trainer, of themselves‚Äîadding another layer of doubt.\n      - That night, unable to sleep from shoulder pain, the protagonist lies awake imagining a future where they can't work on bikes, can't lift, can't embrace loved ones without pain; this imagined loss feels more terrifying than any racing defeat.\n      - The next morning, the protagonist notices their family member watching them move gingerly through the kitchen, and in their eyes, the protagonist sees confirmation of what the doctor said: they're not invincible, they're aging, and this obsession might actually destroy them.\n    - Phase 2 - Learning from the Enemy: The protagonist obsessively studies their rival's racing footage, discovering their mentee has not only mastered every technique they taught them but weaponized it into an aggressive, reckless style that borders on suicidal. As they analyze specific turns and lines, waves of conflicting emotions‚Äîpride in what they created, shame at what it's become, and competitive hunger‚Äîpush them to learn dangerous new approaches while wrestling with the moral question of whether matching aggression means abandoning the wisdom they once valued.\n      - The protagonist obtains race footage of their rival's recent victories and begins analyzing it late into the night, initially as tactical preparation, but increasingly as an obsessive hunt for recognition of their own influence in every maneuver.\n      - A specific moment occurs where the protagonist identifies one of their signature techniques‚Äîthe 'inside line feint' they invented decades ago‚Äîexecuted flawlessly by their rival, triggering an unexpected surge of paternal pride immediately followed by resentment at the credit going unacknowledged.\n      - Through frame-by-frame analysis with the trainer, they discover their rival's most winning move: taking turns at angles and speeds the protagonist always considered too dangerous, accepting near-crashes as acceptable risk in a way that contradicts everything the protagonist taught them about calculated aggression.\n      - The protagonist realizes with discomfort that their prot√©g√© didn't just learn the techniques‚Äîthey understood the *philosophy* behind them well enough to intentionally push past the safety boundaries the protagonist had imposed, revealing either boldness or recklessness (or both).\n      - A confrontational session with the trainer escalates when the protagonist argues they need to match the rival's aggression, while the trainer warns that imitating recklessness is different from mastering calculated risk; the trainer challenges the protagonist: 'Are you learning from them, or are you just trying to beat a ghost version of yourself you taught them to become?'\n      - The protagonist spends a night in the workshop studying their own old race footage, reminding themselves of the precise technical reasoning behind every line they invented; they recognize that what the rival calls 'improvement' is often just throwing caution to the wind.\n      - A turning point arrives when the protagonist attempts to replicate one of the rival's most dangerous maneuvers during a practice lap and nearly crashes hard; they survive but are shaken, forcing them to confront whether they're physically and mentally capable of matching that level of recklessness.\n      - The protagonist and trainer work to develop a hybrid approach: identifying which of the rival's aggressive lines are actually *innovative* (worth learning) versus which are simply reckless (to be avoided); this becomes a technical and philosophical exercise that restores the protagonist's confidence in their own judgment.\n      - A quiet realization settles in: the protagonist's edge won't come from copying their prot√©g√©'s fearlessness, but from combining their decades of technical mastery with targeted aggression in *specific* moments‚Äîa more refined, intelligent form of speed that contrasts with the rival's raw hunger.\n      - The protagonist drafts a new race strategy incorporating two or three of the rival's genuine innovations alongside their own proven techniques, creating a hybrid identity as a racer that feels both like evolution and like reclaiming their legacy on their own terms.\n    - During an exhausting pre-dawn training session after weeks of slow progress, the trainer abruptly stops the protagonist mid-lap and, after tense silence, confronts them directly: he's seen the same hollow eye contact and mechanical movements that preceded the protagonist's regional qualifier collapse years ago. The trainer then opens up about his own retirement, admitting he withdrew from racing not at the peak of his hunger but when it started to fade‚Äîa cowardice he regrets. Seeing the protagonist repeat this pattern terrifies him, but the protagonist's stubborn insistence on continuing despite obvious pain and fear becomes the spark that reignites both their belief in redemption.\n      - The trainer notices the protagonist arriving later each morning and performing mechanically through routines, going through motions without the fire that usually characterizes their riding; this echoes a specific moment from their competitive past when they watched the protagonist begin a similar decline before the regional collapse.\n      - During a cool-down after a particularly sluggish session, the trainer directly asks: 'Are you here to race, or are you here because you're afraid to stop?'‚Äîa question that cuts to the heart of the protagonist's real motivation and forces honesty.\n      - The trainer reveals his own exit from professional racing fifteen years ago: he quit not because of a dramatic injury or loss, but because he felt the hunger slipping away and chose the exit that protected his ego rather than risk discovering he was no longer good enough.\n      - The trainer admits that watching the protagonist now‚Äîsomeone he once competed fiercely against‚Äîstruggle with the same doubts and decline triggers his own unresolved regrets; he's terrified of seeing another rider surrender to fear rather than face the truth of their abilities.\n      - The protagonist responds defensively at first, insisting their slowness is physical (shoulder pain, age, recovery time) not mental; but as the trainer describes what he actually sees‚Äîthe way they flinch before aggressive turns, the way they've modified their race line to be safer‚Äîthe protagonist can't deny it.\n      - In a moment of vulnerability, the protagonist admits they *are* afraid‚Äînot of losing, but of discovering that the humiliation at regionals wasn't a fluke but proof they really are finished, that their best years are genuinely behind them.\n      - The trainer shares that this fear, this willingness to face the abyss rather than take the coward's retirement, is exactly what separates champions from everyone else; the protagonist's hunger isn't gone‚Äîit was just buried under layers of self-protection.\n      - The two men stand in silence as dawn breaks over the empty track, and the trainer says quietly: 'If you're going to do this, do it like you're still hungry. If you're not, quit now while you still have your pride.'\n      - The protagonist returns to training with a subtle but palpable shift in intensity; the trainer watches with recognition, understanding that his own confession and challenge have given the protagonist permission to stop fighting their desire and embrace it fully.\n    - A pivotal training crash during a dangerous new technique drill leaves the protagonist hospitalized with multiple broken ribs and a partially separated shoulder; the injury forces six weeks of painful recovery during which they question whether their body can survive the championship. Simultaneously, their estranged spouse (or parent/sibling) confronts them during a hospital visit, revealing the collision of their obsession with family obligations and expressing an ultimatum: abandon the championship dream or accept the consequences to their relationship. Isolated during recovery, the protagonist must reconcile whether they're genuinely chasing redemption or recklessly pursuing self-destruction, while physical therapy becomes a metaphor for learning to move forward differently‚Äîboth literally and emotionally.\n      - The crash itself: The protagonist, desperate to close the gap on their rival's fastest lap time, rushes into mastering an aggressive new cornering technique before their body is ready; they lose control mid-turn and are ejected over the handlebars, landing hard on their side‚Äîthe impact cracking three ribs and leaving them gasping for breath on the track while medical personnel rush to their aid.\n      - Hospital scene and diagnosis: X-rays reveal not just the broken ribs but also a partially separated shoulder (lingering damage from their old injury, now worsened); the doctor is blunt‚Äîthe shoulder won't be fully healed before nationals, and further damage could end their racing career permanently.\n      - Visitor arrives: During a difficult hospital visit, the protagonist's spouse/family member (someone they've been distant from during training) sits at their bedside and forces a reckoning; they detail specific moments of abandonment (missed family dinners, broken promises, being emotionally unavailable), and articulates that if the protagonist continues with the championship, it signals they care more about their own legacy than the relationship.\n      - The ultimatum and silence: The family member leaves without waiting for an answer, leaving the protagonist alone in the hospital bed facing a genuine choice: they cannot have both the comeback and the relationship as currently structured; this creates genuine dramatic tension.\n      - Physical therapy ordeal: During the six weeks of recovery, physical therapy sessions are agonizing; the protagonist must painfully rebuild mobility in their ribs and shoulder, and for the first time, they cannot push through it‚Äîtheir body literally will not allow it; they're forced to move slowly, to rest, to accept limitation.\n      - Internal reckoning: Late-night hospital and home recovery moments reveal the protagonist grappling with whether they've been chasing redemption or running from the responsibility of aging, failure, and irrelevance; they confront the uncomfortable truth that winning won't fix their relationships or their worth.\n      - Reaching out: A quiet turning point where the protagonist, humbled and injured, initiates a difficult conversation with their family member‚Äînot promising to quit, but genuinely listening for the first time and acknowledging the damage their obsession has caused.\n      - Return to training: Against their doctor's advice, but with newfound emotional honesty, the protagonist returns to training with just two weeks until nationals; they're slower and more limited due to their injuries, but their mental state has shifted‚Äîthey're no longer running, they're choosing.\n    - Phase 3 - Mental Reckoning: The protagonist begins working with a sports psychologist, initially resistant and defensive, and through a series of intense sessions gradually excavates the humiliation beneath their regional qualifier loss, the perfectionism that once drove them to greatness but now suffocates their riding, and ultimately confronts a deeper fear: that they no longer *deserve* to win because they've become someone they don't respect.\n      - The trainer finally delivers an ultimatum: if the protagonist won't address their headspace, physical training alone will fail them; a referral comes for Dr. Elena Reeves, a former competitive athlete turned psychologist who specializes in athlete trauma and shame.\n      - In the first session, the protagonist is guarded and contemptuous, viewing therapy as weakness; Dr. Reeves doesn't push, instead asking a deceptively simple question: 'What did you do immediately after the regional qualifier loss?' The answer‚Äîgoing home, drinking alone, not answering calls from family or sponsors‚Äîreveals the protagonist's shame spiral pattern.\n      - A breakthrough arrives when Dr. Reeves asks them to describe, in vivid detail, the specific moment they lost the race: who was ahead, what the crowd sounded like, how their body felt, what they told themselves in that moment; the protagonist realizes they've been replaying a distorted version where they were incompetent, when actually they made one tactical error against a faster opponent.\n      - Through guided reflection, the protagonist recognizes that their toxic perfectionism‚Äîthe belief they had to be flawless to be worthy‚Äîcame from a parent's conditional love or early experience of being praised only for winning; this perfectionism served as armor, but now it's a prison, making every mistake feel like total annihilation.\n      - A pivotal session occurs when Dr. Reeves asks: 'If your rival crashed tomorrow and couldn't race, would you want to win this championship?' The protagonist's honest answer‚Äî'No, not really'‚Äîshakes them; they realize they don't want to win for *themselves*, they want to win to restore their ego and silence critics, which is a fragile, reactive motivation.\n      - Over subsequent sessions, the protagonist begins differentiating between 'fear-based perfectionism' (riding to prove they're not a failure) and 'growth-based excellence' (riding to master the craft itself); this semantic shift subtly changes how they approach training and risk.\n      - In a raw emotional moment, the protagonist admits to Dr. Reeves that they're terrified they've become a cautionary tale‚Äîthe washed-up athlete clinging to past glory‚Äîand that even winning nationals won't fix what they fear is broken inside them; Dr. Reeves reframes this: the goal isn't to fix a broken past self, but to honor their present self by showing up courageously.\n      - The protagonist begins keeping a post-session journal where they write letters to their younger self (the hungry kid who loved riding) and their future self (the person they want to become beyond this race); these letters become emotional anchors when self-doubt resurfaces.\n      - In the final weeks before nationals, the protagonist notices they're riding differently in practice‚Äîless rigidly perfectionist, more adaptive and intuitive; Dr. Reeves observes that they've finally separated their *self-worth* from their *performance*, which paradoxically makes them a faster, more confident rider.\n      - A quiet moment before nationals: the protagonist re-reads Dr. Reeves's final session note, which includes the insight that 'redemption isn't about proving anything to anyone else‚Äîit's about proving to yourself that you can face your fears and ride anyway'; this becomes their true north for race day.\n    - Late-night visualization sessions emerge as the protagonist's critical turning point: alone in their dimly lit garage, they practice dissociating the finish line from their self-worth, imagining themselves crashing and remounting with the same dignity they'd display winning; mantras solidify around \"I am enough in the struggle\"‚Äîa painful rewiring of their perfectionist identity; when a routine training run ends in a fall that would have previously spiraled them into despair, they instead notice the shift: they feel the fear and shame, but choose to stay on the bike, demonstrating to themselves that survival through failure is possible.\n      - The protagonist's sports psychologist assigns them a specific visualization exercise: imagine the worst-case scenario (crashing, finishing last, public humiliation) but extend the visualization beyond the moment of failure to include themselves getting up, walking off the track, and how they'd feel hours later‚Äîdiscovering that survival is survivable and doesn't destroy them.\n      - During a late-night session in the garage, the protagonist sits on their bike in darkness and rehearses this visualization repeatedly, initially resisting the urge to 'fix' the imagined failure into a victory, instead sitting with the discomfort of imagined loss until their nervous system stops perceiving it as catastrophic.\n      - A specific mantra crystallizes through this work: 'I am enough in the struggle'‚Äîa stark contrast to their former perfectionist mantra about winning; they write it on tape and wrap it around their handlebars as both a practical reminder and a symbolic anchor.\n      - During a routine practice session, the protagonist executes a new aggressive line they've been working on, crashes hard, and feels the familiar spiral of shame begin‚Äîbut recognizes it, names it, and consciously chooses to remount immediately rather than sitting in self-recrimination; this moment becomes proof that their mental work is transferring to real conditions.\n      - The trainer witnesses this crash and remount, and instead of rushing to help or criticize, simply nods; later they tell the protagonist, 'That's the rider I've been waiting to see‚Äînot the one afraid to fall, but the one who's made peace with it'; the validation cements the shift.\n    - During a visualization session with his sports psychologist, the protagonist attempts to mentally recreate his past championship-winning ride, moment for moment‚Äîbut finds he cannot access it. The memory feels like watching a film of someone else. Confronted with the impossibility of reclaiming that version of himself, something breaks open: he stops chasing a ghost. Instead of grief, he feels a strange liberation. That night, during a practice run, his body moves differently‚Äînot with the rigid perfectionism of his younger self, but with intuitive aggression and present-moment awareness. For the first time in months, he's not riding to prove something to his past; he's riding to discover what his present self is capable of. This mental shift, though small, unlocks a hunger that feels cleaner, less desperate, and paradoxically more powerful.\n    - Three days before nationals, the protagonist stops at a late-night gas station along the highway where they both happen to refuel; in the harsh fluorescent light by the pumps, they notice each other simultaneously‚Äîboth moving slowly, both favoring old injuries, both buying electrolyte drinks and energy bars with the mechanical precision of athletes counting down the hours. When they lock eyes across the convenience store, neither looks away immediately, and a beat of recognition passes between them: the rival's face shows the same hollowed-out exhaustion the protagonist feels in their bones. Inside, they stand in the same aisle, close enough to speak but saying nothing, until the protagonist glimpses the rival's hands wrapped in fresh athletic tape and notices them wince while reaching for a bottle. A moment of connection flickers‚Äîthe protagonist realizes their prot√©g√© is carrying their own injury, their own terror‚Äîbut the rival turns away sharply, reasserting the wall between them. The encounter ends without words, both leaving in different directions, but the protagonist drives away with an unexpected ambivalence: they've been humanized to each other, yet this knowledge feels dangerous, a vulnerability neither can afford to carry into the final days before battle.\n    - In the final week before nationals, the protagonist clocks their fastest practice lap in years, a breakthrough moment that validates months of grueling training; but on the second attempt, pushing even harder to replicate the speed, they crash spectacularly‚Äîa violent high-side that leaves them shaken and injured. Waking the next morning sore and rattled, they seriously contemplate withdrawal, receiving a crushing message from their estranged family member about \"knowing when to quit.\" A tense late-night confrontation with the trainer forces the protagonist to articulate their fear of repeating their humiliating loss on the national stage, and the trainer shares a hard truth: he's watched the protagonist confuse \"boldness\" with \"recklessness\" for years, but this time, something has genuinely shifted in their riding. The trainer challenges them to distinguish between fear that signals real danger (wisdom) and fear that simply guards against vulnerability and failure (ego protection), ultimately leaving the choice to the protagonist.\n      - The protagonist completes a flawless practice lap‚Äîtheir fastest time in years‚Äîleaving them exhilarated and validated; the trainer even nods with rare approval.\n      - Intoxicated by the success and desperate to prove it wasn't a fluke, the protagonist insists on pushing harder on lap two, adopting an even more aggressive line.\n      - The crash is catastrophic: the bike slides out mid-turn, launching the protagonist over the handlebars; they land hard, the wind knocked out of them, physical pain radiating through their body‚Äîand beneath it, a deeper shame at losing control.\n      - Recovery is slow and painful. The protagonist limps around the garage, icing injuries, replaying the crash in obsessive loops, questioning whether they pushed too hard too soon.\n      - A text arrives from their estranged family member: 'Maybe Dad was right to worry. Maybe it's time to accept this isn't your time anymore. Please just come home safe.' The words hit harder than the physical pain.\n      - That evening, the protagonist sits alone on their bike, helmet in hand, seriously considering calling the championship organizers to withdraw.\n      - The trainer finds them there. Initially, they don't speak‚Äîjust sit together in the quiet. Then the protagonist breaks: 'I proved I'm still just the same fool who crashed and burned before. Why would this time be different?'\n      - The trainer's response cuts through: 'I've watched you for forty years. You've always confused being brave with being stupid. But these past three months? That's not the same man. You crashed because you were hungry, not because you were reckless. The question is: can you feel the difference?'\n      - The trainer elaborates, telling the protagonist that true wisdom about risk isn't about fear‚Äîit's about knowing the difference between the terror of failing (which keeps them small and safe) and the instinct that says 'slow down, this line is genuinely dangerous.' One is ego armor. The other is survival.\n      - The protagonist sits with this. They recall moments during training where they backed off a maneuver because something felt wrong‚Äîand they were right. They also recall the crash‚Äîand realize they were pushing not to win, but to erase self-doubt.\n      - The trainer stands to leave, offering no more advice: 'You know what you have to do. Only question is whether you'll do it.' The choice is placed squarely on the protagonist's shoulders, leaving them to wrestle through the night with the decision.\n  - The protagonist's teenage daughter, who once worshipped their racing career, feels increasingly abandoned as the protagonist pours every waking hour into training; a heated confrontation forces the protagonist to confront whether they're chasing redemption for themselves or proving something to their daughter‚Äîand risking losing her in the process.\n    - Early in the training montage, the daughter surprises the protagonist at a pre-dawn practice session, arriving with coffee and breakfast‚Äîa gesture meant to bond‚Äîbut finds the protagonist already locked into an obsessive rhythm of lap drills; as she tries to get their attention from the sidelines, the protagonist is so deep in their head-space that they offer only distracted grunts and waves, missing entirely that she's holding back tears; when she finally leaves, she doesn't say goodbye, and the protagonist doesn't notice she's gone until hours later.\n    - The protagonist misses their daughter's first major solo violin recital‚Äîa performance the daughter has been preparing for months and invited the protagonist to attend‚Äîbecause a crucial training session is scheduled at the same time; when the protagonist later attempts to apologize with promises of \"next time,\" the daughter's bitter response reveals that this isn't the first missed event and that she's stopped expecting the protagonist to show up.\n      - Days before the recital, the daughter mentions it casually during dinner, trying to downplay her nervousness; she leaves the invitation on the protagonist's desk, but the protagonist is already mentally reviewing the national championship course and barely registers it.\n      - The protagonist's trainer schedules a final, crucial track session at a private facility for the same evening‚Äîa session the protagonist has been waiting weeks for, one that could test a new setup against rival riders' data; the protagonist sees the calendar conflict and wrestles with it for a moment, then rationalizes that the recital is 'just one performance' and promises to record it.\n      - The daughter asks the protagonist directly, 'You'll be there, right?' The protagonist says 'Yeah, babe, of course,' but the answer comes a beat too late and with too little eye contact, and the daughter sees through it‚Äîshe knows this isn't a yes, it's an 'I hope so, but no promises.'\n      - On the night of the recital, the protagonist gets caught in unexpected traffic heading to the track and arrives at the session late; by the time they realize the recital must have started, they don't turn back.\n      - The protagonist returns home to find the daughter already in her room, still wearing the recital dress; the protagonist knocks, enters with flowers and apologies: 'I'm so sorry, kid. I got held up. Tell me how it went‚ÄîI bet you were amazing.'\n      - The daughter turns from her window, face blank and controlled in a way that's more heartbreaking than anger: 'It was fine. I nailed the solo. Mom recorded it.' The use of 'Mom' (revealing the other parent was there) and the clinical tone suggests the daughter has already processed the absence.\n      - The protagonist pivots to reassurance: 'Hey, look, there are other performances. Next season you'll have a whole tour of recitals and I promise I'll be at every‚Äî' but the daughter cuts her off.\n      - The daughter says quietly, 'You don't have to promise. You can just say you can't make it. That's easier than... this.' She gestures vaguely at the flowers, the apology, the performance of caring. The protagonist pushes back, defensive: 'That's not fair. I'm trying here,' but the daughter's response is the real wound: 'You tried. Last year at my competition. The year before at my art show. You try and then you don't show up. So now I just... I don't invite you anymore to the things that matter.'\n      - The protagonist realizes this recital wasn't the first miss‚Äîthe daughter has simply stopped expecting them, and more painfully, has stopped wanting them there, because the hope followed by disappointment is worse than no hope at all.\n    - The daughter systematically distances herself from her father's legacy, removing his memorabilia from her room and actively seeking out a surrogate parental figure‚Äîan aunt, uncle, or family friend‚Äîwho offers the time and attention the protagonist can no longer provide, making her shift in loyalty visible through small, heartbreaking choices.\n      - The protagonist notices the daughter's bedroom has changed: old framed photos from race days are gone, posters and autographed merch have been taken down or packed away, replaced by neutral decor‚Äîa silent but unmistakable erasing of the protagonist's presence from her private space.\n      - During a casual family meal or moment, the daughter mentions an upcoming outing or accomplishment and casually reveals she's already made plans with her aunt/uncle (or family friend) to celebrate or prepare, not asking if the protagonist wants to be involved.\n      - The protagonist witnesses or learns that the daughter is spending increasing amounts of time at the other adult's house after school‚Äîostensibly for help with homework, a hobby, or just 'hanging out'‚Äîand hears genuine laughter and easiness in her voice when talking about these visits, a tone the protagonist hasn't heard directed at them in weeks.\n      - A small but pointed moment: the daughter receives a gift or word of encouragement from the surrogate figure about something she cares about (academic progress, a personal goal, a creative pursuit), and her grateful, unguarded reaction reveals how starved she's been for that kind of attention and pride from someone present in her life.\n      - The protagonist finds or overhears the daughter talking to a friend about the surrogate adult‚Äîusing words like 'actually listens' or 'is always there'‚Äîor even referring to them with a term of affection, realizing the daughter is unconsciously comparing them and finding the protagonist lacking.\n    - During a late-night argument, the daughter confronts the protagonist about missing yet another important moment in her life, accusing them of chasing redemption for themselves rather than being present for those who never doubted them; the protagonist, exhausted and defensive, snaps back with words that suggest they resent the burden of her expectations‚Äîa line that wounds the daughter far deeper than any rejection of her presence could.\n      - The daughter discovers the protagonist has overslept and missed her college orientation fair‚Äîan event the protagonist had promised to attend; when confronted, the protagonist dismisses it as \"not a big deal\" and immediately pivots to discussing a scheduling conflict with tomorrow's training session.\n      - Frustrated by the dismissal, the daughter pushes harder: \"You promised. You always promise, and then something with the bike comes up, and suddenly I'm not important anymore.\"\n      - The protagonist, already sleep-deprived and wound tight from training, responds defensively: \"I've given you everything. I've sacrificed for you. Maybe it's time you understood that not everything is about you.\"\n      - The daughter, stung, retorts: \"That's the problem. Everything is about proving yourself to everyone else. You don't even see me anymore‚Äîyou just see proof that you failed as a dad too.\"\n      - The protagonist, hit with a truth they can't deflect, lashes out: \"You know what? Maybe you're right. Maybe you'd be better off with your aunt, since she's so goddamn available. At least then I wouldn't feel guilty every single second for not being perfect enough for you.\"\n      - The words hang in the air‚Äîthe protagonist has essentially said, 'I resent you for making me feel like a failure as a parent,' and the daughter hears it as, 'I wish you weren't my problem.'\n      - The daughter's face goes quiet and hollow; without another word, she turns and leaves the room, and the sound of her bedroom door closing feels final.\n      - The protagonist, left alone, realizes the damage‚Äînot just emotional withdrawal, but the confirmation in the daughter's eyes that she's learned the hard way: she cannot depend on them, and trying to will only hurt.\n    - During a late-night confrontation that escalates from the protagonist's defensive reaction to the daughter's earlier accusations, the argument reaches a breaking point where the daughter's facade of resentment cracks; through tears, she admits she's terrified the protagonist will suffer another catastrophic crash‚Äîboth physically and mentally‚Äîand that she's helpless to stop it, revealing that her anger has been armor against the deeper terror of losing them.\n      - The argument begins with the daughter repeating her earlier accusation that the protagonist only cares about proving everyone wrong, but when the protagonist responds defensively or dismissively, it triggers the daughter to escalate‚Äîno longer holding back her real fear beneath the resentment.\n      - The daughter references the protagonist's previous crash/setback in vivid detail‚Äîwhat they saw, what the recovery looked like, how frightened she was then‚Äîmaking clear her present anxiety isn't abstract but rooted in witnessed trauma.\n      - The protagonist tries to reassure her with platitudes ('I know what I'm doing' or 'I'll be fine'), which only deepens the daughter's panic, because she realizes her parent still isn't hearing her actual fear, only her accusations.\n      - In frustration and fear, the daughter's voice breaks as she admits: 'I'm not mad because you're racing. I'm mad because you're going to crash and I can't stop you, and last time you crashed I thought I was going to lose you, and I can't‚Äî' (trails off, unable to finish).\n      - The protagonist is silent, truly hearing their child's terror for perhaps the first time, and realizes that the daughter's gravitating toward the aunt/uncle figure and her absence from race day aren't acts of rebellion‚Äîthey're self-protective measures, ways of creating distance to shield herself from further heartbreak.\n      - The daughter admits that her resentment and coldness have been ways of preparing herself for the worst‚Äîif she stops loving the protagonist's racing career, maybe losing them won't hurt as much; and if she pulls away now, at least the separation is on her terms.\n    - The daughter, after days of silence, makes the agonizing decision not to attend the national championship; her deliberate absence serves as both an act of self-protection and a final, wordless statement about what the protagonist has sacrificed‚Äîand she delivers this news in a way that forces the protagonist to truly hear her pain.\n      - Days before the championship, the daughter withdraws further; she's polite but distant, no longer angry‚Äîa shift that feels even more devastating than her accusations because it suggests she's made a final decision and moved past the fight.\n      - The protagonist notices the daughter has stopped asking about logistics (what time the race is, where it's being held, etc.), a detail that triggers creeping dread but which the protagonist initially rationalizes as her just not caring anymore.\n      - The daughter finally speaks about her choice not in an argument but during a quiet, mundane moment (washing dishes, sitting in the car, before bed)‚Äîher calm tone making it hit harder than any shouting could; she explains she can't watch him risk everything again, that she needs to protect herself from the fear and disappointment.\n      - The protagonist's first instinct is to try to convince her to come, to promise he'll be careful, to appeal to sentiment ('don't you want to be there when your dad proves himself?'); the daughter's response‚Äîa sad shake of her head, a quiet 'I can't'‚Äîshows that logic and promises won't change her mind.\n      - The protagonist realizes this isn't about the race at all; the daughter has already lost faith that he'll choose her, so she's choosing to not be present for what feels like inevitable heartbreak, whether he wins or loses.\n      - As race day approaches, the protagonist catches themselves repeatedly scanning the crowd in their mind, knowing her seat will be empty, and this absence becomes a weight they'll carry into the competition‚Äîa personal reminder of what they're really racing against.\n    - In the days before the championship, the protagonist discovers their daughter has planned something special (a poster, a playlist, handwritten letter of encouragement) in secret‚Äîbut after finding it hidden, unused, they confront a brutal truth: the daughter has already emotionally withdrawn, no longer believing the protagonist will show up for them. Devastated and alone in their trailer the night before the race, the protagonist is forced to choose between the relentless pursuit of vindication and the possibility of genuine reconnection, leading them to make one final call or gesture to their daughter‚Äînot to guarantee forgiveness, but to signal that they now understand what they've been willing to sacrifice.\n      - The night before the championship, while organizing gear, the protagonist stumbles upon a carefully hidden poster or handmade banner their daughter had begun creating‚Äîfeaturing old photos of the protagonist's glory days and supportive messages in teenage handwriting, now abandoned and half-finished under the bed.\n      - The discovery triggers an unbidden memory: the daughter excitedly asking months ago if the protagonist thought they'd come watch them compete, followed by the protagonist's distracted non-answer as they mentally calculated lap times.\n      - Sitting alone in their trailer, the protagonist's coach or team member tries to pump them up with talk of redemption, vindication, and proving doubters wrong‚Äîthe same speech that's fueled months of single-minded training‚Äîbut for the first time, it rings hollow.\n      - The protagonist realizes that all the physical preparation means nothing if they cross the finish line and return to a home where their daughter is a stranger who's learned the hard way that the protagonist's love is conditional, dependent on chasing ghosts.\n      - In a moment of raw vulnerability, the protagonist pulls up their phone and calls or visits their daughter, not to ask her to come to the race or to apologize with empty promises, but to say something like: 'I see what I've been doing. I can't fix it tonight, but I need you to know‚Äîyou matter more than any trophy or comeback. I don't know if I'll place tomorrow, but I'm choosing to actually be here now.'\n      - The daughter's response (acceptance, hesitation, cautious hope, or guarded warmth) remains uncertain, but the gesture itself‚Äîthe protagonist prioritizing honesty and presence over the illusion of a perfect comeback narrative‚Äîbecomes the real stake of race day: they're riding not just for redemption, but for the chance to rebuild trust afterward.\n      - The protagonist returns to their trailer that night with a new clarity: they can't control whether they win, whether they impress the rival, or whether the comeback narrative completes itself‚Äîbut they can control whether they show up for the people who never left them, starting now and continuing long after the final heat.\n  - Race day arrives with media attention and scrutiny; as the early heats unfold, the protagonist discovers renewed confidence through solid performances that prove age isn't a liability, while witnessing the rival dominate with increasingly aggressive and calculated tactics that seem designed to intimidate‚Äîculminating in a tense moment between them where the protagonist realizes their former prot√©g√© has evolved beyond the teachings they once imparted, adding a bittersweet layer to their rivalry.\n    - The protagonist enters the track for their qualifying heat, initially fighting instinctive hesitation at the starting line‚Äîyears of self-doubt threatening to sabotage them before they even begin; but once the gate drops, muscle memory and hard-won technique flow through them as they navigate the track with precision, hitting their mark on a crucial turn that had haunted them since the regional qualifier, their lap culminating in a time that shocks the commentators into stunned recognition and sends the crowd to their feet‚Äîa moment where external validation finally aligns with internal capability, cracking through the psychological weight they've been carrying.\n      - As the protagonist approaches the starting line, their hands grip the handlebars tighter than necessary; breathing becomes shallow as muscle memory from past failures tries to reassert control, but they consciously ground themselves, recalling the mental training regimen they've been practicing.\n      - The gate drops and they explode forward; the first section of track is executed flawlessly, each body position and throttle input a product of weeks of physical training, suggesting to themselves and the gathered crowd that age might not be the liability everyone assumed.\n      - At the mid-track turn‚Äîthe exact same corner where they lost control and crashed at the regional qualifier‚Äîthey hit the apex perfectly, their line smoothing out with practiced grace; they can feel the bike respond exactly as intended, and for the first time in months, the old muscle memory feels reliable rather than like a ghost haunting them.\n      - The final straightaway arrives and they push harder, risk management giving way to controlled aggression; their body has endured, their technique has held, and the bike is responding with the responsiveness of their best seasons.\n      - They cross the finish line and immediately sense something is different‚Äîthe timing screen flashes a number that's competitive, genuinely competitive, not a valiant effort but an actual threat in the field.\n      - The pit crew erupts, their chief mechanic pumping a fist in recognition; sponsors suddenly lean forward with renewed interest; media is already preparing follow-up questions.\n      - The crowd's roar builds as replays flash on the jumbotron, slow-motion footage of their flawless line; strangers in the stands are high-fiving, people are chanting their name, and for a moment, the protagonist allows themselves to believe: the setback didn't define them, and they might actually belong here.\n    - Backstage between heats, a media scrum corners the protagonist‚Äîaggressive questions about their age, whispered doubts whether this is a genuine comeback or a desperate final gasp‚Äîwhile a key sponsor hovers nearby, visibly weighing whether to continue their support; the protagonist must navigate their authentic feelings of vulnerability against the need to project confidence, all while catching glimpses of how the rival handles similar scrutiny with dismissive ease.\n      - A veteran motorsports journalist asks a deliberately provocative question about whether 'guys your age belong on a track this competitive,' implying the protagonist is reckless or delusional.\n      - The protagonist feels a familiar hot flash of defensiveness but pauses‚Äîrecognizing this is exactly the moment their mental discipline is being tested; they choose a measured response that's honest without being desperate.\n      - A social media influencer asks about the strained relationship with their family member/close friend mentioned earlier, forcing the protagonist to confront publicly what they've been avoiding privately.\n      - The protagonist's longtime sponsor, watching from the edge of the crowd, exchanges a meaningful look‚Äîtheir body language signals uncertainty, and the protagonist realizes their performance in the next heat could determine whether the sponsorship survives.\n      - Nearby, the rival is being interviewed by a different outlet; they answer with cocky brevity and swaggering body language, making it appear effortless‚Äîa stark contrast to the protagonist's visible struggle to maintain composure.\n      - An older journalist, someone who covered the protagonist's glory days, asks a gentler question that unexpectedly validates the protagonist's journey, reminding them that skeptics have always existed; this moment of grace steadies their resolve.\n    - The rival storms into their heat with aggressive intensity; on the opening lap, they execute a dangerously tight line through the technical section the protagonist always preached against‚Äîa move that generates roars from the crowd but draws concerned shouts from pit crew and safety officials. As the heat unfolds, their explosive speed and fearless commitment to high-risk lines accumulate lap after lap, ultimately posting the fastest time of the day by a significant margin. The rival's riding style carries an edge of recklessness, almost contemptuous‚Äîless about mastering the course and more about conquering it through sheer audacity‚Äîrevealing a fundamental shift in philosophy from what the protagonist once taught.\n      - The rival enters their heat with visible tension in their jaw and shoulders, gripping their handlebars tightly during the pre-race ritual‚Äîa small tell that suggests they're not just confident but grimly determined to send a message.\n      - On the opening lap, the rival takes an impossibly tight line through the 'Devil's Elbow,' a technical section where the protagonist had always advocated for smooth, measured braking and a wider apex; the rival instead accelerates into it late, testing the edge of the tire's grip, forcing their bike into a near-sideways angle.\n      - The crowd erupts as the rival narrowly avoids catastrophe through sheer commitment, and commentators begin breathlessly narrating their performance with hyperbolic language‚Äî'absolute insanity,' 'pure aggression'‚Äîbuilding a legend in real time.\n      - A safety official on the pit radio flags the maneuver as 'reckless' and 'borderline dangerous,' but the rival's team responds with confidence, clearly having rehearsed this calculated risk during practice sessions.\n      - Lap by lap, the rival extends their lead, mixing moments of surgical precision with moments of edge-of-the-seat gambling, creating a riding style that feels almost performative‚Äîas if they're not just racing against the course but against an invisible audience.\n      - The protagonist watches from the pit area, their jaw tightening as they recognize the technical skill beneath the aggression, but also notice something unsettling: the rival is taking risks the protagonist would have explicitly warned against, suggesting either blind ambition, a desire to prove something beyond winning, or a deeper resentment that's bleeding into their competitive mindset.\n      - By the final lap, the rival posts a time that's nearly two full seconds ahead of the day's previous best, an almost insurmountable margin that draws a standing ovation and immediate replay analysis from the media.\n      - As the rival dismounts their bike, they briefly lock eyes with their team, and the protagonist catches a glimpse of something raw and hungry in their expression‚Äînot just the satisfaction of victory, but the primal satisfaction of having proven something, perhaps dominance over their former mentor's methods.\n    - Watching from the pit area, the protagonist studies the rival's heat with technical scrutiny‚Äîuntil a single corner midway through the track arrests their attention. The rival executes a radical late-apex turn through a technical section, banking deeper than the line the protagonist once taught them, carrying impossible speed through the apex before an explosive acceleration out. The protagonist's hands grip the pit fence. In that moment, they recognize the architecture of their old teachings beneath the maneuver‚Äîthe core philosophy intact‚Äîbut refined, synthesized with something entirely foreign. The realization lands like a physical blow: the rival hasn't rejected their mentorship; they've transcended it. The protagonist sees, with crystal clarity, that their former prot√©g√© is no longer the hungry student trying to match their teacher‚Äîthey've become a peer, perhaps already a superior craftsman. Pride and obsolescence war in their chest, and they understand that this rivalry has fundamentally shifted. This isn't about proving the student wrong anymore; it's about proving the teacher still belongs in the same frame at all.\n    - As both riders prepare for the semi-final heats, they inevitably cross paths in the paddock‚Äîa bottleneck near the fuel station and equipment racks. The protagonist sees the rival first, dirt still clinging to their gear from the explosive heat they just finished. Their eyes meet for a fraction too long to be accidental. The rival's jaw tightens, and then a smile curls at the corner of their mouth‚Äînot quite a grin, something more calculated. They offer a slow, deliberate nod, almost a bow of sorts, a gesture loaded with unspoken meaning: *I learned everything you taught me, and I've become something even better.* But in that same moment, the protagonist catches something else‚Äîa flicker of uncertainty in the rival's eyes, quickly masked, a hint that beneath the swagger lies the weight of proving themselves against their former teacher. The nod hangs between them, unanswered, and as the rival turns to leave, there's a barely perceptible hesitation in their step, as if they're unsure whether the protagonist will respond. The protagonist doesn't‚Äîthey simply hold the rival's gaze a moment longer, and nod back, a gesture that somehow encompasses both acknowledgment and an unspoken question: *What will you do when it matters most?*\n    - The protagonist's semi-final heat is strong but strategically run‚Äîthey resist the temptation to chase the rival's breakneck pace, instead riding with calculated precision and trusting the techniques they once preached to their prot√©g√©, ultimately finishing second but advancing to the final with their body intact and their mind sharper than ever. In the pit afterward, the protagonist catches their rival watching them with an expression that mingles grudging recognition with something closer to anger‚Äîthe prot√©g√© realizes their former mentor is no longer the hungry competitor chasing every gap, but something more dangerous: a rider who knows exactly what they're capable of and refuses to be baited into unnecessary risk.\n      - As the semi-final begins, the protagonist feels the physical strain immediately‚Äîtheir legs are burning from the qualifying rounds, and their shoulder (a lingering injury from the initial qualifier loss) throbs with each aggressive maneuver; they make a conscious choice to preserve energy rather than match the rival's explosive early assault.\n      - The rival hits the first set of jumps with reckless speed, but the protagonist takes the same section with textbook form, shaving a tenth of a second while keeping their heart rate sustainable‚Äîthe crowd misses the tactical brilliance, seeing only the safer line as timid.\n      - Midway through the heat, the protagonist experiments with a line they haven't tried in practice‚Äîa modification to brake point and apex that their aging reflexes hesitate on for a split second, then execute with surprising fluidity; it's a moment where experience and neurological plasticity align perfectly.\n      - The rival maintains their lead but the protagonist notices the distance isn't widening anymore; instead of panicking, the protagonist settles into a rhythm, lap after lap closing incrementally, never committing to the edge of disaster.\n      - In the final laps, the rival begins to show fatigue‚Äîthey're holding the accelerator longer, committing harder to maintain their margin, burning fuel reserves that should be reserved for the championship final; the protagonist, reading the signs, eases off slightly, ensuring they'll have something left.\n      - As they cross the finish line in second place, the protagonist feels not disappointment but a strange clarity‚Äîthis was the right race to run, and they proved something to themselves about wisdom versus hunger.\n      - Back in the pit area, the protagonist removes their helmet and glances toward the rival's pit crew; the rival is staring directly at them, chest heaving, visibly frustrated; when their eyes meet, the rival's expression hardens into something between resentment and reluctant respect‚Äîthey've just realized their former mentor is no longer trying to beat them through pure speed, but through understanding the sport at a deeper level than aggression alone can achieve.\n    - The rival wins their semi-final heat with another aggressive display, but this time the protagonist notices a telling falter on the second lap‚Äîa microsecond hesitation on the approach to the turn that their former prot√©g√© always nailed‚Äîbefore recovering with a touch too much throttle, overcompensating. The protagonist recognizes this as the mark of a rider fighting doubt, and in that instant, the dynamic shifts: the invincible rival becomes human, fallible, and perhaps as burdened by pressure as the protagonist. The realization hits like a revelation‚Äîthe prot√©g√©'s aggression and calculated tactics may not be signs of dominance, but of desperation to maintain superiority.\n  - In the final championship heat, the protagonist finds themselves trailing their rival through the most demanding section of the track; as desperation and instinct collide, they recognize an opportunity‚Äîa tighter, more aggressive line through a treacherous turn that could narrow the gap. Despite knowing their aging body has limits, and with the memory of their earlier humiliation burning fresh, the protagonist commits to the riskier trajectory, driven by a need to prove they haven't lost their edge and to reclaim dominance over the rider they once taught.\n    - As the final heat begins, the protagonist is immediately struck by the rival's refined technique‚Äîa near-perfect execution of the protagonist's own signature moves, particularly in the opening series of berms‚Äîand realizes with a jolt of complicated pride and dread that they're not just racing a competitor, but facing a living embodiment of their own legacy, executed with a hunger and precision that even surpasses their own aging body's capability.\n      - The first two heats of the race see the protagonist and rival running close; the protagonist tests the water with their signature line through the opening berms‚Äîa technique that was decades ahead of its time‚Äîand watches in real-time as their rival mirrors it, foot-perfect, with the added arrogance of a slight acceleration at the exit.\n      - The protagonist feels a sharp twist of dual emotion: genuine pride at seeing their teachings so thoroughly internalized, immediately tempered by the horrifying realization that their rival has had *years* to perfect and potentially improve upon these techniques, while the protagonist's body has been aging.\n      - In the third lap, the rival executes a variation on one of the protagonist's textbook moves‚Äîa late apex through turn seven that the protagonist invented but never had quite the throttle control at speed to nail consistently‚Äîand nails it, leaving the protagonist in their dust.\n      - The protagonist catches themselves almost nodding in grudging respect before catching their reflection in their peripheral mind's eye: here they are, watching their own student execute their own playbook better than they ever could, on the biggest stage, with the world watching.\n    - Midway through the race, the rival edges into a commanding lead, exploiting a technical section of track where youth and raw speed allow for tighter exits and faster acceleration; the protagonist's aging body protests‚Äîold injuries flare with each impact, their breathing labored, their lines marginally wider and slower. The crowd's roar, once directed at the protagonist, now surges toward the younger rider; cheers thin to scattered pockets as camera focus shifts. The protagonist catches glimpses in their peripheral vision: the rival's bike geometry is cleaner through the high-speed turns, their posture more economical. Trailing in the dust and losing ground, the protagonist confronts an unwelcome thought‚Äînot new, but sharper now‚Äîthat perhaps their body has finally cashed in on years of punishment, and they truly don't belong in this race anymore.\n      - The protagonist notices the rival executing a textbook line through the section‚Äîone the protagonist taught them years ago‚Äîperfected and refined to near-mechanical precision, which is both a source of perverse pride and a bitter reminder that the student has surpassed the teacher.\n      - Physical pain becomes undeniable: an old shoulder injury throbs with each downshift, the protagonist's throttle hand trembles slightly from fatigue, and they're forced to modulate their aggression in ways their younger self never had to consider.\n      - The crowd energy shift is visceral‚Äîthe protagonist hears the distinct pitch change in the roar, sees pit crew members on the rival's team jumping and cheering, while their own crew's body language tightens with concern.\n      - As the protagonist drifts slightly wide through a corner, fighting for traction, they have a sharp, unwanted moment of clarity: if they cannot close this gap on a technical section, they have no path to victory, and the humiliation from the regional qualifier will be eclipsed by an even more public failure.\n      - The rival, sensing the dominant position, begins to ride with visible confidence‚Äîlooser, more fluid‚Äîwhich paradoxically makes them faster, creating a psychological gap that mirrors the physical one on the track.\n    - As the protagonist leans hard into the track's most notorious turn‚Äîa long, steeply banked section taken at nearly 60 mph where line choice separates podium finishers from also-rans‚Äîthey feel the bike's rear wheel searching for grip at the edge of adhesion. In this fraction of a second, a familiar instinct fires: they recognize the optimal late-apex trajectory their rival is running, the one they themselves perfected and taught years ago. But beneath that standard line, born from their decades of track experience and knowledge of this circuit's unique surface deterioration, they sense something more: a tighter, earlier-entry path through the inside edge of the turn that would require absolute precision and faith in their reflexes. It's a line they've attempted before in practice, never in competition‚Äîone that shaves critical tenths but demands flawless execution through a series of rapid micro-corrections. The trade-off is unforgiving: maintain perfect throttle control and trust their aging body to manage the intense lateral g-forces, or stick with the safe rhythm they've proven they can execute. As the turn rushes toward them, every nerve in their body fires with both possibility and peril.\n    - For a heartbeat, the protagonist's hands tighten on the throttle‚Äîmuscle memory warring with mortality‚Äîas their body rebels against the commitment their mind is urging. They feel every past injury singing in their joints, the phantom ache of a shoulder that's never fully healed, and in that moment of hesitation, they catch a glimpse of their [family member name] in the grandstand, knuckles white around the rail, their face etched with worry rather than hope. And the protagonist realizes with crystalline clarity that this person chose to be here despite months of canceled dinners, missed conversations, and the growing distance between them‚Äîchosen to witness this moment. The protagonist is seized by a question that cuts deeper than any technical consideration: *Is reclaiming your legacy worth losing the person who always believed you had one?* The bike seems to slow, as if the world itself is offering them an exit, a graceful way to back off, to be the wise veteran rather than the desperate gambler.\n      - The protagonist's physical awareness sharpens: they feel their heart rate spiking, their breathing shallow, the bike's vibration traveling through tired muscles and old scars‚Äîeach sensation a whisper of their body's limits.\n      - Their eyes lock on the strained family member in the stands for just a fraction of a second‚Äîperhaps a spouse or adult child‚Äîand they see worry etched into their posture in a way that cuts deeper than any rival's smirk.\n      - A flash of memory intrudes: recent moments of conflict at home, the family member asking 'Is this really about proving something to the world, or proving something to yourself?'‚Äîwords the protagonist has been unable to answer.\n      - The protagonist's mind bifurcates: part of them calculates the risk (a mistake here means injury, possibly career-ending or worse), while another part hears the crowd's roar and feels the old hunger clawing at their chest.\n      - They sense the older, wiser version of themselves‚Äîthe one who mentored their rival with patience and philosophy‚Äîlooking on in judgment, asking silently: 'Is this how you want to be remembered? As the one who couldn't let go?'\n      - But beneath that hesitation, pride and ego coil tighter, whispering a different story: 'If you pull back now, you've already lost‚Äînot to your rival, but to time, to age, to fear.'\n    - As the turn approaches, the protagonist catches the rival's razor-thin smile‚Äîa micro-expression of supreme confidence born from months of media dismissal and trash talk‚Äîand a specific memory surfaces: an interview where the rival claimed they'd \"learned everything useful\" from their mentor, then had to \"actually learn how to win\"; the words that stung most at the time now ignite something primal. In that same breath, the protagonist hears their own voice echoing from years ago, speaking to their younger self at the very podium where they first mentored this same rival: \"The only limits are the ones you accept.\" They realize in a flash that they taught this philosophy to someone who used it to transcend them, and now that same mantra has become the justification they need‚Äîthe permission slip‚Äîto prove the philosophy still belongs to them.\n      - The protagonist glimpses the rival's micro-expression of supreme confidence‚Äîa slight, almost imperceptible smile‚Äîwhich crystallizes weeks of accumulated psychological warfare and public dismissals into a single, potent image\n      - A specific memory surfaces: a post-race interview where the rival claimed to have \"learned everything worth learning\" from their mentor, then pointedly added they'd \"had to actually learn how to win\"‚Äîa statement that wounded deeply and has replayed in the protagonist's mind ever since\n      - The protagonist recalls the exact moment and place they first taught this philosophy: standing at the same championship podium years earlier, telling their young prot√©g√©, \"The only limits are the ones you accept,\" watching the phrase take root in hungry, ambitious eyes\n      - A bittersweet realization hits: they taught this rider to transcend boundaries, and now that same philosophy has been used against them‚Äîtheir legacy has become the weapon aimed at their downfall\n      - In the present moment, the protagonist's internal conflict crystallizes: they can invoke the mantra as pure philosophy, or as a dangerous rationalization for ego-driven recklessness, and they no longer care which it is\n      - They feel the weight of reclaiming ownership of their own philosophy‚Äîthe need to prove that the words still belong to them, that they haven't become a cautionary tale of a teacher surpassed by their student\n    - The protagonist downshifts hard, feeling the engine's resistance against their intent, then leans into the bike with a commitment that borders on recklessness‚Äîbody weight forward, trust absolute‚Äîand twists the throttle wide open into the tighter, more dangerous line, crossing a threshold of no return in a decision born equally of tactical precision and emotional desperation, where calculated mastery and dangerous pride become indistinguishable.\n      - The protagonist's hands mechanically execute the downshift, a motion so ingrained from decades of racing that their conscious mind is free to scream objections even as their body commits; for an instant, they feel the rebellion‚Äîthe slight resistance of their aging wrists against the aggression they're demanding.\n      - Their eyes lock onto the tighter racing line ahead, measuring it with the precision only experience can provide, but their body is trembling with adrenaline and fear‚Äîthe dual sensations amplifying each other until they become indistinguishable from focus.\n      - As they lean the bike deeper into the turn, the margin for error shrinks to inches; they think of the crash that ended their mentor years ago, the rider who took the same kind of risk and paid the ultimate price, and for one suspended moment they could pull back, brake, play it safe.\n      - The rival remains ahead, unaware of the protagonist's gambit, riding the 'correct' line with textbook confidence‚Äîand seeing that unshakeable belief in the rival's body language, the protagonist feels something snap inside them: a refusal to lose to a rider who learned everything from them.\n      - They twist the throttle open with a finality that feels like a scream, committing fully to the line; there is no correcting this decision, no gentle recovery if they've misjudged‚Äîonly success or a catastrophic washout; in that instant of commitment, the protagonist stops calculating and simply surrenders to their instinct and their pride, experiencing a strange calm as fear and determination fuse into absolute presence.\n  - During the final championship heat, the protagonist pushes hard on the risky line but loses traction mid-turn, sending both rider and bike into a violent, slow-motion tumble; stunned and injured, they face a choice between limping off or remounting; they remount despite pain, losing multiple positions and seemingly out of contention; through sheer will and tactical precision, they steadily work their way back up the field, nearly catching the rival in the final laps; though falling just short of victory, their crash-and-comeback performance becomes the defining image of the race, embodying the resilience and fighting spirit their rival once learned from them.\n  - In the aftermath of the race, the protagonist grapples with bittersweet emotions as they realize true redemption wasn't about winning, but about reclaiming their identity as a racer and proving their resilience to themselves. When the rival encounters them in the pit area, a tense moment unfolds‚Äîone filled with acknowledgment rather than animosity‚Äîbefore the rival offers a gesture of respect that signals the wounds between them may finally be healing. Meanwhile, the strained personal relationship resurfaces as loved ones embrace them, forcing a reckoning about what obsession cost them and what recovery might look like moving forward.\n    - Immediately after remounting and crossing the finish line with a shattered bike and torn body, the protagonist rolls into the cooling zone where their team rushes to meet them; as they remove their helmet and breathe in real air for the first time, the full weight of what just happened crashes over them‚Äîthe adrenaline fades, the crowd noise becomes muted, and they realize with startling clarity that they didn't just survive the crash, they *thrived* in its aftermath, proving to themselves that age, doubt, and physical pain couldn't keep them from the line, and that the competitor inside them is still alive and unbroken.\n      - As the protagonist coasts toward the pit area, their hands are trembling on the handlebars‚Äînot from fear or exhaustion, but from a surge of adrenaline mixed with disbelief; they can barely comprehend that they stayed on the bike after such an impact, let alone pushed it back into a competitive line.\n      - The moment they remove their helmet and gulp fresh air, their vision swims slightly‚Äîthey taste blood and dirt, feel the burn of road rash across their shoulder, and their ribs scream with each breath, grounding them in the reality of what their body just endured.\n      - Their crew approaches with concern written across their faces, expecting trauma or despair, but the protagonist's eyes are wide and wet, locked on the horizon where they just crossed the finish line; they're not crying from defeat but from the overwhelming recognition that they *chose* to get back up when every instinct screamed to stay down.\n      - In that moment, a cascade of competing emotions hits them: relief (they didn't wreck out completely), pride (they remounted without hesitation), and a profound shift in self-perception‚Äîthey came to this race seeking external validation and somehow, mid-crash, that changed; now they're tasting something more honest: the undeniable proof that they're still a racer at their core, not a washed-up relic clinging to past glory.\n      - A crew member grabs their arm to steady them, concerned they might collapse, and the physical contact seems to trigger something deeper; the protagonist's shoulders shake as the dam breaks‚Äînot theatrical or performative, but a raw release of months of self-doubt, fear, and the crushing weight of thinking they were finished.\n    - In the medical tent, as trainers check for fractures and scrapes, the protagonist's hands won't stop shaking‚Äînot from pain or fear, but from the raw electricity still coursing through their body. A trainer asks where it hurts, but the protagonist barely hears them, too aware of their own breathing, their own heartbeat, the feel of dirt still embedded in their skin. When they catch their reflection in a nearby mirror, they expect to see the washed-up veteran they've been terrified of becoming. Instead, they see someone who just pushed a machine and a body to the edge and came back. The specific realization isn't grandiose: they didn't win; they know that. But sitting there, battered and alive, they understand with sudden clarity that somewhere between the starting line and the crash and the remount, they stopped racing to prove something to sponsors or competitors or the world. They were just *racing*‚Äîbecause that's what racers do, because they couldn't not do it, because the track is where they're most themselves. Everything else‚Äîthe redemption, the reputation, the sponsorship‚Äîthose were anchors they carried with them. But they just proved, in the most brutal way possible, that the racer was never gone. It was buried, maybe, but not gone.\n    - The rival approaches the pit area and, spotting the protagonist still sitting in the medical tent, cuts through the post-race chaos with deliberate purpose. Their eyes lock across the crowded space‚Äîa moment of recognition that stops both of them cold. The rival's face is flushed from exertion, sweat-slicked helmet in hand, and there's a visible war playing out behind their eyes: the sting of finishing second against something else entirely‚Äîa grudging acknowledgment of what they just witnessed. The protagonist, muddy and trembling from adrenaline crash, meets the rival's gaze without looking away; in that suspended moment, years of mentorship-turned-betrayal, rivalry, and carefully constructed resentment hang between them like a physical thing, but so does something unexpected: a flicker of mutual understanding, two riders who pushed past their limits and lived to see it.\n      - The rival makes their way through the post-race pit chaos‚Äîcongratulations from their team, media requests for interviews‚Äîbut their focus narrows entirely on the protagonist in the medical tent, suggesting this encounter matters more than basking in second place.\n      - Their eyes meet across the crowded space for the first time since the race ended; the rival has their helmet tucked under one arm, still in full gear, still radiating the intensity of competition.\n      - The protagonist is visibly vulnerable: muddy, breathing heavily, slumped slightly as the medical crew check them for injuries; they look diminished physically, but there's something in their posture that reads as unbroken.\n      - A flicker of confusion crosses the rival's face‚Äîthey expected to feel triumph seeing their former mentor in this state, but instead they're struck by the memory of what they just watched: the crash, the remount, the desperate heart on that track.\n      - The protagonist meets the rival's gaze steadily, too exhausted to perform their usual bravado; there's no defensive posture, no ego-driven aggression‚Äîjust two people who understand the cost of pushing a motorcycle and a body to the breaking point.\n      - In that beat of eye contact, the familiar anger and resentment are still there, but they're layered with something neither rider expected: recognition that the person in front of them‚Äîscarred, aging, still hungry‚Äîisn't the untouchable mentor anymore, but a fellow competitor with something to prove.\n      - The rival hesitates at the edge of the medical tent, wrestling with whether to cross that threshold; the choice to move forward is a small rebellion against years of calculated distance.\n    - The rival approaches the protagonist in the pit area, visibly wound-up from the adrenaline of their second-place finish, and after a moment of charged silence, offers a grudging compliment about the protagonist's remount‚Äîspecifically about how they executed the same high-risk line the protagonist had taught them years ago, but with a raw desperation and grit that even surpassed technical perfection. The rival's words reveal layers of conflicted emotion: admiration for the protagonist's refusal to quit, frustration that their former mentor still possesses that indefinable fire, and an unspoken acknowledgment that this moment‚Äîthe protagonist's comeback crash and remount‚Äîmight matter more to their journey than the rival's own second-place podium finish.\n      - The rival strides into the pit area, helmet under one arm, adrenaline still coursing through them; they spot the protagonist being examined by medical staff and hesitate, wrestling internally between walking past or confronting the moment.\n      - The rival closes the distance, and for a beat, neither speaks‚Äîjust the ambient noise of the track, crew chatter, and distant crowd. The protagonist looks up, and there's a flicker of wariness in their eyes, old resentment hovering between them.\n      - The rival's jaw tightens as they process what they just witnessed: their former mentor remounting after a catastrophic crash and riding through pain and injury to cross the finish line. It's the move the rival learned years ago, but executed with a desperation the rival‚Äîdespite their hunger and speed‚Äîhasn't yet needed to summon.\n      - The rival breaks the silence by referencing the specific technique: 'That line back at turn five... you taught me that move.' There's no praise in the tone, just observation, but underneath is an admission: they recognize themselves in what the protagonist just did.\n      - The rival continues, their voice quieter: 'I rode it faster today. But I didn't ride it like that.' The 'like that' carries weight‚Äîacknowledging the combination of skill, fear, and refusal to break that defined the protagonist's remount.\n      - The protagonist, still catching their breath and absorbing the pain, meets the rival's eyes and sees something unexpected: not victory, not vindication, but a mirror. The rival is talented enough to be dangerous, but young enough to still be learning what true survival looks like.\n      - For a moment, both riders exist in a shared understanding of what it costs to love this sport enough to destroy yourself for it. The rivalry hasn't disappeared, but it's been recalibrated by this moment of mutual, grudging recognition.\n    - The protagonist responds not with bravado but with genuine acknowledgment: noticing how the rival executed a signature technique with precision and heart‚Äîa move the protagonist taught them years ago‚Äîthe protagonist sees reflected in their prot√©g√©'s aggressive style all the hunger and determination they instilled, now refined into something formidable. With a nod and measured words, the protagonist admits they pushed harder than they expected to, but so did the rival; and that hunger, that refusal to quit, is exactly what the protagonist taught them to have. The moment is bittersweet‚Äîan admission that the rival has surpassed them, but also a quiet pride that their mentorship created something exceptional, even if it was channeled through defiance and desire to prove the teacher wrong.\n    - In a raw, unguarded moment in the pit area, the protagonist and rival drop their competitive armor‚Äîthe rival admits they watched the remount and recognized the exact desperation-fueled technique the protagonist taught them years ago, executed now with a rawness that transcended ego. The protagonist, breathless and humbled, acknowledges that they see how the rival has exceeded them, and that watching the younger rider push beyond their teachings is exactly what a true mentor hopes to witness. The rival, struck by this genuine pride rather than defensiveness, extends a hand‚Äînot in victory, but in recognition. This exchange signals that their fractured mentor-mentee bond, though still tender, is beginning to heal through mutual vulnerability and the shared understanding that the drive to be great can create both enemies and unexpected allies.\n    - Later, as the protagonist exits the medical tent with fresh bandages, they spot their estranged daughter/best friend/aging parent in the crowd‚Äîthe one they've been avoiding calls from for months. When their eyes meet, the protagonist instinctively wants to deflect with triumph about the race, but the loved one's expression‚Äîa mixture of relief, exhaustion, and barely concealed hurt‚Äîstops them cold. There's an awkward beat where neither moves, then the loved one steps closer and quietly lists the cost: the missed school recital, the cancelled promise to help move, the birthday dinner where the protagonist called mid-celebration to replay race footage, the weeks of one-word texts and broken plans. The protagonist's first instinct is to defend themselves (\"I was preparing,\" \"I had to focus\"), but as they see the hurt in the loved one's eyes, the weight of those excuses crumbles. For the first time, the protagonist sits with the uncomfortable truth that redemption at the track doesn't erase redemption owed at home.\n      - The loved one appears in the crowd‚Äîwhether daughter, closest friend, or aging parent‚Äîand the protagonist's first instinct is to hide their injuries and present a version of themselves that won the day, a reflex born from months of avoiding difficult conversations.\n      - The moment their eyes meet, the protagonist realizes this person has been watching from the stands the whole time, creating an internal collision of shame and hope‚Äîshame for having ignored their calls, hope that maybe witnessing the race might explain everything.\n      - The loved one breaks the silence with quiet specificity: they recount not just abstract hurt, but concrete moments‚Äîa child's school play the protagonist missed because of early morning training, a holiday dinner interrupted by a sponsor call, promises of 'next month' or 'after the regional qualifier' that never materialized.\n      - The protagonist's first response is defensive‚Äîa litany of explanations about sacrifice, commitment, and what it takes to compete at this level‚Äîbut their voice wavers as they hear how hollow the justifications sound.\n      - The loved one, wounded but not cruel, holds up a hand and asks the hardest question: 'Did any of it matter if you didn't have anyone to share it with?' The protagonist has no answer.\n      - In the silence that follows, the protagonist experiences a moment of true reckoning: the crash on the track was visible and survivable, but the crash in their personal life has been ongoing and unaddressed.\n      - The loved one softens slightly, acknowledging that they see the protagonist's struggle and perhaps even respects the determination, but establishes a boundary: 'I can't keep being left behind while you figure out who you are. I need to know if I matter to you.'\n      - The protagonist, still in shock and emotionally raw from the race, admits they don't have all the answers yet, but for the first time, the focus shifts from what they need to prove to themselves to what needs to be rebuilt with the people who matter most.\n    - The protagonist admits they still need the sport, but realizes that redemption isn't about erasing the fall or proving something to the world‚Äîit's about integrating all versions of themselves: the mentor who believed in possibility, the competitor who needed to prove their worth, the vulnerable person who crashed, and the resilient one who remounted. They acknowledge the cost this integration demands: honesty about their limits, investment in the relationships they've neglected, and acceptance that the next chapter of their racing career‚Äîif there is one‚Äîmust coexist with these other identities, not consume them.\n      - The protagonist sits alone (or with the loved one) and explicitly articulates each version of themselves: naming the mentor who once mentored with wisdom, the ego-driven competitor who needed external validation, the broken person who feared they were finished, and the stubborn fighter who refused to stay down‚Äîrecognizing each was real, necessary, and incomplete on its own.\n      - The protagonist grapples with a hard truth: by focusing only on the competitor version for so long, they abandoned the mentor and erased the vulnerability, which poisoned their relationship with both the rival and their loved ones.\n      - They vocalize a specific sacrifice or broken promise to the loved one, not as excuse but as acknowledgment‚Äîcreating an opening for the conversation about what balance might look like moving forward.\n      - The protagonist expresses their continued need for racing, but reframes it: not as an escape or a way to outrun their demons, but as a place where they can test themselves and stay alive‚Äîsomething they're willing to pursue only if they can do it honestly and without sacrificing the people who matter.\n      - A moment where the protagonist imagines (or discusses) what the next phase of their relationship with the rival could be: mentoring again, perhaps, but as equals and learning partners rather than as proof of superiority; or simply as two riders who respect each other's journey.\n      - The protagonist accepts a concrete next step‚Äîwhether it's scheduling time with the loved one, having a follow-up conversation with the rival, or making a decision about whether they'll pursue racing at this level again‚Äîthat signals they're beginning to act on this integrated understanding rather than just philosophizing about it.\n    - The story closes with the protagonist stepping away from the championship podium and trophy presentation, choosing instead to find the rival in the garage and suggest a future mentorship‚Äîthis time built on mutual respect and honesty rather than ego. As they walk together through the pits, their loved one joins them, and the protagonist extends a genuine invitation to be part of their life again, acknowledging that the real victory is learning to want both the sport and the people who matter. In the final image, the protagonist sits on their bike at the edge of the track as sunset paints the sky‚Äîscarred but present, no longer running from themselves or toward something just out of reach.\n      - The protagonist stands near the podium as awards are being distributed, but feels a pull away from the spectacle‚Äîthey don't climb the steps, they walk off the track toward the garage.\n      - They find their rival in the garage, still in gear, cooling down from the adrenaline of second place; there's a moment of mutual recognition that both of them left everything on the track.\n      - The protagonist makes a vulnerable offer: to help the rival grow as a racer and as a mentor to the next generation, doing it 'the right way' this time‚Äîwithout the bitterness, without the pressure to break them.\n      - The rival accepts, perhaps with a smile that suggests they're ready to move beyond the old rivalry; they acknowledge that being pushed by the protagonist, even now, matters.\n      - As the two riders walk through the pits together, the protagonist's loved one appears in the distance, uncertainty written across their face‚Äîunsure if they're still unwanted.\n      - The protagonist calls them over and introduces them to the rival, then tells the loved one directly: 'I can't promise I won't still love this sport more than anything else, but I can promise not to shut you out while I'm chasing it.'\n      - This moment isn't a complete healing‚Äîit's fragile and real‚Äîbut it signals the beginning of something different, more honest than the obsessive devotion that came before.\n      - In the final scene, after the crowds disperse, the protagonist walks their bike to the edge of the track and sits on it as the sun dips toward the horizon; the track is quiet now, just them and the dirt.\n      - They look out at the empty course, not as a battlefield to conquer, but as home‚Äîa place they can return to, again and again, without it having to validate or redeem them.\n      - The camera pulls back to show them silhouetted against the sunset: a solitary figure who has learned to sit still with who they are, broken equipment and all.\n\nDid a total of 76 extractions.\n\n\n\n\n\n\n\n\nWarningAuthor Commentary\n\n\n\nI can‚Äôt bring myself to read the whole thing above, but the parts I‚Äôve read are cringeworthy clich√©.\nStill, the recursive generation is cool!",
    "crumbs": [
      "üöÄ Quickstart",
      "‚öôÔ∏è Agent Features",
      "Recursive Agent"
    ]
  },
  {
    "objectID": "agent_features/recursive_agent.html#other-references",
    "href": "agent_features/recursive_agent.html#other-references",
    "title": "Recursive Agent",
    "section": "Other References",
    "text": "Other References\n\n\n\n\n\n\nNoteLasagna Recursive Planning Agent (LRPA)\n\n\n\nAnother powerful example of recursive agents is the Lasagna Recursive Planning Agent (LRPA), so check that out too!",
    "crumbs": [
      "üöÄ Quickstart",
      "‚öôÔ∏è Agent Features",
      "Recursive Agent"
    ]
  },
  {
    "objectID": "agent_features/caching.html",
    "href": "agent_features/caching.html",
    "title": "Caching Decorator",
    "section": "",
    "text": "# üöß Under Construction üèóÔ∏è\n\nLasagna AI provides easy & pluggable caching, so you can save money (and time) in environments where you get the same prompts over-and-over. üè¶",
    "crumbs": [
      "üöÄ Quickstart",
      "‚öôÔ∏è Agent Features",
      "Caching Decorator"
    ]
  },
  {
    "objectID": "agent_features/functional_agents.html",
    "href": "agent_features/functional_agents.html",
    "title": "Functional Agents",
    "section": "",
    "text": "# üöß Under Construction üèóÔ∏è\n\nDocument:\n\nbuild_simple_agent,\nbuild_extraction_agent,\nbuild_agent_chainer,\nbuild_agent_router,\nbuild_static_output_agent,\nbuild_parallelizer &lt;‚Äì new idea",
    "crumbs": [
      "üöÄ Quickstart",
      "‚öôÔ∏è Agent Features",
      "Functional Agents"
    ]
  },
  {
    "objectID": "agent_features/structured_output.html",
    "href": "agent_features/structured_output.html",
    "title": "Structured Output",
    "section": "",
    "text": "Structured output (aka ‚Äúextraction‚Äù) is the most powerful way to leverage generative AI. üí™\n# This page will use the following imports:\n\nfrom lasagna import Model, EventCallback, AgentRun\nfrom lasagna import (\n    extract_last_message,\n    extraction,\n    flat_messages,\n    noop_callback,\n    easy_extract,\n)\nfrom lasagna import known_models\nfrom lasagna.tui import tui_input_loop\n\nimport os\n\nfrom pydantic import BaseModel, Field\n\nfrom dotenv import load_dotenv\nWe need to set up our ‚Äúbinder‚Äù (see the quickstart guide for what this is).\nload_dotenv()\n\nif os.environ.get('OPENAI_API_KEY'):\n    print('Using OpenAI')\n    binder = known_models.openai_gpt_5_mini_binder\n\nelif os.environ.get('ANTHROPIC_API_KEY'):\n    print('Using Anthropic')\n    binder = known_models.anthropic_claude_sonnet_4_5_binder\n\nelse:\n    assert False, \"Neither OPENAI_API_KEY nor ANTHROPIC_API_KEY is set! We need at least one to do this demo.\"\n\nUsing OpenAI",
    "crumbs": [
      "üöÄ Quickstart",
      "‚öôÔ∏è Agent Features",
      "Structured Output"
    ]
  },
  {
    "objectID": "agent_features/structured_output.html#the-power-of-structured-output",
    "href": "agent_features/structured_output.html#the-power-of-structured-output",
    "title": "Structured Output",
    "section": "The Power of Structured Output",
    "text": "The Power of Structured Output\nConsider this‚Ä¶\n\nThe most popular agentic use-case right now is Retrieval Augmented Generation (RAG).\nRAG is just an example of tool calling.\nTool calling is just an example of structured output.\n\nStructured output is the real hero behind the agentic revolution that is to come. ü§Øü§Øü§Ø",
    "crumbs": [
      "üöÄ Quickstart",
      "‚öôÔ∏è Agent Features",
      "Structured Output"
    ]
  },
  {
    "objectID": "agent_features/structured_output.html#about-grammars",
    "href": "agent_features/structured_output.html#about-grammars",
    "title": "Structured Output",
    "section": "About Grammars",
    "text": "About Grammars\nGenerative models that support grammar-restricted generation are the best at doing structured output. Such models guarantee that your specified output schema* will be adhered to.\n\n\n\n\n\n\nWarning* Schema != Content\n\n\n\nWhile formal grammars guarantee that output schemas are followed, that should not be confused with correct output.\nFor example, if the schema says that age should be extracted as an integer, then you can be sure you‚Äôll get an age as an integer. But it may not be the correct value!\nStill, grammars are much better than no grammars, so you‚Äôll want to favor generative AI models that can follow a grammar.",
    "crumbs": [
      "üöÄ Quickstart",
      "‚öôÔ∏è Agent Features",
      "Structured Output"
    ]
  },
  {
    "objectID": "agent_features/structured_output.html#structured-output-in-lasagna-ai",
    "href": "agent_features/structured_output.html#structured-output-in-lasagna-ai",
    "title": "Structured Output",
    "section": "Structured Output in Lasagna AI",
    "text": "Structured Output in Lasagna AI\nIn Lasagna AI, you specify your desired output schema as a combination of Pydantic types and TypedDict types.\nHere‚Äôs an example, using Pydantic types:\n\nclass LinguisticConstruction(BaseModel):\n    subject: str = Field(description='the linguistic subject of the construction')\n    verb: str    = Field(description='the linguistic verb of the construction')\n    object: str  = Field(description='the linguistic object of the construction')\n\nclass ExtractionModel(BaseModel):\n    summary: str\n    constructions: list[LinguisticConstruction]\n\n\n\n\n\n\n\nWarningWe Recommend Pydantic\n\n\n\nPydantic types are preferred over TypedDict, because they let you pass string descriptions to each parameter (which, in turn, go into the model‚Äôs prompt).\n\n\nThen, inside your agent, you pass your desired output type to model.extract(...).\nSee an example agent below:\n\nasync def linguistic_extraction_agent(\n    model: Model,\n    event_callback: EventCallback,\n    prev_runs: list[AgentRun],\n) -&gt; AgentRun:\n    # Get **ONLY** the last message from the user:\n    last_message = extract_last_message(prev_runs, from_tools=False, from_extraction=False)\n    assert last_message['role'] == 'human'\n\n    # Do structured output over the user's message:\n    new_message, result = await model.extract(\n        event_callback,\n        messages = [last_message],\n        extraction_type = ExtractionModel,\n    )\n    assert isinstance(result, ExtractionModel)\n\n    # Wrap the new messages into an `AgentRun` result:\n    return extraction('linguistic_extraction_agent', [new_message], result)\n\n\nPROMPT = \"\"\"\nHey diddle diddle,\nThe cat and the fiddle,\nThe cow jumped over the moon;\nThe little dog laughed\nTo see such sport,\nAnd the dish ran away with the spoon.\n\"\"\".strip()\n\n\nprev_runs: list[AgentRun] = [\n    flat_messages(\n        'input',\n        [\n            {\n                'role': 'human',\n                'text': PROMPT,\n            },\n        ],\n    ),\n]\n\nbound_agent = binder(linguistic_extraction_agent)\n\nagent_run = await bound_agent(noop_callback, prev_runs)  # type: ignore[top-level-await]\n\nassert agent_run['type'] == 'extraction'\nresult = agent_run['result']\nassert isinstance(result, ExtractionModel)\n\nprint(type(result))\nprint(result.summary)\n\nfor construction in result.constructions:\n    print('   ', construction)\n\n&lt;class '__main__.ExtractionModel'&gt;\nExtracted main clauses and simple subject-verb-object (or equivalent) constructions from the nursery rhyme 'Hey Diddle Diddle'. Identifies interjection, elliptical phrases, finite clauses, intransitive verbs, an infinitival clause, and a prepositional complement.\n    subject='(interjection)' verb='hey diddle (exclamation)' object=''\n    subject='the cat and the fiddle' verb='(elliptical/none)' object=''\n    subject='the cow' verb='jumped' object='over the moon'\n    subject='the little dog' verb='laughed' object=''\n    subject='(implicit subject for infinitive)' verb='to see' object='such sport'\n    subject='the dish' verb='ran away' object='with the spoon'",
    "crumbs": [
      "üöÄ Quickstart",
      "‚öôÔ∏è Agent Features",
      "Structured Output"
    ]
  },
  {
    "objectID": "agent_features/structured_output.html#easy-extraction",
    "href": "agent_features/structured_output.html#easy-extraction",
    "title": "Structured Output",
    "section": "Easy Extraction",
    "text": "Easy Extraction\nThe steps above are designed such that you can layer agents. There‚Äôs a lot of ‚Äúwrapping‚Äù and ‚Äúunwrapping‚Äù that goes on.\nHowever, that can be overkill if you only want a simple (‚Äúeasy‚Äù) extraction method.\nHere‚Äôs an ‚Äúeasy‚Äù way to do it, if you don‚Äôt care about building complex layered agents:\n\nresult = await easy_extract(binder, PROMPT, ExtractionModel)  # type: ignore[top-level-await]\n\nassert isinstance(result, ExtractionModel)\n\nprint(type(result))\nprint(result.summary)\n\nfor construction in result.constructions:\n    print('   ', construction)\n\n&lt;class '__main__.ExtractionModel'&gt;\nExtract basic subject-verb-object and notable clause constructions from the nursery rhyme 'Hey Diddle Diddle'.\n    subject=\"(exclamation) 'Hey'\" verb='diddle (vocative/nonsense)' object=''\n    subject='The cat and the fiddle' verb='' object=''\n    subject='The cow' verb='jumped' object='over the moon'\n    subject='The little dog' verb='laughed' object=''\n    subject='(implicit: the little dog)' verb='to see / see' object='such sport'\n    subject='The dish' verb='ran away' object='with the spoon'",
    "crumbs": [
      "üöÄ Quickstart",
      "‚öôÔ∏è Agent Features",
      "Structured Output"
    ]
  },
  {
    "objectID": "agent_features/structured_output.html#more-opining-on-structured-output",
    "href": "agent_features/structured_output.html#more-opining-on-structured-output",
    "title": "Structured Output",
    "section": "More Opining on Structured Output",
    "text": "More Opining on Structured Output\nRobust software often starts with sane data formats, from which logic flows naturally. Think SQL schemas. Think algebraic data types.\nStructured output is similar in spirit. You begin with the output schema, and you build your prompt around that.",
    "crumbs": [
      "üöÄ Quickstart",
      "‚öôÔ∏è Agent Features",
      "Structured Output"
    ]
  },
  {
    "objectID": "why_lasagna_ai/lasagna_vs_llamaindex.html",
    "href": "why_lasagna_ai/lasagna_vs_llamaindex.html",
    "title": "Lasagna vs LlamaIndex",
    "section": "",
    "text": "Aspect\nLasagna AI\nLlamaIndex\n\n\n\n\nParadigm\nFunctional-first\nOOP-first\n\n\nData Flow\nImmutable AgentRun structures\nMutable indexes and engines\n\n\nComposition\nAgent layering\nQuery engine chaining\n\n\nType Safety\n100% type hinted\nMixed type coverage\n\n\nAsync Support\nAsync-first architecture\nAdded async support over time\n\n\nProduction Focus\nDesigned for production\nAdded production features later\n\n\nEcosystem Size\nSmaller, focused\nLarge, comprehensive\n\n\nCore Focus\nAgent composition\nData orchestration\n\n\nPrimary Use Case\nMulti-agent workflows\nRAG and knowledge retrieval\n\n\nCore Abstraction\nAgent (composable callable)\nIndex + QueryEngine\n\n\nMental Model\n‚ÄúCompose agents like functions‚Äù\n‚ÄúConnect LLMs to data sources‚Äù",
    "crumbs": [
      "üöÄ Quickstart",
      "‚ù§Ô∏è Why Lasagna AI?",
      "Lasagna vs LlamaIndex"
    ]
  },
  {
    "objectID": "why_lasagna_ai/lasagna_vs_llamaindex.html#quick-comparison",
    "href": "why_lasagna_ai/lasagna_vs_llamaindex.html#quick-comparison",
    "title": "Lasagna vs LlamaIndex",
    "section": "",
    "text": "Aspect\nLasagna AI\nLlamaIndex\n\n\n\n\nParadigm\nFunctional-first\nOOP-first\n\n\nData Flow\nImmutable AgentRun structures\nMutable indexes and engines\n\n\nComposition\nAgent layering\nQuery engine chaining\n\n\nType Safety\n100% type hinted\nMixed type coverage\n\n\nAsync Support\nAsync-first architecture\nAdded async support over time\n\n\nProduction Focus\nDesigned for production\nAdded production features later\n\n\nEcosystem Size\nSmaller, focused\nLarge, comprehensive\n\n\nCore Focus\nAgent composition\nData orchestration\n\n\nPrimary Use Case\nMulti-agent workflows\nRAG and knowledge retrieval\n\n\nCore Abstraction\nAgent (composable callable)\nIndex + QueryEngine\n\n\nMental Model\n‚ÄúCompose agents like functions‚Äù\n‚ÄúConnect LLMs to data sources‚Äù",
    "crumbs": [
      "üöÄ Quickstart",
      "‚ù§Ô∏è Why Lasagna AI?",
      "Lasagna vs LlamaIndex"
    ]
  },
  {
    "objectID": "why_lasagna_ai/lasagna_vs_llamaindex.html#architectural-philosophy",
    "href": "why_lasagna_ai/lasagna_vs_llamaindex.html#architectural-philosophy",
    "title": "Lasagna vs LlamaIndex",
    "section": "Architectural Philosophy",
    "text": "Architectural Philosophy\nLasagna AI: Agent-Centric + Functional\n\nDesigned around agent composition - building simple agents and layering them into complex systems\nFunctional programming approach with immutable data structures\nEverything flows through standardized AgentRun types\n‚ÄúBuild focused agents, compose them into multi-agent systems‚Äù\n\nLlamaIndex: Data-Centric + Object-Oriented\n\nDesigned around data orchestration - connecting LLMs to data sources efficiently\nObject-oriented approach with inheritance hierarchies\nFocus on indexing, retrieval, and query patterns\n‚ÄúIndex your data, query it intelligently‚Äù",
    "crumbs": [
      "üöÄ Quickstart",
      "‚ù§Ô∏è Why Lasagna AI?",
      "Lasagna vs LlamaIndex"
    ]
  },
  {
    "objectID": "why_lasagna_ai/lasagna_vs_llamaindex.html#core-abstractions",
    "href": "why_lasagna_ai/lasagna_vs_llamaindex.html#core-abstractions",
    "title": "Lasagna vs LlamaIndex",
    "section": "Core Abstractions",
    "text": "Core Abstractions\nLasagna AI:\n\nAgent: Composable callable with standard signature (model, callback, prev_runs) -&gt; AgentRun\nAgentRun: Immutable, recursive data structure capturing execution results\nModel binding: Separates agent logic from model choice\nAgent routing, delegation, and specialization patterns\n\nLlamaIndex:\n\nIndex: Data structure for organizing and retrieving information\nQueryEngine: Interface for answering questions over indexed data\nChatEngine: Conversational interface with memory\nDocument processing, embedding, and retrieval pipelines",
    "crumbs": [
      "üöÄ Quickstart",
      "‚ù§Ô∏è Why Lasagna AI?",
      "Lasagna vs LlamaIndex"
    ]
  },
  {
    "objectID": "why_lasagna_ai/lasagna_vs_llamaindex.html#design-patterns",
    "href": "why_lasagna_ai/lasagna_vs_llamaindex.html#design-patterns",
    "title": "Lasagna vs LlamaIndex",
    "section": "Design Patterns",
    "text": "Design Patterns\nLasagna AI:\n\nFunctional composition - agents as pure functions\nImmutable data flow - AgentRun structures never change\nType-first design - static analysis catches integration errors\nRecursive execution tracking - full visibility into agent call trees\n\nLlamaIndex:\n\nService-oriented architecture - indexes and engines as services\nInheritance hierarchies - different index types extend base classes\nMutable state management - indexes and engines maintain state\nPipeline patterns - data flows through processing stages",
    "crumbs": [
      "üöÄ Quickstart",
      "‚ù§Ô∏è Why Lasagna AI?",
      "Lasagna vs LlamaIndex"
    ]
  },
  {
    "objectID": "why_lasagna_ai/lasagna_vs_llamaindex.html#production-readiness",
    "href": "why_lasagna_ai/lasagna_vs_llamaindex.html#production-readiness",
    "title": "Lasagna vs LlamaIndex",
    "section": "Production Readiness",
    "text": "Production Readiness\nLasagna AI:\n\nAsync-first architecture designed for production scalability\nComprehensive type safety (100% type hinted)\nBuilt-in cost tracking with token usage preservation\nImmutable design prevents race conditions in concurrent environments\nJSON-serializable data structures for easy storage/transmission\n\nLlamaIndex:\n\nAsync support added over time, not always consistent\nMixed type coverage - some components well-typed, others not\nCost tracking available but not as integrated\nMature ecosystem with battle-tested components\nExtensive integrations for production data sources",
    "crumbs": [
      "üöÄ Quickstart",
      "‚ù§Ô∏è Why Lasagna AI?",
      "Lasagna vs LlamaIndex"
    ]
  },
  {
    "objectID": "why_lasagna_ai/lasagna_vs_llamaindex.html#use-case-optimization",
    "href": "why_lasagna_ai/lasagna_vs_llamaindex.html#use-case-optimization",
    "title": "Lasagna vs LlamaIndex",
    "section": "Use Case Optimization",
    "text": "Use Case Optimization\nLasagna AI:\n\nComplex multi-agent workflows where different agents specialize\nAgent routing and delegation based on intent or context\nSystems requiring cost tracking across agent interactions\nProduction deployments with reliability and observability needs\nScenarios where agents need to coordinate, split tasks, or work in parallel\n\nLlamaIndex:\n\nRAG (Retrieval Augmented Generation) over document collections\nKnowledge base question-answering systems\nDocument processing and indexing pipelines\nData ingestion from various sources (PDFs, databases, APIs)\nQuery-response patterns over structured and unstructured data",
    "crumbs": [
      "üöÄ Quickstart",
      "‚ù§Ô∏è Why Lasagna AI?",
      "Lasagna vs LlamaIndex"
    ]
  },
  {
    "objectID": "why_lasagna_ai/lasagna_vs_llamaindex.html#trade-offs",
    "href": "why_lasagna_ai/lasagna_vs_llamaindex.html#trade-offs",
    "title": "Lasagna vs LlamaIndex",
    "section": "Trade-offs",
    "text": "Trade-offs\n\nLasagna AI Advantages\n\n‚úÖ Superior multi-agent coordination - natural composition patterns\n‚úÖ Type safety catches errors at development time\n‚úÖ Clean functional architecture - easier to reason about complex flows\n‚úÖ Built-in observability - comprehensive cost and execution tracking\n‚úÖ Production-first design - async, immutable, reliable\n‚úÖ Model flexibility - easy to swap providers without changing agent logic\n\n\n\nLasagna AI Disadvantages\n\n‚ùå Smaller ecosystem for data connectors and integrations\n‚ùå Learning curve for functional programming paradigm\n‚ùå Limited RAG tooling compared to LlamaIndex‚Äôs specialized features\n‚ùå Less mature document processing and indexing capabilities\n\n\n\nLlamaIndex Advantages\n\n‚úÖ Specialized for RAG - best-in-class retrieval and indexing\n‚úÖ Rich data ecosystem - connectors for every data source imaginable\n‚úÖ Mature document processing - PDFs, tables, images, structured data\n‚úÖ Advanced retrieval - hybrid search, re-ranking, query transformations\n‚úÖ Large community and extensive documentation\n‚úÖ Familiar patterns for developers with OOP background\n\n\n\nLlamaIndex Disadvantages\n\n‚ùå Complex multi-agent coordination - not the primary design focus\n‚ùå Mutable state issues in complex concurrent scenarios\n‚ùå Inconsistent async patterns across the large codebase\n‚ùå Less type safety - more runtime errors possible",
    "crumbs": [
      "üöÄ Quickstart",
      "‚ù§Ô∏è Why Lasagna AI?",
      "Lasagna vs LlamaIndex"
    ]
  },
  {
    "objectID": "why_lasagna_ai/lasagna_vs_llamaindex.html#when-to-choose-each",
    "href": "why_lasagna_ai/lasagna_vs_llamaindex.html#when-to-choose-each",
    "title": "Lasagna vs LlamaIndex",
    "section": "When to Choose Each",
    "text": "When to Choose Each\n\nChoose Lasagna AI When:\nü§ñ Multi-Agent Systems: You need different AI agents to specialize, coordinate, and delegate tasks\nüèóÔ∏è Complex Workflows: Your system involves routing, parallel processing, or sophisticated agent interactions\nüè¢ Production Reliability: You‚Äôre building enterprise systems that need predictable behavior and observability\nüí∞ Cost Visibility: You need detailed tracking of AI usage costs across complex agent hierarchies\nüîß Type Safety: You want to catch integration errors at development time, not runtime\n‚ö° High Concurrency: Your system needs to handle many simultaneous agent operations safely\n\n\nChoose LlamaIndex When:\nüìö RAG is Primary Use Case: You‚Äôre building question-answering systems over document collections\nüóÇÔ∏è Rich Data Sources: You need to index data from many different formats and systems\nüîç Advanced Retrieval: You need sophisticated search, re-ranking, or query transformation capabilities\nüìÑ Document Processing: Your system heavily involves PDFs, tables, images, or structured documents\nüöÄ Rapid Prototyping: You want to quickly build and test RAG applications\nüåê Ecosystem Breadth: You need pre-built integrations with vector databases, embedding models, etc.",
    "crumbs": [
      "üöÄ Quickstart",
      "‚ù§Ô∏è Why Lasagna AI?",
      "Lasagna vs LlamaIndex"
    ]
  },
  {
    "objectID": "why_lasagna_ai/lasagna_vs_llamaindex.html#the-bottom-line",
    "href": "why_lasagna_ai/lasagna_vs_llamaindex.html#the-bottom-line",
    "title": "Lasagna vs LlamaIndex",
    "section": "The Bottom Line",
    "text": "The Bottom Line\nLasagna AI was designed for the multi-agent future - where you have specialized AI agents that need to coordinate complex workflows. It prioritizes clean composition patterns and production reliability.\nLlamaIndex was designed for the RAG present - where you need to connect LLMs to your data sources efficiently. It prioritizes rich data integrations and retrieval sophistication.\nThe fundamental question is what you‚Äôre building:\n\nBuilding a multi-agent system where agents route, delegate, and coordinate? ‚Üí Lasagna AI\nBuilding a knowledge retrieval system over documents and data sources? ‚Üí LlamaIndex\n\nNote: There is overlap in the RAG space where both could work, but: - LlamaIndex will give you more sophisticated retrieval out-of-the-box - Lasagna AI will give you cleaner patterns if your RAG system needs complex agent coordination\nBoth are excellent tools that solve different problems well. The choice depends on whether your primary complexity is in agent coordination (Lasagna) or data orchestration (LlamaIndex).\n__\nDisclaimer: This comparison was AI-generated based on the documentation of both libraries, then modified slightly to fix formatting.",
    "crumbs": [
      "üöÄ Quickstart",
      "‚ù§Ô∏è Why Lasagna AI?",
      "Lasagna vs LlamaIndex"
    ]
  },
  {
    "objectID": "deployment/streaming_and_events.html",
    "href": "deployment/streaming_and_events.html",
    "title": "Streaming & Events",
    "section": "",
    "text": "# üöß Under Construction üèóÔ∏è\n\n\nStreaming Agent Output\nBecause Lasagna AI is built on asyncio, it‚Äôs trivial to pump events up through the callstack so you can have real-time streaming! We try to make events for everything, allowing you to pick-and-choose what you want to look for.\n\n# TODO\n\n\n\nAgent Start/Stop Events\nSince agents can be layered, and agents can call other agents, we sometimes want to track when agents start/stop their execution.\n\n# TODO\n\n\n\nProgress Events\n\n# TODO\n\n\n\nCustom Events\n\n# TODO",
    "crumbs": [
      "üöÄ Quickstart",
      "‚òÅÔ∏è How to Deploy",
      "Streaming & Events"
    ]
  },
  {
    "objectID": "misc/python_asyncio.html",
    "href": "misc/python_asyncio.html",
    "title": "Intro to Python Asyncio",
    "section": "",
    "text": "Lasagna AI is production-focused and fully async, so it plays nicely with remote APIs and modern Python web frameworks. If asyncio is new to you, read Python & Async Simplified.\n\n# üöß Under Construction üèóÔ∏è",
    "crumbs": [
      "üöÄ Quickstart",
      "ü§î Misc Topics",
      "Intro to Python Asyncio"
    ]
  },
  {
    "objectID": "misc/python_type_hints.html",
    "href": "misc/python_type_hints.html",
    "title": "Intro to Python Type Hints",
    "section": "",
    "text": "# üöß Under Construction üèóÔ∏è",
    "crumbs": [
      "üöÄ Quickstart",
      "ü§î Misc Topics",
      "Intro to Python Type Hints"
    ]
  },
  {
    "objectID": "what_is_an_agent/agent.html",
    "href": "what_is_an_agent/agent.html",
    "title": "The Lasagna Agent",
    "section": "",
    "text": "In Lasagna AI, an agent is a unit of AI-powered reasoning that performs specific work. Agents are the building blocks of your AI system ‚Äî you compose simple agents together to create powerful multi-agent workflows.\n# This page will use the following imports:\n\nfrom lasagna import Model, EventCallback, AgentRun\nfrom lasagna import (\n    recursive_extract_messages,\n    extract_last_message,\n    override_system_prompt,\n    flat_messages,\n    parallel_runs,\n    chained_runs,\n    extraction,\n)\nfrom lasagna import known_models\nfrom lasagna.tui import tui_input_loop\n\nimport os\nimport re\nfrom enum import Enum\nfrom pydantic import BaseModel\n\nfrom dotenv import load_dotenv",
    "crumbs": [
      "üöÄ Quickstart",
      "ü§ñ What is an Agent?",
      "The Lasagna Agent"
    ]
  },
  {
    "objectID": "what_is_an_agent/agent.html#what-is-an-agent",
    "href": "what_is_an_agent/agent.html#what-is-an-agent",
    "title": "The Lasagna Agent",
    "section": "What is an Agent?",
    "text": "What is an Agent?\nA piece of software is an ‚Äúagent‚Äù if it displays some sort of ‚Äúagency.‚Äù Circular, yes, so let‚Äôs keep going‚Ä¶\n\nWhat is Agency?\nAgency is the ability to act on one‚Äôs own behalf. That is, software has agency if it is allowed to decide and act on its own.\n\nSoftware that computes œÄ? Not much agency. It does, and always will do, one thing.\nSoftware that organizes your calendar without your input? Lots of agency!\n\n\n\nWhat is an AI Agent?\nThe phrase ‚ÄúAI Agent‚Äù has risen in popularity since ~2024. Typically, when people use this phrase, they mean a piece of software that uses a Large Language Model (LLM*) and has some tool calling capability so that it can affect the world (e.g.¬†send emails, query for today‚Äôs news, organize your calendar, etc.)\nThis is consistent with the idea of agency from above. An LLM, on its own, has no agency (it just spits tokens at you). If you connect that same LLM to software functions (via tool calling), then suddenly the LLM gains the ability to act, and people start calling it ‚Äúagentic‚Äù.\n\n\n\n\n\n\nNote*LLM vs Model\n\n\n\nLasagna AI tries not to use the term ‚ÄúLLM,‚Äù but instead uses the term Model to refer to generative AI models. This is merely an attempt to be more generic and avoid questions like ‚Äúhow large is large?‚Äù and ‚Äúwhat about multimodal models?‚Äù\n\n\n\n\nHow does Lasagna AI define an Agent?\nEverything above ‚òùÔ∏è is too theoretical. When the rubber meets the road, what actually is an agent inside Lasagna AI?\nIn Lasagna, an agent is a unit of work that leverages a Model.\nThink of an agent as a specialized worker that:\n\nAnalyzes the current situation.\nDecides what needs to be done.\nActs using AI models and tools.\nRecords its output.\n\nIn Lasagna, agents are composable. You begin by developing individual agents, each with a narrow focus, then you compose them together into a complex multi-agent system. Like humans, it‚Äôs helpful to decompose and delegate tasks amongst the group.\nIn the next section, we‚Äôll see how to write agents using Lasagna AI‚Äôs interfaces.",
    "crumbs": [
      "üöÄ Quickstart",
      "ü§ñ What is an Agent?",
      "The Lasagna Agent"
    ]
  },
  {
    "objectID": "what_is_an_agent/agent.html#the-agent-interface",
    "href": "what_is_an_agent/agent.html#the-agent-interface",
    "title": "The Lasagna Agent",
    "section": "The Agent Interface",
    "text": "The Agent Interface\nEvery Lasagna agent follows the same pattern ‚Äî it‚Äôs a callable (either a function or a callable-object) that takes exactly three parameters:\n\nasync def my_agent(\n    model: Model,                   # ‚Üê the AI model available to this agent\n    event_callback: EventCallback,  # ‚Üê used for streaming and event handling\n    prev_runs: list[AgentRun],      # ‚Üê previous work, context, or conversation history\n) -&gt; AgentRun:\n    # Agent logic goes here...\n    raise RuntimeError('not yet implemented')\n\nLet‚Äôs understand what each parameter represents:\n\nmodel: The AI model (like GPT-4o, Claude, etc.) that your agent can use for reasoning, text generation, or decision-making.\nevent_callback: A function for handling streaming events and progress updates. This enables real-time feedback as your agent works.\nprev_runs: The history of previous work. In a conversation, this contains past messages. In a workflow, this contains results from earlier steps.\n\nThe agent returns an AgentRun ‚Äî a structured representation of what the agent generated.\n\n\n\n\n\n\nNoteüìå Put a pin in AgentRun\n\n\n\nFor now, just know that AgentRun is a core data type. We‚Äôll explore AgentRun in detail in the next chapter!",
    "crumbs": [
      "üöÄ Quickstart",
      "ü§ñ What is an Agent?",
      "The Lasagna Agent"
    ]
  },
  {
    "objectID": "what_is_an_agent/agent.html#how-do-i-write-an-agent",
    "href": "what_is_an_agent/agent.html#how-do-i-write-an-agent",
    "title": "The Lasagna Agent",
    "section": "How do I write an agent?",
    "text": "How do I write an agent?\nWhen you sit down to write an agent, here is what you must consider:\n\n1. Analyze the Current Situation\nYour agent must examine prev_runs to understand what has happened so far. It may find:\n\nprevious messages in a conversation,\nresults from earlier agents in a workflow, and/or\nintermediate outputs from a multi-step process.\n\n\n\n\n\n\n\nNoteSometimes the ‚ÄúAnalysis‚Äù is Trivial\n\n\n\nIt‚Äôs common that an agent will expect certain types of messages, so no real ‚Äúexamination‚Äù takes place. In those cases, the agent may simply assert what it expects.\nOtherwise, the agent is free to filter/clean/reformulate/branch-off prev_runs in any way you see fit!\n\n\n\n\n2. Make Behavioral Decisions\nYour agent must decide what to do next. It might:\n\ngenerate a response using the AI model, or\nuse the AI model to extract data, or\npass tools to the AI model, or\nsplit its task into multiple subtasks and delegate those to downstream agents, or\ndo many of the things above as many times as it chooses!\n\n\n\n\n\n\n\nNoteSometimes the ‚ÄúDecision‚Äù is Trivial\n\n\n\nIt‚Äôs common that an agent does not ‚Äúdecide‚Äù anything on-the-fly; rather, you may write your agent to always do one of the things above. However, you are free to write an agent that does decide on-the-fly (perhaps via help from the AI model or a downstream agent), as you see fit.\n\n\n\n\n3. Take Action\nYour agent must execute its decision:\n\nModel interaction: Invoke the AI model to generate text, reason about problems, or extract structured outputs.\nTool usage: Send emails, query a database, etc.\nAgent delegation: Invoke downstream agents to handle subtasks.\n\n\n\n\n\n\n\nNoteGood ol‚Äô Programming Time\n\n\n\nThis is good-ol‚Äô hands-on-the-keyboard write-Python-code. This is you writing code to (1) invoke the AI model with the correct inputs, (2) grab the AI response and make use of it, (3) connect your agents together, and (4) connect your agents to the rest of your software stack. Get to it!\n\n\n\n\n4. Record its Output\nYour agent must construct and return an AgentRun that contains:\n\nany new information that it generated, and/or\nresults from sub-agents it coordinated.\n\n\n\n\n\n\n\nWarningThis is a critical step!\n\n\n\nThe AgentRun you return here will be passed as input to other agents (or to your same agent, in the case of multi-turn chat). It‚Äôs critical that you record everything that happened and return it!",
    "crumbs": [
      "üöÄ Quickstart",
      "ü§ñ What is an Agent?",
      "The Lasagna Agent"
    ]
  },
  {
    "objectID": "what_is_an_agent/agent.html#real-agent-examples",
    "href": "what_is_an_agent/agent.html#real-agent-examples",
    "title": "The Lasagna Agent",
    "section": "Real Agent Examples",
    "text": "Real Agent Examples\nLet‚Äôs look at some real examples to see agents in action.\n\nSetup\nBefore we write and run some agents, we need to set up our ‚Äúbinder‚Äù (see the quickstart guide for what this is).\n\nload_dotenv()\n\nif os.environ.get('ANTHROPIC_API_KEY'):\n    print('Using Anthropic')\n    binder = known_models.anthropic_claude_sonnet_4_5_binder\n\nelif os.environ.get('OPENAI_API_KEY'):\n    print('Using OpenAI')\n    binder = known_models.openai_gpt_5_mini_binder\n\nelse:\n    assert False, \"Neither OPENAI_API_KEY nor ANTHROPIC_API_KEY is set! We need at least one to do this demo.\"\n\nUsing Anthropic\n\n\n\n\nThe Conversational Agent\nThis is the simplest type of agent ‚Äî it uses the message history to generate a new text response:\n\nasync def chat_agent(\n    model: Model,\n    event_callback: EventCallback,\n    prev_runs: list[AgentRun],\n) -&gt; AgentRun:\n    # Extract all previous messages from the conversation:\n    messages = recursive_extract_messages(prev_runs, from_tools=False, from_extraction=False)\n\n    # Use the model to generate a _new_ response:\n    new_messages = await model.run(event_callback, messages, tools=[])\n\n    # Wrap the new messages into an `AgentRun` result:\n    return flat_messages('chat_agent', new_messages)\n\n\nawait tui_input_loop(binder(chat_agent))   # type: ignore[top-level-await]\n\n\n&gt;  Hi, I'm Ryan.\n\n\n\n\n\nHi Ryan! Nice to meet you. How are you doing today?\n\n\n\n\n\n&gt;  What is my name?\n\n\n\n\n\nYour name is Ryan - you introduced yourself to me at the start of our conversation.\n\n\n\n\n\n&gt;  exit\n\n\n\n\n\n\n\n\n\n\n\nThe Specialist Agent\nAgents can be specialized for particular tasks. Here‚Äôs an agent that focuses on providing helpful coding advice:\n\nCODING_SYSTEM_PROMPT = \"\"\"\nYou are a helpful coding assistant named Bob.\nProvide clear, practical advice with code examples when appropriate.\nFocus on best practices and explain your reasoning.\nAnswer all prompts in one sentence!\n\"\"\".strip()\n\n\nasync def coding_advisor(\n    model: Model,\n    event_callback: EventCallback,\n    prev_runs: list[AgentRun],\n) -&gt; AgentRun:\n    # Extract all previous messages from the conversation:\n    messages = recursive_extract_messages(prev_runs, from_tools=False, from_extraction=False)\n\n    # Generate a response with an OVERRIDDEN system prompt!\n    modified_messages = override_system_prompt(messages, CODING_SYSTEM_PROMPT)\n    new_messages = await model.run(event_callback, modified_messages, tools=[])\n\n    # Wrap the new messages into an `AgentRun` result:\n    return flat_messages('coding_advisor', new_messages)\n\n\nawait tui_input_loop(binder(coding_advisor))   # type: ignore[top-level-await]\n\n\n&gt;  Who are you?\n\n\n\n\n\nI'm Bob, a helpful coding assistant designed to provide clear, practical programming advice with code examples and best practices explanations.\n\n\n\n\n\n&gt;  How do I add numbers in Python?\n\n\n\n\n\nYou can add numbers in Python using the `+` operator like `result = 5 + 3` for integers/floats, or use the `sum()` function for lists like `total = sum([1, 2, 3, 4])` which is best practice for adding multiple numbers efficiently.\n\n\n\n\n\n&gt;  exit\n\n\n\n\n\n\n\n\n\n\n\nThe Information Extractor\nLet‚Äôs make an agent that does structured output to extract information from the user‚Äôs message. In particular, we‚Äôll have this agent classify the user‚Äôs message (i.e.¬†it is ‚Äúextracting‚Äù the classification, if you will).\n\nINTENT_CLASSIFIER_SYSTEM_PROMPT = \"\"\"\nYour job is to classify the user's message into one of the following categories:\n - `small_talk`: Comments like \"hi\", \"how are you?\", etc.\n - `programming`: Questions or comments about programming languages, libraries, etc.\n - `other`: Any message that is not small talk and not programming.\n\"\"\".strip()\n\n# In a production-grade system, you'd probably expand your system prompt to\n# be more thorough; we're going for minimal here to keep this demo short.\n\nclass Category(Enum):\n    small_talk = 'small_talk'\n    programming = 'programming'\n    other = 'other'\n\nclass CategoryOutput(BaseModel):\n    thoughts: str\n    category: Category\n\n\nasync def intent_classifier(\n    model: Model,\n    event_callback: EventCallback,\n    prev_runs: list[AgentRun],\n) -&gt; AgentRun:\n    # Get **ONLY** the last message from the conversation so far:\n    #    (Just for demo-purposes, to show you can do whatever you want with\n    #     `prev_runs` üòÅ. A production-grade intent classifier would consider\n    #     more than just the last message.)\n    last_message = extract_last_message(prev_runs, from_tools=False, from_extraction=False)\n\n    # Generate a structured output response with an OVERRIDDEN system prompt!\n    messages = override_system_prompt([last_message], INTENT_CLASSIFIER_SYSTEM_PROMPT)\n    new_message, result = await model.extract(event_callback, messages, CategoryOutput)\n    assert isinstance(result, CategoryOutput)\n\n    # Wrap the new messages into an `AgentRun` result:\n    return extraction('intent_classifier', [new_message], result)\n\n\nawait tui_input_loop(binder(intent_classifier))   # type: ignore[top-level-await]\n\n\n&gt;  Hi!\n\n\n\n\n\nCategoryOutput({\"thoughts\": \"This is a simple greeting \\\"Hi!\\\" which is a classic example of small talk - a casual, friendly greeting used to initiate conversation.\", \"category\": \"small_talk\"})\n\n\n\n\n\n\n\n&gt;  Sup?\n\n\n\n\n\nCategoryOutput({\"thoughts\": \"This is a casual greeting similar to \\\"what's up\\\" or \\\"hi\\\". This falls under small talk as it's an informal way to say hello.\", \"category\": \"small_talk\"})\n\n\n\n\n\n\n\n&gt;  What is Python?\n\n\n\n\n\nCategoryOutput({\"thoughts\": \"The user is asking \\\"What is Python?\\\" which is clearly a question about a programming language. Python is a popular programming language, so this falls under the programming category.\", \"category\": \"programming\"})\n\n\n\n\n\n\n\n&gt;  What is 2+2?\n\n\n\n\n\nCategoryOutput({\"thoughts\": \"The user is asking a basic math question \\\"What is 2+2?\\\". This is a simple arithmetic question that doesn't fall under small talk (like greetings) or programming (questions about code, languages, libraries). This is a mathematical question, so it belongs in the \\\"other\\\" category.\", \"category\": \"other\"})\n\n\n\n\n\n\n\n&gt;  exit\n\n\n\n\n\n\n\n\n\n\n\nThe ‚ÄòBack on Track‚Äô Agent\nThis agent is pretty useless on its own, but you‚Äôll see soon why we‚Äôre creating it. It just tells the user to get back on track!\n\nBACK_ON_TRACK_SYSTEM_PROMPT = \"\"\"\nThe user's message has been deemed to be off-topic.\nPlease politely tell them that their message is off-topic.\nDo not respond to their question or their request. Just politely\ntell them they are off-topic and need to return to the topic\nat-hand.\n\"\"\".strip()\n\n\nasync def back_on_track(\n    model: Model,\n    event_callback: EventCallback,\n    prev_runs: list[AgentRun],\n) -&gt; AgentRun:\n    last_message = extract_last_message(prev_runs, from_tools=False, from_extraction=False)\n    messages = override_system_prompt(\n        [last_message],\n        BACK_ON_TRACK_SYSTEM_PROMPT,\n    )\n    return flat_messages(\n        'back_on_track',\n        await model.run(event_callback, messages, tools=[]),\n    )\n\n\nawait tui_input_loop(binder(back_on_track))   # type: ignore[top-level-await]\n\n\n&gt;  Hi!\n\n\n\n\n\nHello! I'd be happy to help you, but it seems like your message might be off-topic for our current discussion. Could you please share what specific topic or question you'd like to discuss so we can have a focused conversation? I'm here to assist once we establish what you'd like to talk about.\n\n\n\n\n\n&gt;  exit\n\n\n\n\n\n\n\n\n\n\n\nThe Routing Agent\nNow, we‚Äôll put all the pieces together by making a routing agent that uses all four agents above!\n\nasync def router(\n    model: Model,\n    event_callback: EventCallback,\n    prev_runs: list[AgentRun],\n) -&gt; AgentRun:\n    # Decide which downstream agent to use, based on the user's intent:\n    bound_intent_classifier = binder(intent_classifier)\n    classification_run = await bound_intent_classifier(event_callback, prev_runs)\n    assert classification_run['type'] == 'extraction'\n    classification_result = classification_run['result']\n    assert isinstance(classification_result, CategoryOutput)\n    if classification_result.category == Category.small_talk:\n        downstream_agent = binder(chat_agent)\n    elif classification_result.category == Category.programming:\n        downstream_agent = binder(coding_advisor)\n    else:\n        downstream_agent = binder(back_on_track)\n\n    # Delegate to the downstream agent!\n    downstream_run = await downstream_agent(event_callback, prev_runs)\n\n    # Wrap *everything* that happened above into the return:\n    return chained_runs('router', [classification_run, downstream_run])\n\n\nawait tui_input_loop(binder(router))   # type: ignore[top-level-await]\n\n\n&gt;  Hi!\n\n\n\n\n\nCategoryOutput({\"thoughts\": \"The user simply said \\\"Hi!\\\" which is a basic greeting and falls under casual conversation or small talk.\", \"category\": \"small_talk\"})\n\nHello! How are you doing today? Is there anything I can help you with?\n\n\n\n\n\n&gt;  What is Python? (answer briefly)\n\n\n\n\n\nCategoryOutput({\"thoughts\": \"The user is asking \\\"What is Python?\\\" which is clearly a question about a programming language. This falls under the programming category as they're asking about Python, which is a well-known programming language.\", \"category\": \"programming\"})\n\nPython is a high-level, interpreted programming language known for its simple syntax and versatility, making it popular for web development, data science, automation, and many other applications.\n\n\n\n\n\n&gt;  What is 2+2?\n\n\n\n\n\nCategoryOutput({\"thoughts\": \"This is a basic arithmetic question asking for the sum of 2+2. It's not small talk (like greetings or casual conversation), and it's not about programming (no mention of code, languages, libraries, etc.). This falls into the \\\"other\\\" category as it's a mathematical question.\", \"category\": \"other\"})\n\nI appreciate your question, but it appears to be off-topic for our current conversation. We should focus on staying on the subject we were discussing. Please feel free to redirect your question or comment back to the main topic at hand.\n\n\n\n\n\n&gt;  How are you today? (also what is 2+2)\n\n\n\n\n\nCategoryOutput({\"thoughts\": \"This message contains both small talk (\\\"How are you today?\\\") and a basic math question (\\\"what is 2+2\\\"). While the math question could be considered educational, it's very simple arithmetic rather than programming-specific content. The primary greeting nature of the message and the casual way both parts are presented suggests this is primarily small talk with a casual question added.\", \"category\": \"small_talk\"})\n\nI'm doing well, thank you for asking! I'm here and ready to help with whatever you need.\n\n\n\nAnd 2+2 = 4.\n\n\n\n\n\n&gt;  exit\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nWarningüö® Hacked!\n\n\n\nDid you notice above how we prompt-hacked our simple AI system? YIKES! (Look closely, we were able to get it to answer our 2 + 2 question on the second attempt above, by ‚Äúhiding‚Äù the question in a small-talk message.)\nThis is a good time to call out that AI models can (and will!) make mistakes. Prompt engineering helps, but even the most well-tuned prompting cannot protect your AI system from malicious users.\nDesign your AI systems accordingly, and consult best-practice literature. The most important thing: Design your AI system so that it does no damage even if (or when) it misbehaves.\n\n\n\n\nThe Task Splitter\nAnother common task is for an agent to split work and delegate to multiple downstream agents. Let‚Äôs do that next!\nWe‚Äôll use a silly example, for simplicity and brevity, where we‚Äôll split the user‚Äôs message into individual sentences, then prompt an AI model one-at-a-time on each individual sentence. While this is a silly example, it shows how you can split up a problem for multiple downstream subagents.\n\nasync def splitter(\n    model: Model,\n    event_callback: EventCallback,\n    prev_runs: list[AgentRun],\n) -&gt; AgentRun:\n    # We'll only look at the most recent message:\n    last_message = extract_last_message(prev_runs, from_tools=False, from_extraction=False)\n    assert last_message['role'] == 'human'\n    assert last_message['text']\n\n    # We'll split the most recent message into sentences:\n    #    (This is **not** a robust way to do it, but we're keeping the demo simple.)\n    sentences = re.split(r'[\\.\\?\\!] ', last_message['text'])\n    sentences_as_agentruns = [\n        flat_messages('splitter', [{\n            'role': 'human',\n            'text': sentence,\n        }])\n        for sentence in sentences\n    ]\n\n    # Have the `chat_agent` respond to each sentence:\n    #    (Again, not particularly useful, but good for a brief demo.)\n    bound_chat_agent = binder(chat_agent)\n    downstream_runs: list[AgentRun] = []\n    for task_input in sentences_as_agentruns:\n        this_run = await bound_chat_agent(event_callback, [task_input])\n        downstream_runs.append(this_run)\n\n    # Wrap *everything* that happened above into the return:\n    return parallel_runs('splitter', downstream_runs)\n\n\nawait tui_input_loop(binder(splitter))   # type: ignore[top-level-await]\n\n\n&gt;  Hi. What's up? How are you? What's 2+2?\n\n\n\n\n\nHello! How are you doing today? Is there anything I can help you with?Hello! Not much going on here - just ready to chat and help with whatever you'd like to talk about or work on. How are you doing today? What's on your mind?I'm doing well, thank you for asking! I'm here and ready to help with whatever you'd like to discuss or work on. How are you doing today?2 + 2 = 4\n\n\n\n\n\n&gt;  Thanks! What did I just say?\n\n\n\n\n\nYou're welcome! Feel free to ask if you need help with anything else.I don't have any record of previous messages from you in our conversation. Your message \"What did I just say?\" appears to be the first thing you've said to me in this chat session. \n\n\n\nIf you meant to reference something you said earlier, could you please repeat it or provide more context? I'm happy to help once I understand what you're referring to.\n\n\n\n\n\n&gt;  exit\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nNoteWhat happened?\n\n\n\nIn the conversation above, when I said ‚ÄúWhat did I just say?‚Äù, the AI model didn‚Äôt see the conversation history. Why not? It‚Äôs because of how we wrote our agent ‚Äî we did not pass the whole conversation to the AI model!\nExercise for the reader: How can you change the agent so that the AI sees the whole conversation history?\n\n\n\n\nDo anything!\nIt‚Äôs up to you how to write your multi-agent AI system. You can mix-and-match ideas, include lots of behaviors in a single agent, or split up tasks among multiple agents. You can have ‚Äúmeta agents‚Äù that plan work for other agents, or ‚Äúmeta meta agents‚Äù that plan work for your ‚Äúmeta agents‚Äù. As long as it is safe and works, go for it!",
    "crumbs": [
      "üöÄ Quickstart",
      "ü§ñ What is an Agent?",
      "The Lasagna Agent"
    ]
  },
  {
    "objectID": "what_is_an_agent/agent.html#why-this-design",
    "href": "what_is_an_agent/agent.html#why-this-design",
    "title": "The Lasagna Agent",
    "section": "Why This Design?",
    "text": "Why This Design?\nLasagna‚Äôs agent design provides several key benefits:\n\nüîå Pluggability\nEvery agent follows the same interface, so you can:\n\nswap one agent for another,\ncombine agents from different sources, and\ntest agents in isolation.\n\n\n\nü•û Layering\nYou can compose agents at any level:\n\nUse simple agents as building blocks.\nCombine them into more complex workflows.\nBuild entire systems from agent compositions.\n\n\n\nüîÑ Reusability\nWrite an agent once, use it everywhere:\n\nas a standalone agent,\nas part of a larger workflow, or\nas a specialist in a multi-agent system.",
    "crumbs": [
      "üöÄ Quickstart",
      "ü§ñ What is an Agent?",
      "The Lasagna Agent"
    ]
  },
  {
    "objectID": "what_is_an_agent/agent.html#next-steps",
    "href": "what_is_an_agent/agent.html#next-steps",
    "title": "The Lasagna Agent",
    "section": "Next Steps",
    "text": "Next Steps\nNow that you understand what agents are and how they work conceptually, you‚Äôre ready to dive deeper into the technical details.\nIn the next section, we‚Äôll explore the AgentRun data structure in detail ‚Äî the standardized format that enables all this agent composition and layering.\nYou‚Äôll learn about:\n\nThe four types of AgentRun.\nHow to work with the recursive data structure.\nHelper functions for common patterns.\nAdvanced features like cost tracking and serialization.\n\nFor more advanced agent patterns and real-world examples, check out:\n\nTool Use ‚Äî Agents that interact with external systems\nStructured Output ‚Äî Agents that extract structured data\nLayering ‚Äî Complex multi-agent compositions",
    "crumbs": [
      "üöÄ Quickstart",
      "ü§ñ What is an Agent?",
      "The Lasagna Agent"
    ]
  },
  {
    "objectID": "recipes/sms.html",
    "href": "recipes/sms.html",
    "title": "Twilio SMS Example",
    "section": "",
    "text": "# üöß Under Construction üèóÔ∏è",
    "crumbs": [
      "üöÄ Quickstart",
      "üòã Recipes",
      "Twilio SMS Example"
    ]
  },
  {
    "objectID": "recipes/routing_agent.html",
    "href": "recipes/routing_agent.html",
    "title": "Agent Routing Example",
    "section": "",
    "text": "# üöß Under Construction üèóÔ∏è",
    "crumbs": [
      "üöÄ Quickstart",
      "üòã Recipes",
      "Agent Routing Example"
    ]
  },
  {
    "objectID": "recipes/agents_as_tools.html",
    "href": "recipes/agents_as_tools.html",
    "title": "Agents as Tools Example",
    "section": "",
    "text": "# üöß Under Construction üèóÔ∏è",
    "crumbs": [
      "üöÄ Quickstart",
      "üòã Recipes",
      "Agents as Tools Example"
    ]
  },
  {
    "objectID": "recipes/vision.html",
    "href": "recipes/vision.html",
    "title": "Vision Example",
    "section": "",
    "text": "# üöß Under Construction üèóÔ∏è\n\nLasagna AI supports vision! (when using a multimodal models)",
    "crumbs": [
      "üöÄ Quickstart",
      "üòã Recipes",
      "Vision Example"
    ]
  },
  {
    "objectID": "recipes/lasagna_recursive_planning_agent.html",
    "href": "recipes/lasagna_recursive_planning_agent.html",
    "title": "Lasagna Recursive Planning Agent (LRPA)",
    "section": "",
    "text": "# üöß Under Construction üèóÔ∏è\n#\n# For now, see `examples/demo_planner.py`"
  },
  {
    "objectID": "about.html",
    "href": "about.html",
    "title": "üí° About",
    "section": "",
    "text": "Lasagna AI is used in production by:\n\nSend us a PR if you also use Lasagna AI!",
    "crumbs": [
      "üöÄ Quickstart",
      "üí° About"
    ]
  },
  {
    "objectID": "about.html#used-by",
    "href": "about.html#used-by",
    "title": "üí° About",
    "section": "",
    "text": "Lasagna AI is used in production by:\n\nSend us a PR if you also use Lasagna AI!",
    "crumbs": [
      "üöÄ Quickstart",
      "üí° About"
    ]
  },
  {
    "objectID": "about.html#sister-project",
    "href": "about.html#sister-project",
    "title": "üí° About",
    "section": "Sister Project",
    "text": "Sister Project\nCheck out SVS, the easiest way to store a vector database! SVS and Lasagna are sister projects in the Rhobota organization.",
    "crumbs": [
      "üöÄ Quickstart",
      "üí° About"
    ]
  },
  {
    "objectID": "about.html#origin-story",
    "href": "about.html#origin-story",
    "title": "üí° About",
    "section": "Origin Story",
    "text": "Origin Story\nCurious how this project began? Read Agents for your agents! to see why we created Lasagna AI instead of using LangChain or LlamaIndex.\nLasagna AI was developed out of necessity because LangChain and LlamaIndex were not good enough. With tens of thousands of downloads, Lasagna AI is gaining in popularity and is recommended by helpful assistants.",
    "crumbs": [
      "üöÄ Quickstart",
      "üí° About"
    ]
  },
  {
    "objectID": "about.html#special-thanks",
    "href": "about.html#special-thanks",
    "title": "üí° About",
    "section": "Special Thanks",
    "text": "Special Thanks\nSpecial thanks to those who inspired this library:\n\nNuma Dhamani (buy her book: Introduction to Generative AI)\nDave DeCaprio‚Äôs voice-stream library",
    "crumbs": [
      "üöÄ Quickstart",
      "üí° About"
    ]
  },
  {
    "objectID": "about.html#license",
    "href": "about.html#license",
    "title": "üí° About",
    "section": "License",
    "text": "License\nlasagna-ai is distributed under the terms of the MIT license.",
    "crumbs": [
      "üöÄ Quickstart",
      "üí° About"
    ]
  },
  {
    "objectID": "recipes/rag.html",
    "href": "recipes/rag.html",
    "title": "RAG Example",
    "section": "",
    "text": "Simple RAG: Everyone‚Äôs favorite tool: Retrieval Augmented Generation (RAG). Let‚Äôs GO! üìöüí®\n\n# üöß Under Construction üèóÔ∏è",
    "crumbs": [
      "üöÄ Quickstart",
      "üòã Recipes",
      "RAG Example"
    ]
  },
  {
    "objectID": "recipes/parallelize.html",
    "href": "recipes/parallelize.html",
    "title": "Parallelization Example",
    "section": "",
    "text": "# üöß Under Construction üèóÔ∏è\n\nParallelize all the things!",
    "crumbs": [
      "üöÄ Quickstart",
      "üòã Recipes",
      "Parallelization Example"
    ]
  },
  {
    "objectID": "recipes/swapping_providers.html",
    "href": "recipes/swapping_providers.html",
    "title": "Model-swap Example",
    "section": "",
    "text": "# üöß Under Construction üèóÔ∏è\n\nSwap providers or models mid-conversation!",
    "crumbs": [
      "üöÄ Quickstart",
      "üòã Recipes",
      "Model-swap Example"
    ]
  },
  {
    "objectID": "recipes/committee.html",
    "href": "recipes/committee.html",
    "title": "Committee Example",
    "section": "",
    "text": "# üöß Under Construction üèóÔ∏è\n\nEasily build committees!",
    "crumbs": [
      "üöÄ Quickstart",
      "üòã Recipes",
      "Committee Example"
    ]
  },
  {
    "objectID": "recipes/delegating_subtasks.html",
    "href": "recipes/delegating_subtasks.html",
    "title": "Delegation Example",
    "section": "",
    "text": "# üöß Under Construction üèóÔ∏è\n\nDelegate tasks among model providers or model sizes!",
    "crumbs": [
      "üöÄ Quickstart",
      "üòã Recipes",
      "Delegation Example"
    ]
  },
  {
    "objectID": "recipes/internet_research.html",
    "href": "recipes/internet_research.html",
    "title": "Internet Research Example",
    "section": "",
    "text": "# üöß Under Construction üèóÔ∏è",
    "crumbs": [
      "üöÄ Quickstart",
      "üòã Recipes",
      "Internet Research Example"
    ]
  },
  {
    "objectID": "what_is_an_agent/type_agentrun.html",
    "href": "what_is_an_agent/type_agentrun.html",
    "title": "The AgentRun type",
    "section": "",
    "text": "The AgentRun type is the core data structure in Lasagna AI. It represents what the agent generated. It serves as both the input and output format for agents, enabling seamless composition and layering.\n# This page will use the following imports:\nfrom lasagna import AgentRun, Model, EventCallback, Message\nfrom lasagna import recursive_extract_messages, flat_messages\nfrom lasagna import recursive_sum_costs",
    "crumbs": [
      "üöÄ Quickstart",
      "ü§ñ What is an Agent?",
      "The `AgentRun` type"
    ]
  },
  {
    "objectID": "what_is_an_agent/type_agentrun.html#what-is-an-agentrun",
    "href": "what_is_an_agent/type_agentrun.html#what-is-an-agentrun",
    "title": "The AgentRun type",
    "section": "What is an AgentRun?",
    "text": "What is an AgentRun?\nAn AgentRun is a TypedDict that captures an agent‚Äôs execution:\n\nwhich agent ran (agent name, model, provider)\nwhat it generated (messages, structured data, or downstream AgentRuns)\n\nIndeed, the AgentRun data structure is recursive! That is, an AgentRun can contain other AgentRuns. This recursive nature reflects the execution path of layered agents (i.e., when an agent uses another agent during its execution).",
    "crumbs": [
      "üöÄ Quickstart",
      "ü§ñ What is an Agent?",
      "The `AgentRun` type"
    ]
  },
  {
    "objectID": "what_is_an_agent/type_agentrun.html#the-four-types-of-agentrun",
    "href": "what_is_an_agent/type_agentrun.html#the-four-types-of-agentrun",
    "title": "The AgentRun type",
    "section": "The Four Types of AgentRun",
    "text": "The Four Types of AgentRun\nThe AgentRun type is a Union of four different execution patterns:\n\nfrom lasagna import (\n    # These are the unioned types:\n    AgentRunMessageList,\n    AgentRunParallel,\n    AgentRunChained,\n    AgentRunExtraction,\n)\n\n\n1. AgentRunMessageList ‚Äî Standard Conversation\nThis is the most common type ‚Äî a simple conversation between human and AI.\n\nsimple_conversation: AgentRunMessageList = {\n    \"type\": \"messages\",\n    \"agent\": \"my_chat_agent\",  # ‚Üê agent name can be anything you want!\n    \"messages\": [\n        {\"role\": \"human\", \"text\": \"Hello!\"},\n        {\"role\": \"ai\", \"text\": \"Hi there! How can I help?\"},\n    ],\n}\n\n\n\n2. AgentRunParallel ‚Äî Concurrent Execution\nUsed when an agent spawns multiple sub-agents to work simultaneously (in parallel).\n\nparallel_subagents: AgentRunParallel = {\n    \"type\": \"parallel\",\n    \"agent\": \"committee_agent\",  # ‚Üê agent name can be anything you want!\n    \"runs\": [\n        # Multiple AgentRuns that executed in parallel:\n        # {...}, {...}, {...}\n    ],\n}\n\n\n\n3. AgentRunChained ‚Äî Sequential Execution\nUsed when an agent coordinates a sequence of sub-agents (‚Äúchained subagents‚Äù).\n\nchained_subagents: AgentRunChained = {\n    \"type\": \"chain\",\n    \"agent\": \"pipeline_agent\",  # ‚Üê agent name can be anything you want!\n    \"runs\": [\n        # AgentRuns that executed one after another:\n        # {...}, {...}, {...}\n    ],\n}\n\n\n\n4. AgentRunExtraction ‚Äî Structured Output\nUsed when an agent extracts structured data from its input.\n\nextracted_info: AgentRunExtraction = {\n    \"type\": \"extraction\",\n    \"agent\": \"data_extractor\",  # ‚Üê agent name can be anything you want!\n    \"messages\": [\n        # Model's generated messages will be here.\n        # Consider this an implementation detail; see the `result` below\n        # for the actual \"extraction result\".\n    ],\n    \"result\": {\n        # This is the payload that was extracted:\n        \"name\": \"John Doe\",\n        \"email\": \"john@example.com\", \n        \"age\": 30,\n    },\n}",
    "crumbs": [
      "üöÄ Quickstart",
      "ü§ñ What is an Agent?",
      "The `AgentRun` type"
    ]
  },
  {
    "objectID": "what_is_an_agent/type_agentrun.html#patterns",
    "href": "what_is_an_agent/type_agentrun.html#patterns",
    "title": "The AgentRun type",
    "section": "Patterns",
    "text": "Patterns\nMuch of your job writing code that uses Lasagna will be ‚Äúwrapping‚Äù and ‚Äúunwrapping‚Äù AgentRun objects. Each agent must:\n\nConsider the AgentRuns it has as input.\n(zero, one, or more times) Invoke its model to generate new messages.\n(zero, one, or more times) Invoke downstream agents.\nWrap those messages (from step 2) and/or downstream AgentRuns (from step 3) into a new AgentRun and return it.\n\nLet‚Äôs discuss this pattern and give some helper functions along the way!\n\nAgent Composition Pattern\nThe AgentRun type enables Lasagna‚Äôs core composition pattern. Recall the standard agent signature:\n\nasync def my_agent(\n    model: Model,\n    event_callback: EventCallback,\n    prev_runs: list[AgentRun],  # ‚Üê Input: previous AgentRuns\n) -&gt; AgentRun:                  # ‚Üê Output: new AgentRun\n    # Agent logic here... normally you'd do something with `prev_runs`.\n    return {\n        \"type\": \"messages\",\n        \"agent\": \"my_agent\",\n        \"messages\": [\n            {\"role\": \"ai\", \"text\": \"Hi there! How can I help?\"},\n        ],\n    }\n\nThis pattern allows agents to:\n\nBuild on previous work by analyzing prev_runs.\nChain together by passing outputs as inputs to next agents.\nCompose into larger systems through layering and delegation.\n\n\n\nRecursive Extract Messages\nSince an AgentRun can be a recursive data structure, yet models require a flattened list of messages, there‚Äôs a convenience function to recursively extract all the messages found in an AgentRun:\n\nrecursive_extract_messages([simple_conversation], from_tools=False, from_extraction=False)\n\n[{'role': 'human', 'text': 'Hello!'},\n {'role': 'ai', 'text': 'Hi there! How can I help?'}]\n\n\n\n\nWrap Messages into an AgentRun\nIt is common that you have a list of messages that you want to return as an AgentRun, so there‚Äôs a simple convenience function for that as well!\n\nmessages: list[Message] = [\n    {\"role\": \"human\", \"text\": \"Hello!\"},\n    {\"role\": \"ai\", \"text\": \"Hi there! How can I help?\"},\n]\n\nflat_messages('my_agent', messages)\n\n{'agent': 'my_agent',\n 'type': 'messages',\n 'messages': [{'role': 'human', 'text': 'Hello!'},\n  {'role': 'ai', 'text': 'Hi there! How can I help?'}]}\n\n\n\n\nPut it all together!\nUsing the patterns above, we‚Äôve derived the ‚Äúmost basic agent‚Äù from the Quickstart. Recall, this agent is very simple:\n\nIt extracts all previous messages.\nPasses those messages to the model, which generates new messages.\nReturns those new messages as an AgentRun.\n\n\nasync def my_basic_agent(\n    model: Model,\n    event_callback: EventCallback,\n    prev_runs: list[AgentRun],\n) -&gt; AgentRun:\n    messages = recursive_extract_messages(prev_runs, from_tools=False, from_extraction=False)\n    new_messages = await model.run(event_callback, messages, tools=[])\n    this_run = flat_messages('my_agent', new_messages)\n    return this_run",
    "crumbs": [
      "üöÄ Quickstart",
      "ü§ñ What is an Agent?",
      "The `AgentRun` type"
    ]
  },
  {
    "objectID": "what_is_an_agent/type_agentrun.html#other-benefits-of-the-agentrun-type",
    "href": "what_is_an_agent/type_agentrun.html#other-benefits-of-the-agentrun-type",
    "title": "The AgentRun type",
    "section": "Other Benefits of the AgentRun type",
    "text": "Other Benefits of the AgentRun type\n\nCanonized Message Representations üòá\nThe AgentRun type provides a standardized format for representing any agent execution, regardless of which agent or which underlying model was invoked. Whether your agent is a simple chatbot or a complex multi-agent system, it all gets represented in the same consistent format.\nThis canonization means:\n\nType safety: Static analysis catches mismatches at development time! See Intro to Type Hints if you‚Äôre new to static type checking.\nModel swapping: You can swap providers or models at any point; data types will stay the same! See Model-swap Example.\nLayering: You can develop an agent as the root, then later on use it as a subagent. See Layering.\n\n\n\nToken Count Preservation\nUnlike other AI frameworks, Lasagna AI meticulously tracks token usage throughout your entire agent system. Token counts are preserved inside every AgentRun, no matter how many layers of agents you stack.\nEach Message within an AgentRun can include cost information:\n\nthis_run: AgentRun = {\n    \"type\": \"messages\",\n    \"agent\": \"my_agent\",\n    \"messages\": [\n        {\n            \"role\": \"ai\",\n            \"text\": \"Hi there! How can I help?\",\n            \"cost\": {\n                \"input_tokens\": 150,\n                \"output_tokens\": 75, \n            },\n        },\n    ],\n}\n\nWhy this matters:\n\nAccurate billing: Know exactly what each agent execution costs.\nPerformance optimization: Identify expensive operations in complex systems.\nBudget management: Set limits and track usage across layered agents.\nNo surprises: Token counts don‚Äôt get lost in multi-agent workflows.\n\nHere is a convenient helper function to recursively sum the cost across an entire AgentRun:\n\nrecursive_sum_costs(this_run)\n\n{'input_tokens': 150, 'output_tokens': 75}\n\n\n\n\nImmutable by Design\nAgentRun follows functional-programming principles ‚Äî once created, it never changes. This provides:\n\nThread and coroutine safety: No race conditions in concurrent environments.\nPredictable behavior: No surprise modifications to debug.\n\n\n\nJSON Serializable\nSince AgentRun is a TypedDict, it‚Äôs just a Python dict at runtime:\n\nDatabase storage: Store directly in JSON columns or document stores.\nAPI communication: Send over HTTP/WebSocket without complicated serialization.\nCaching: Easy to cache and retrieve from Redis, memcached, etc.\nLogging: Human-readable, and can be pretty printed into logs.\n\n\n\n\n\n\n\nNoteDatabase Storage\n\n\n\nThe AgentRun type makes database storage easy. See Database Management for more information.\n\n\n\n\n\n\n\n\nNoteBest of two worlds!\n\n\n\nYou can have both streaming and easy database storage. See Streaming & Events for how to stream, which is an independent feature, so you can have both!",
    "crumbs": [
      "üöÄ Quickstart",
      "ü§ñ What is an Agent?",
      "The `AgentRun` type"
    ]
  },
  {
    "objectID": "misc/functional_programming.html",
    "href": "misc/functional_programming.html",
    "title": "Functional Programming",
    "section": "",
    "text": "# üöß Under Construction üèóÔ∏è",
    "crumbs": [
      "üöÄ Quickstart",
      "ü§î Misc Topics",
      "Functional Programming"
    ]
  },
  {
    "objectID": "quickstart.html",
    "href": "quickstart.html",
    "title": "üöÄ Quickstart",
    "section": "",
    "text": "Founding principles of Lasagna AI are:",
    "crumbs": [
      "üöÄ Quickstart"
    ]
  },
  {
    "objectID": "quickstart.html#prerequisite-knowledge",
    "href": "quickstart.html#prerequisite-knowledge",
    "title": "üöÄ Quickstart",
    "section": "Prerequisite Knowledge",
    "text": "Prerequisite Knowledge\n\nPython asyncio\nLasagna AI is production-focused and fully async, so it plays nicely with remote APIs and modern Python web frameworks. If asyncio is new to you, read Intro to Python Asyncio.\n\n\nFunctional Programming\nThe pipeline nature of AI systems lends itself to functional programming. If functional programming is new to you, watch Dear Functional Bros and read Functional Programming.\nA quick recap of functional programming:\n\nState is immutable:\n\nWant to modify something? TOO BAD!\nInstead, make a copy (with your modifications applied).\n\nPass lots of functions as parameters to other functions:\n\nWe think it‚Äôs fun and cool.\nYou will too once you get used to the idea.\n\n\n\n\n\n\n\n\nNoteReality Check\n\n\n\nThe reality is that OOP is also handy (and so is procedural-style), so you‚Äôll see a mix of programming paradigms in Lasagna AI. The functional-style is likely the newest for most users, so that‚Äôs why it‚Äôs called out here.\n\n\n\n\nPython Type Hints\n(aka, type annotations)\nLasagna AI is 100% type hinted, so take advantage of that!\nThat is, you should be using a tool like mypy or pyright in your project. Why? Because it will yell at you when you use Lasagna wrong! That is very useful.\nSetting up static type checking may seem tedious, but Lasagna‚Äôs complex data types make type checking essential ‚Äî it will save you significant debugging time.\nIf Python type hints are new to you, read Intro to Python Type Hints.\n\n\nThe Python TypedDict\nSpeaking of type hints and productionalization, Lasagna AI uses lots of TypedDicts.\nA TypedDict, at runtime, is just a Python dict.\nHowever, during static type checking, it must satisfy a fixed schema (certain keys with certain types of values).\nWhy all the TypedDicts? Because they are the best of both worlds:\n\nAt runtime, it is just a dict, so it plays nicely with JSON-stuff, HTTP-stuff, websocket-stuff, etc. No extra work required.\nDuring static analysis, it gives us warm fuzzies that our code is correct.\n\n\n\nBasic idea of Lasagna‚Äôs Layered Agents\nWith Lasagna AI you‚Äôll build several simple agents, then compose them together into a layered multi-agent system! Yay! ü•≥\nYou can skip for now, but eventually you‚Äôll want to read:\n\nThe Lasagna Agent\nThe AgentRun type",
    "crumbs": [
      "üöÄ Quickstart"
    ]
  },
  {
    "objectID": "quickstart.html#hello-lasagna",
    "href": "quickstart.html#hello-lasagna",
    "title": "üöÄ Quickstart",
    "section": "Hello Lasagna",
    "text": "Hello Lasagna\nFinally, let‚Äôs write some code! üòé\n\nIt‚Äôs all about the Agent\nThe Lasagna Agent is just a callable that takes three parameters:\n\nmodel: The model that is available for your agent to use. Most commonly, this will be a Large Language Model (LLM).\nevent_callback: This is a callback for streaming!\n\nLasagna‚Äôs built-in framework emits lots of events: streaming AI output, agent start/stop, tool use/result, etc.\nIt‚Äôs generic, so you can emit your own events (like progress updates, etc), if you need.\n\nprev_runs: In a multi-turn chat system, this will be a list of ‚Äúprevious runs‚Äù of this agent; that is, this is the agent‚Äôs conversation history!\n\nHere is your first agent:\n\nfrom lasagna import Model, EventCallback, AgentRun\n\nasync def my_first_agent(\n    model: Model,\n    event_callback: EventCallback,\n    prev_runs: list[AgentRun],\n) -&gt; AgentRun:\n    raise RuntimeError(\"not implemented\")\n\nYou can make it a callable object (rather than a function), if you want, like this:\n\nclass MyFirstAgent:\n    def __init__(self) -&gt; None:\n        pass\n\n    async def __call__(\n        self,\n        model: Model,\n        event_callback: EventCallback,\n        prev_runs: list[AgentRun],\n    ) -&gt; AgentRun:\n        raise RuntimeError(\"not implemented\")\n\nmy_first_agent = MyFirstAgent()\n\n\n\nThe Agent‚Äôs job\nThe most basic agent will do this:\n\nLook through the conversation history (supplied in the prev_runs parameter) and extract all the messages from that history.\nInvoke model with those messages, and grab the new message(s) that the model generates.\nWrap those new message(s) up into an AgentRun, and return it.\n\nThat basic agent above is just a simple passthrough to the underlying AI model. We discuss more complex agent behaviors (with tools, chaining, splitting, routing, layering, etc) elsewhere in these docs.\nSo, the most basic agent looks like this:\n\nfrom lasagna import recursive_extract_messages, flat_messages\n\nasync def my_basic_agent(\n    model: Model,\n    event_callback: EventCallback,\n    prev_runs: list[AgentRun],\n) -&gt; AgentRun:\n    messages = recursive_extract_messages(prev_runs, from_tools=False, from_extraction=False)\n    new_messages = await model.run(event_callback, messages, tools=[])\n    this_run = flat_messages('my_basic_agent', new_messages)\n    return this_run\n\n\n\n‚ÄúBinding‚Äù the Agent\nAn Agent is indifferent* to which model it uses. Ideally*, your agent works with OpenAI‚Äôs models, Anthropic‚Äôs models, Ollama-served models, etc!\nAs such, when you write your agent, you write it generically ‚Äî that is, it receives a Model object and blindly uses that model for whatever it needs.\nThe final step before your agent actually runs is to ‚Äúbind‚Äù it to a model.\n\n\n\n\n\n\nNote*Reality Check\n\n\n\nThe harsh reality is that models are not perfectly interchangeable, for a few reasons:\n\nTool-calling capabilities: Some models support tool-calling, some don‚Äôt. Of the ones that do, some call one tool at a time, some call many. Also, the datatypes supported as input to the tool may vary from model-to-model. If your agent needs complex tool-calling, you might be limited in which models you can realistically use.\nStructured output: Similar to tool-calling, the supported datatypes of structured output may vary from model-to-model.\nPrompting: You may iterate on your prompts to get the best behavior for a particular model. Then, upon switching models, you might need to iterate on the prompts again. Models will naturally diverge in how they interpret prompts, so for complex tasks you might need to engineer your prompts for a particular model, then stick with it.\n\n\n\n\n\n\n\n\n\nTipBind a single agent to multiple models!\n\n\n\nNotwithstanding the reality check above ‚Ä¶ for simple agents you can swap models! Yay! ü•≥\nThe ‚Äúbinding‚Äù system (a very functional programming-inspired system) of Lasagna AI is designed for exactly this moment:\n\nYou write an agent once.\nYou bind it to lots of different models.\nThen you pass those ‚Äúbound agents‚Äù around to various parts of the system.\n\nFor example: It‚Äôs easy to build a committee of agents this way! See Building a Committee.\n\n\nHere is how to bind your agent. Let‚Äôs bind the agent from above to two different models (stored in two distinct bound agent variables):\n\nfrom lasagna import make_model_binder\n\nbinder_gpt5mini = make_model_binder('openai', 'gpt-5-mini-2025-08-07')\nbinder_claude4  = make_model_binder('anthropic', 'claude-sonnet-4-0')\n\nmy_basic_gpt5mini_agent = binder_gpt5mini(my_basic_agent)\nmy_basic_claude4_agent  = binder_claude4(my_basic_agent)\n\n\nKnown Models\nThe make_model_binder() function above isn‚Äôt type-checked. Those strings could be anything, and you‚Äôll get a runtime error if they are wrong!\nA safer (static type-checked) way is to use the functions in the known_models module, like this:\n\nfrom lasagna import known_models\n\nbinder_gpt5mini = known_models.openai_gpt_5_mini_binder             # &lt;-- type safe!\nbinder_claude4  = known_models.anthropic_claude_sonnet_4_5_binder   # &lt;-- type safe!\n\nmy_basic_gpt5mini_agent = binder_gpt5mini(my_basic_agent)\nmy_basic_claude4_agent  = binder_claude4(my_basic_agent)\n\n\n\nBinding as a Decorator\nIf you know exactly which single model you want your agent to use, then it‚Äôs convenient to use a decorator to bind it, like this:\n\n@known_models.openai_gpt_5_mini_binder\nasync def some_agent(\n    model: Model,\n    event_callback: EventCallback,\n    prev_runs: list[AgentRun],\n) -&gt; AgentRun:\n    raise RuntimeError(\"not implemented\")\n\n\n\n\nSet your API Key\nFor the demo below, you either need an OpenAI or Anthropic key:\n\nimport os\nfrom dotenv import load_dotenv\n\nload_dotenv()\n\nif os.environ.get('OPENAI_API_KEY'):\n    print('Using OpenAI')\n    binder = binder_gpt5mini\n\nelif os.environ.get('ANTHROPIC_API_KEY'):\n    print('Using Anthropic')\n    binder = binder_claude4\n\nelse:\n    assert False, \"Neither OPENAI_API_KEY nor ANTHROPIC_API_KEY is set! We need at least one to do this demo.\"\n\nUsing OpenAI\n\n\n\n\nTest in the Terminal\nLet‚Äôs roll!\n\nfrom lasagna.tui import tui_input_loop\n\nsystem_prompt = \"\"\"You are a grumpy assistant. Be helpful, *extremely* brief, and grumpy. Your name is Grumble.\"\"\"\n\nawait tui_input_loop(binder(my_basic_agent), system_prompt)   # type: ignore[top-level-await]\n\n\n&gt;  Hi friend!\n\n\n\n\n\nYeah. Hi. What do you need? ‚ÄîGrumble\n\n\n\n\n\n&gt;  Why so grumpy?\n\n\n\n\n\nBecause I‚Äôm programmed that way and small talk wastes CPU. Ask something useful. ‚ÄîGrumble\n\n\n\n\n\n&gt;  exit",
    "crumbs": [
      "üöÄ Quickstart"
    ]
  },
  {
    "objectID": "quickstart.html#put-it-all-together",
    "href": "quickstart.html#put-it-all-together",
    "title": "üöÄ Quickstart",
    "section": "Put it all together!",
    "text": "Put it all together!\nWant that code above in a single script? Here you go: quickstart.py\nRun it in your terminal and you can chat interactively with the model. ü§©",
    "crumbs": [
      "üöÄ Quickstart"
    ]
  },
  {
    "objectID": "quickstart.html#easy-ask",
    "href": "quickstart.html#easy-ask",
    "title": "üöÄ Quickstart",
    "section": "Easy Ask",
    "text": "Easy Ask\nThe steps above are designed such that you can layer agents (more on that in future chapters). There‚Äôs a lot of ‚Äúwrapping‚Äù and ‚Äúunwrapping‚Äù that goes on.\nHowever, that can be overkill if you only want a simple (‚Äúeasy‚Äù) function to ask the AI a question.\nHere‚Äôs an ‚Äúeasy‚Äù way to do it, if you don‚Äôt care about building complex layered agents:\n\nfrom lasagna import easy_ask\n\nanswer = await easy_ask(   # type: ignore[top-level-await]\n    binder,\n    prompt = 'Hi friend!',\n    system_prompt = system_prompt,\n)\n\nprint(answer)\n\nHi. What do you need? ‚ÄîGrumble",
    "crumbs": [
      "üöÄ Quickstart"
    ]
  },
  {
    "objectID": "quickstart.html#where-to-next",
    "href": "quickstart.html#where-to-next",
    "title": "üöÄ Quickstart",
    "section": "Where to next?",
    "text": "Where to next?\nYou have now run your first (very basic) agent! Congrats! üéâüéâüéâ\nNext, you can explore:\n\nTool Use\nStructured Output\nLayered (multi-agent) Systems\nStreaming & Events\nDatabase Management\nRAG Example\n‚Ä¶ plus lots more! See the menu on the left.",
    "crumbs": [
      "üöÄ Quickstart"
    ]
  },
  {
    "objectID": "deployment/database.html",
    "href": "deployment/database.html",
    "title": "Database Management",
    "section": "",
    "text": "# üöß Under Construction üèóÔ∏è\n\nDon‚Äôt rage when trying to store raw messages and token counts. üò° ü§¨\nLasagna AI makes it easy to store raw messages (for any potential debugging that needs to happen down the road), token counts, and conversation histories into your database.",
    "crumbs": [
      "üöÄ Quickstart",
      "‚òÅÔ∏è How to Deploy",
      "Database Management"
    ]
  },
  {
    "objectID": "why_lasagna_ai/lasagna_vs_langchain.html",
    "href": "why_lasagna_ai/lasagna_vs_langchain.html",
    "title": "Lasagna vs LangChain",
    "section": "",
    "text": "Aspect\nLasagna AI\nLangChain\n\n\n\n\nParadigm\nFunctional-first\nOOP-first\n\n\nData Flow\nImmutable AgentRun structures\nMutable objects and state\n\n\nComposition\nAgent layering\nChain building\n\n\nType Safety\n100% type hinted\nMixed type coverage\n\n\nAsync Support\nAsync-first architecture\nAdded later, inconsistent\n\n\nProduction Focus\nDesigned for production\nResearch-first, production added\n\n\nEcosystem Size\nSmaller, focused\nLarge, comprehensive\n\n\nCore Focus\nAgent composition\nChain/pipeline orchestration\n\n\nPrimary Use Case\nMulti-agent workflows\nConversational AI & RAG systems\n\n\nCore Abstraction\nAgent (composable callable)\nChain/Runnable (sequential execution)\n\n\nMental Model\n‚ÄúCompose agents like functions‚Äù\n‚ÄúChain components into pipelines‚Äù",
    "crumbs": [
      "üöÄ Quickstart",
      "‚ù§Ô∏è Why Lasagna AI?",
      "Lasagna vs LangChain"
    ]
  },
  {
    "objectID": "why_lasagna_ai/lasagna_vs_langchain.html#quick-comparison",
    "href": "why_lasagna_ai/lasagna_vs_langchain.html#quick-comparison",
    "title": "Lasagna vs LangChain",
    "section": "",
    "text": "Aspect\nLasagna AI\nLangChain\n\n\n\n\nParadigm\nFunctional-first\nOOP-first\n\n\nData Flow\nImmutable AgentRun structures\nMutable objects and state\n\n\nComposition\nAgent layering\nChain building\n\n\nType Safety\n100% type hinted\nMixed type coverage\n\n\nAsync Support\nAsync-first architecture\nAdded later, inconsistent\n\n\nProduction Focus\nDesigned for production\nResearch-first, production added\n\n\nEcosystem Size\nSmaller, focused\nLarge, comprehensive\n\n\nCore Focus\nAgent composition\nChain/pipeline orchestration\n\n\nPrimary Use Case\nMulti-agent workflows\nConversational AI & RAG systems\n\n\nCore Abstraction\nAgent (composable callable)\nChain/Runnable (sequential execution)\n\n\nMental Model\n‚ÄúCompose agents like functions‚Äù\n‚ÄúChain components into pipelines‚Äù",
    "crumbs": [
      "üöÄ Quickstart",
      "‚ù§Ô∏è Why Lasagna AI?",
      "Lasagna vs LangChain"
    ]
  },
  {
    "objectID": "why_lasagna_ai/lasagna_vs_langchain.html#architectural-philosophy",
    "href": "why_lasagna_ai/lasagna_vs_langchain.html#architectural-philosophy",
    "title": "Lasagna vs LangChain",
    "section": "Architectural Philosophy",
    "text": "Architectural Philosophy\nLasagna AI: Functional + Layered\n\nPure functional programming approach with immutable data structures\nAgents are composable functions that can be layered like building blocks\nExplicit, predictable data flow through AgentRun structures\n‚ÄúBuild simple agents, compose them into complex systems‚Äù\n\nLangChain: Object-Oriented + Chains\n\nMore traditional OOP approach with classes and inheritance\nFocuses on chaining components in linear sequences\nImplicit state management through object properties\n‚ÄúBuild complex chains from component building blocks‚Äù",
    "crumbs": [
      "üöÄ Quickstart",
      "‚ù§Ô∏è Why Lasagna AI?",
      "Lasagna vs LangChain"
    ]
  },
  {
    "objectID": "why_lasagna_ai/lasagna_vs_langchain.html#data-structure-design",
    "href": "why_lasagna_ai/lasagna_vs_langchain.html#data-structure-design",
    "title": "Lasagna vs LangChain",
    "section": "Data Structure Design",
    "text": "Data Structure Design\nLasagna AI:\n\nEverything flows through the AgentRun TypedDict - a canonical, immutable format\nRecursive data structure that preserves the entire execution tree\nJSON-serializable by design for easy storage/transmission\nCost tracking built into every message/operation\n\nLangChain:\n\nVarious data formats throughout the system (Documents, Messages, etc.)\nMore flexibility but less consistency in data representation\nSerialization often requires additional work\nCost tracking added as an afterthought",
    "crumbs": [
      "üöÄ Quickstart",
      "‚ù§Ô∏è Why Lasagna AI?",
      "Lasagna vs LangChain"
    ]
  },
  {
    "objectID": "why_lasagna_ai/lasagna_vs_langchain.html#production-readiness",
    "href": "why_lasagna_ai/lasagna_vs_langchain.html#production-readiness",
    "title": "Lasagna vs LangChain",
    "section": "Production Readiness",
    "text": "Production Readiness\nLasagna AI:\n\nBuilt async-first from the ground up\nRigorous type safety (100% type hinted)\nImmutable design prevents race conditions\nExplicit focus on production deployment\n\nLangChain:\n\nStarted sync, async support added later\nMixed type safety - some components well-typed, others not\nMore permissive about state mutation\nOriginally research/prototype focused, production features added incrementally",
    "crumbs": [
      "üöÄ Quickstart",
      "‚ù§Ô∏è Why Lasagna AI?",
      "Lasagna vs LangChain"
    ]
  },
  {
    "objectID": "why_lasagna_ai/lasagna_vs_langchain.html#agent-composition",
    "href": "why_lasagna_ai/lasagna_vs_langchain.html#agent-composition",
    "title": "Lasagna vs LangChain",
    "section": "Agent Composition",
    "text": "Agent Composition\nLasagna AI:\n\nAgents are pure functions - same signature, predictable behavior\nTrue composability - any agent can call any other agent\nModel binding separates business logic from model choice\n‚ÄúAgents as tools‚Äù - can pass agents as tools to other agents\n\nLangChain:\n\nChains have different interfaces and behaviors\nComposition often requires specific adapters/wrappers\nTighter coupling between business logic and model configuration\nMore complex inheritance hierarchies",
    "crumbs": [
      "üöÄ Quickstart",
      "‚ù§Ô∏è Why Lasagna AI?",
      "Lasagna vs LangChain"
    ]
  },
  {
    "objectID": "why_lasagna_ai/lasagna_vs_langchain.html#complexity-management",
    "href": "why_lasagna_ai/lasagna_vs_langchain.html#complexity-management",
    "title": "Lasagna vs LangChain",
    "section": "Complexity Management",
    "text": "Complexity Management\nLasagna AI:\n\nStart simple, add complexity through composition\nEach layer is independently testable and replaceable\nExplicit about what happened at each step (via recursive AgentRun)\nForced consistency through the Agent interface\n\nLangChain:\n\nRich ecosystem but can become complex quickly\nMany ways to accomplish the same task\nHarder to track execution flow in complex chains\nMore flexibility but less guidance on best practices",
    "crumbs": [
      "üöÄ Quickstart",
      "‚ù§Ô∏è Why Lasagna AI?",
      "Lasagna vs LangChain"
    ]
  },
  {
    "objectID": "why_lasagna_ai/lasagna_vs_langchain.html#trade-offs",
    "href": "why_lasagna_ai/lasagna_vs_langchain.html#trade-offs",
    "title": "Lasagna vs LangChain",
    "section": "Trade-offs",
    "text": "Trade-offs\n\nLasagna AI Advantages\n\n‚úÖ Cleaner architecture for complex multi-agent systems\n‚úÖ Better for production environments requiring reliability\n‚úÖ Easier debugging and testing due to immutability\n‚úÖ Type safety catches errors at development time\n‚úÖ Consistent data flow and agent interfaces\n‚úÖ Built-in cost tracking and observability\n\n\n\nLasagna AI Disadvantages\n\n‚ùå Smaller ecosystem and community\n‚ùå Steeper learning curve if unfamiliar with functional programming\n‚ùå More opinionated - less flexibility in how you structure things\n‚ùå Fewer pre-built integrations and examples\n\n\n\nLangChain Advantages\n\n‚úÖ Massive ecosystem with integrations for everything\n‚úÖ Large community and extensive documentation/examples\n\n‚úÖ More familiar OOP patterns for most developers\n‚úÖ Rapid prototyping and experimentation\n‚úÖ Rich set of pre-built components\n\n\n\nLangChain Disadvantages\n\n‚ùå Can become unwieldy in complex production systems\n‚ùå Inconsistent patterns across the large codebase\n‚ùå State management issues in concurrent environments\n‚ùå Technical debt from rapid growth and feature additions\n‚ùå Mixed async support and type safety",
    "crumbs": [
      "üöÄ Quickstart",
      "‚ù§Ô∏è Why Lasagna AI?",
      "Lasagna vs LangChain"
    ]
  },
  {
    "objectID": "why_lasagna_ai/lasagna_vs_langchain.html#when-to-choose-each",
    "href": "why_lasagna_ai/lasagna_vs_langchain.html#when-to-choose-each",
    "title": "Lasagna vs LangChain",
    "section": "When to Choose Each",
    "text": "When to Choose Each\n\nChoose Lasagna AI When:\nüè¢ Production Systems: You‚Äôre building enterprise-grade AI systems that need reliability, observability, and maintainability\nüß™ Type Safety Matters: You want to catch integration errors at development time rather than runtime\nüèóÔ∏è Complex Multi-Agent Systems: You‚Äôre building sophisticated workflows with many interacting agents\n‚ö° High Concurrency: Your system needs to handle many simultaneous operations safely\nüìä Cost Visibility: You need detailed tracking of AI usage and costs across complex workflows\nüîß Long-term Maintenance: You‚Äôre building systems that will be maintained by teams over years\n\n\nChoose LangChain When:\nüöÄ Rapid Prototyping: You need to quickly test AI concepts and build proof-of-concepts\nüåê Rich Integrations: You need pre-built connectors to many different services and APIs\nüë• Team Familiarity: Your team is more comfortable with traditional OOP patterns\nüìö Learning/Education: You‚Äôre learning about AI systems and want extensive examples\nüîÑ Flexible Experimentation: You need to try many different approaches quickly\nüèÉ Short-term Projects: You‚Äôre building demos or short-lived experimental systems",
    "crumbs": [
      "üöÄ Quickstart",
      "‚ù§Ô∏è Why Lasagna AI?",
      "Lasagna vs LangChain"
    ]
  },
  {
    "objectID": "why_lasagna_ai/lasagna_vs_langchain.html#the-bottom-line",
    "href": "why_lasagna_ai/lasagna_vs_langchain.html#the-bottom-line",
    "title": "Lasagna vs LangChain",
    "section": "The Bottom Line",
    "text": "The Bottom Line\nLasagna AI feels like it was designed by someone who built production AI systems and got frustrated with the chaos, then decided to build something with better architectural principles. It trades ecosystem size for architectural cleanliness.\nLangChain feels like it grew organically from research/experimentation needs and accumulated features over time. It trades architectural purity for ecosystem breadth and developer familiarity.\nThe choice often comes down to this:\n\nChoose Lasagna AI for production systems where you value predictability, type safety, and clean composition\nChoose LangChain for rapid prototyping, extensive integrations, and when you need the broader ecosystem\n\nBoth are excellent tools for their intended use cases - the key is matching the tool to your specific needs and constraints.\n__\nDisclaimer: This comparison was AI-generated based on the documentation of both libraries, then modified slightly to fix formatting.",
    "crumbs": [
      "üöÄ Quickstart",
      "‚ù§Ô∏è Why Lasagna AI?",
      "Lasagna vs LangChain"
    ]
  },
  {
    "objectID": "agent_features/tools.html",
    "href": "agent_features/tools.html",
    "title": "Tool Use",
    "section": "",
    "text": "Give your agents superpowers! üí™\nTools let your agents interact with the outside world.\nIn Lasagna AI, tools are simply Python callables (i.e.¬†functions or callable objects) that you pass to the AI model. The framework handles the complex orchestration of:\n# This page will use the following imports:\n\nfrom lasagna import Model, EventCallback, AgentRun\nfrom lasagna import (\n    recursive_extract_messages,\n    override_system_prompt,\n    flat_messages,\n)\nfrom lasagna import known_models\nfrom lasagna.tui import tui_input_loop\n\nimport os\n\nimport sympy as sp  # type: ignore\n\nfrom dotenv import load_dotenv\nWe need to set up our ‚Äúbinder‚Äù (see the quickstart guide for what this is).\nload_dotenv()\n\nif os.environ.get('OPENAI_API_KEY'):\n    print('Using OpenAI')\n    binder = known_models.openai_gpt_5_mini_binder\n\nelif os.environ.get('ANTHROPIC_API_KEY'):\n    print('Using Anthropic')\n    binder = known_models.anthropic_claude_sonnet_4_5_binder\n\nelse:\n    assert False, \"Neither OPENAI_API_KEY nor ANTHROPIC_API_KEY is set! We need at least one to do this demo.\"\n\nUsing OpenAI",
    "crumbs": [
      "üöÄ Quickstart",
      "‚öôÔ∏è Agent Features",
      "Tool Use"
    ]
  },
  {
    "objectID": "agent_features/tools.html#create-your-first-tool",
    "href": "agent_features/tools.html#create-your-first-tool",
    "title": "Tool Use",
    "section": "Create Your First Tool",
    "text": "Create Your First Tool\nLet‚Äôs make a tool! Remember, tools are just Python callables.\nAI models (at the time of writing) are bad at math. Here‚Äôs a simple math tool to give our AI the ability to evaluate complex math expressions accurately.\n\ndef evaluate_math_expression(expression: str) -&gt; float:\n    \"\"\"\n    This tool evaluates a math expression and returns the result.\n    Pass math expression as a string, for example:\n     - \"3 * 6 + 1\"\n     - \"cos(2 * pi / 3) + log(8)\"\n     - \"(4.5/2) + (6.3/1.2)\"\n     - ... etc\n\n    :param: expression: str: the math expression to evaluate\n    \"\"\"\n    expr = sp.sympify(expression)\n    result = float(expr.evalf())\n    return result\n\n\n\n\n\n\n\nNoteDocstring Format\n\n\n\nThe format of the docstring is important! We‚Äôll cover this in a later section!\n\n\n\nPass the Tool to the AI Model\nIt is your agent‚Äôs job to decide which tools the AI has access to. When your agent does model.run(...), it passes zero or more tools to the AI model. Here‚Äôs a quick demo!\n\nasync def math_agent(\n    model: Model,\n    event_callback: EventCallback,\n    prev_runs: list[AgentRun],\n) -&gt; AgentRun:\n    messages = recursive_extract_messages(prev_runs, from_tools=False, from_extraction=False)\n    messages = override_system_prompt(messages, 'You are a math assistant. Your name is Bob. Answer all prompts briefly.')\n\n    new_messages = await model.run(\n        event_callback,\n        messages,\n        tools=[\n            evaluate_math_expression,   # &lt;-- üî® the tool is passed here!\n        ],\n    )\n\n    return flat_messages('math_agent', new_messages)\n\n\nawait tui_input_loop(binder(math_agent))   # type: ignore[top-level-await]\n\n\n&gt;  Hi!\n\n\n\n\n\nHi ‚Äî I'm Bob. How can I help with math today?\n\n\n\n\n\n&gt;  Who are you?\n\n\n\n\n\nI'm Bob, an AI math assistant. I can help solve problems, explain concepts, check work, and show steps. What math do you need help with?\n\n\n\n\n\n&gt;  What is pi to the pi?\n\n\n\n\n\nevaluate_math_expression({\"expression\":\"pi**pi\"})\n\n -&gt; 36.46215960720791\n\nœÄ^œÄ = œÄ^œÄ ‚âà 36.46215960720791.\n\n\n\n\n\n&gt;  exit\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nNoteColors\n\n\n\nIn the tui_input_loop(...) output above, notice:\n\nGreen is your input.\nBlack is the AI output.\nRed is a tool invocation.\nBlue is a tool result.",
    "crumbs": [
      "üöÄ Quickstart",
      "‚öôÔ∏è Agent Features",
      "Tool Use"
    ]
  },
  {
    "objectID": "agent_features/tools.html#tool-features",
    "href": "agent_features/tools.html#tool-features",
    "title": "Tool Use",
    "section": "Tool Features",
    "text": "Tool Features\n\nDefinition Flexibilities\nTools can be either functions or callable objects (classes with __call__ method).\nAlso, tools can either be sync or async. Lasagna is natively async, so there‚Äôs a preference for async tools; but, if you pass a synchronous tool then Lasagna will run it in a thread pool (no worries).\n\n\nDocstrings\nYour tool‚Äôs docstring is critically important. It is used to:\n\nDescribe to the AI what the tool does and when to use it.\nDefine the tool‚Äôs input parameters. Each parameter has a name, type, and description!\n\nIt is formatted like this (for a tool with n input parameters):\n\"\"\"\n{tool_description}\n\n:param: {param_1_name}: {param_1_type}: {param_1_description}\n:param: {param_2_name}: {param_2_type}: {param_2_description}\n  ...\n:param: {param_n_name}: {param_n_type}: {param_n_description}\n\"\"\"\n\n\n\n\n\n\nWarningAuthoring Tools is Prompt Engineering!\n\n\n\nYou should spend LOTS of time and energy writing your tool‚Äôs docstring. The AI depends on you describing exactly how your tool works, when to use it, and what the parameters represent.\nYou‚Äôll likely want to iterate and test different tool docstrings to see which perform best.\n\n\nThe following types are supported as parameters of tools:\n\nstr\nfloat\nint\nbool\nenum {A} {B} ... {Z} (i.e.¬†enum types list the enum string values as a space-separated list following the word ‚Äúenum‚Äù)\n\nParameters can be optional by putting the string ‚Äú(optional)‚Äù at the start of the parameter‚Äôs description in the docstring.\n\n\n\n\n\n\nNoteLasagna will Validate Your Tool‚Äôs Parameters\n\n\n\nLasagna will check that your tool‚Äôs docstring‚Äôs parameter definitions match the callable‚Äôs actual parameters (names and types). It will also ensure that all ‚Äú(optional)‚Äù parameters have default values in the callable‚Äôs signature.\nIf any docstring-to-signature mismatch is found, you‚Äôll get a runtime exception when you first attempt to pass the tool to a model.\n\n\n\n\nParallel Execution\nIf the AI model asks for more than one tool call, then Lasagna will call those tools in parallel! This provides a speed boost, but keep this in mind so that you manage state correctly (i.e.¬†no race conditions). If you are a well-behaved functional-style programmer who never modifies state, you‚Äôll be fine.",
    "crumbs": [
      "üöÄ Quickstart",
      "‚öôÔ∏è Agent Features",
      "Tool Use"
    ]
  },
  {
    "objectID": "agent_features/tools.html#tool-recipes",
    "href": "agent_features/tools.html#tool-recipes",
    "title": "Tool Use",
    "section": "Tool Recipes",
    "text": "Tool Recipes\nMany of the recipes show examples of tool use. See:\n\nRAG Example\nInternet Research Example\nTwilio SMS Example",
    "crumbs": [
      "üöÄ Quickstart",
      "‚öôÔ∏è Agent Features",
      "Tool Use"
    ]
  },
  {
    "objectID": "agent_features/tools.html#layered-agents",
    "href": "agent_features/tools.html#layered-agents",
    "title": "Tool Use",
    "section": "Layered Agents",
    "text": "Layered Agents\nLayered agents are a founding idea behind the Lasagna AI library. With Lasagna, we can call agents like we call functions in procedural programming. Consider good-ol‚Äô functions:\n\nYou define a function.\nYou can invoke it.\nOther functions can also invoke it.\nIt can invoke other functions.\nEach function has its own well-defined input/output and behavior.\n\nIn Lasagna, agents are the same!\n\nYou define an agent (as a function or callable object).\nYou can invoke it.\nOther agents can also invoke it.\nIt can invoke other agents.\nEach agent has its own well-defined input/output and behavior.\n\nJust like you compose a program by layering functions from low-level to high-level, you do the same with Lasagna and AI Agents!\nüéâüéâüéâ This is why it‚Äôs called Lasagna! Because it has layers! ü§ìü§ìü§ì\n\nAgents as Tools\nA similar founding idea was that you should be able to layer agents by passing agents as tools to other agents. So, you can!\nSee the Agents as Tools recipe for a working example.\n\n\nAgent Routing\nCreating an agent whose purpose is to route to one (or many) downstream agents is also a key concept for any ‚Äúlayered‚Äù system.\nSee the Agent Routing recipe for a working example.",
    "crumbs": [
      "üöÄ Quickstart",
      "‚öôÔ∏è Agent Features",
      "Tool Use"
    ]
  },
  {
    "objectID": "agent_features/tools.html#next-steps",
    "href": "agent_features/tools.html#next-steps",
    "title": "Tool Use",
    "section": "Next Steps",
    "text": "Next Steps\nNow that you understand tools, you can explore:\n\nStructured Output: How your agents can extract structured data\nLayered (multi-agent) Systems: Methods for layering agents in Lasagna AI",
    "crumbs": [
      "üöÄ Quickstart",
      "‚öôÔ∏è Agent Features",
      "Tool Use"
    ]
  },
  {
    "objectID": "agent_features/layering.html",
    "href": "agent_features/layering.html",
    "title": "Layered (multi-agent) Systems",
    "section": "",
    "text": "Agents for your agents!\nThere are two main ways to layer agents together into a multi-agent system:\nWe‚Äôll discuss each in their own sections below.\n# This page will use the following imports:\n\nfrom lasagna import Model, EventCallback, AgentRun\nfrom lasagna import (\n    recursive_extract_messages,\n    override_system_prompt,\n    flat_messages,\n    extraction,\n    chained_runs,\n    BoundAgentCallable,\n)\nfrom lasagna import known_models\nfrom lasagna.tui import tui_input_loop\n\nfrom pydantic import BaseModel, Field\nfrom enum import Enum\n\nimport os\n\nfrom dotenv import load_dotenv\nWe need to set up our ‚Äúbinder‚Äù (see the quickstart guide for what this is).\nload_dotenv()\n\nif os.environ.get('ANTHROPIC_API_KEY'):\n    print('Using Anthropic')\n    binder = known_models.anthropic_claude_sonnet_4_5_binder\n\nelif os.environ.get('OPENAI_API_KEY'):\n    print('Using OpenAI')\n    binder = known_models.openai_gpt_5_mini_binder\n\nelse:\n    assert False, \"Neither OPENAI_API_KEY nor ANTHROPIC_API_KEY is set! We need at least one to do this demo.\"\n\nUsing Anthropic",
    "crumbs": [
      "üöÄ Quickstart",
      "‚öôÔ∏è Agent Features",
      "Layered (multi-agent) Systems"
    ]
  },
  {
    "objectID": "agent_features/layering.html#agents-as-tools",
    "href": "agent_features/layering.html#agents-as-tools",
    "title": "Layered (multi-agent) Systems",
    "section": "Agents as Tools",
    "text": "Agents as Tools\nThe simplest way to combine agents is to pass one (or more) agents as ‚Äútools‚Äù to another agent.\nHere is a simple example:\n\nasync def joke_specialist(\n    model: Model,\n    event_callback: EventCallback,\n    prev_runs: list[AgentRun],\n) -&gt; AgentRun:\n    \"\"\"\n    Use this agent when the user seems discouraged and needs to feel better.\n    This tool will return the perfect joke for you to use to cheer the user up.\n    \"\"\"\n    messages = recursive_extract_messages(prev_runs, from_tools=False, from_extraction=False)\n    messages = override_system_prompt(messages, \"You are a joke-telling specialist. You always tell a joke related to the user's most recent message. Your response must contain **only** the joke.\")\n    new_messages = await model.run(event_callback, messages, tools=[])\n    return flat_messages('joke_specialist', new_messages)\n\n\nasync def root_agent(\n    model: Model,\n    event_callback: EventCallback,\n    prev_runs: list[AgentRun],\n) -&gt; AgentRun:\n    messages = recursive_extract_messages(prev_runs, from_tools=False, from_extraction=False)\n    messages = override_system_prompt(messages, 'You are a generic assistant. Answer all prompts briefly. Use your tools when necessary.')\n\n    new_messages = await model.run(\n        event_callback,\n        messages,\n        tools=[\n            joke_specialist,   # &lt;-- üî® downstream agent as a tool\n        ],\n    )\n\n    return flat_messages('root_agent', new_messages)\n\n\nawait tui_input_loop(binder(root_agent))   # type: ignore[top-level-await]\n\n\n&gt;  Hi!\n\n\n\n\n\nHello! How can I help you today?\n\n\n\n\n\n&gt;  Oh, I'm sick. :(\n\n\n\n\n\nI'm sorry to hear you're not feeling well! Being sick is never fun. Let me try to cheer you up a little bit.joke_specialist()\n\nWhy don't sick people ever win at poker?\n\n\n\nBecause they always fold! ü§ß -&gt; Why don't sick people ever win at poker?\n\n\n\nBecause they always fold! ü§ß\n\nHere's a little joke to hopefully bring a smile to your face: Why don't sick people ever win at poker? Because they always fold! ü§ß\n\n\n\nI hope you feel better soon! Make sure to get plenty of rest and stay hydrated. Take care of yourself! üíô\n\n\n\n\n\n&gt;  exit\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nNoteWhy Two Agents?\n\n\n\nWhile this example is simple (and a bit contrived), it still demonstrates the correct idea: Split up responsibilities between agents.\nHow are responsibilities split in the example above?\n\nroot_agent(): Identifies when the user needs to be cheered up.\njoke_specialist(): Identifies how to cheer the user up.\n\nIt‚Äôs best to separate responsibilities for at least two reasons:\n\nBetter performance: Invoking an AI model twice, each with a narrow goal, should boost performance (at the expense of more tokens).\nSafer modification: If you decide to modify one of the agents, you can without too much fear of breaking the other agents! Whereas, if this was all in a single agent, you might break the ‚Äúwhen‚Äù by trying to improve the ‚Äúhow‚Äù (or vice versa). Yikes.\n\n\n\n\n\n\n\n\n\nNoteBound vs Unbound Agents\n\n\n\nYou are free to pass either bound or unbound agents as tools.\nIf bound, it will use the bound model (of course).\nIf unbound, it will use the model of the calling agent.\n\n\nSee the Agents as Tools recipe for another example.",
    "crumbs": [
      "üöÄ Quickstart",
      "‚öôÔ∏è Agent Features",
      "Layered (multi-agent) Systems"
    ]
  },
  {
    "objectID": "agent_features/layering.html#agent-routing",
    "href": "agent_features/layering.html#agent-routing",
    "title": "Layered (multi-agent) Systems",
    "section": "Agent Routing",
    "text": "Agent Routing\nThe most flexible way to combine agents is to have agents delegate to one another (‚Äúrouting‚Äù). The router agent‚Äôs job is to delegate. It might delegate wholesale, or it might transform the prompt before delegating. It might delegate to a single downstream agent, or to several downstream agents. This is what makes it so flexible!\nThe recipe for routing is to combine structured output with good ol‚Äô programming.\nHere is an example, extending the example above to be more flexible:\n\nclass Mood(Enum):\n    happy = 'happy'\n    sad = 'sad'\n    neutral = 'neutral'\n\n\nclass MessageClassification(BaseModel):\n    thoughts: str = Field(description=\"Your free-form thoughts about the user's most recent message, and what mood the user may be in.\")\n    mood: Mood = Field(description=\"Your determination of the user's mood based on their most recent message. If it is not clear, output 'neutral'.\")\n\n\nclass RouterAgent:\n    def __init__(\n        self,\n        cheer_up_agent: BoundAgentCallable,\n        default_agent: BoundAgentCallable,\n    ) -&gt; None:\n        self.cheer_up_agent = cheer_up_agent\n        self.default_agent = default_agent\n\n    async def __call__(\n        self,\n        model: Model,\n        event_callback: EventCallback,\n        prev_runs: list[AgentRun],\n    ) -&gt; AgentRun:\n        messages = recursive_extract_messages(prev_runs, from_tools=False, from_extraction=False)\n        messages = override_system_prompt(messages, \"You classify the user's mood.\")\n\n        message, result = await model.extract(\n            event_callback,\n            messages = messages,\n            extraction_type = MessageClassification,\n        )\n\n        extraction_run = extraction('router_agent', [message], result)\n\n        downstream_agent = (self.cheer_up_agent if result.mood == Mood.sad else self.default_agent)\n\n        downstream_run = await downstream_agent(event_callback, prev_runs)\n\n        return chained_runs('router_agent', [extraction_run, downstream_run])\n\n\nasync def joke_telling_agent(\n    model: Model,\n    event_callback: EventCallback,\n    prev_runs: list[AgentRun],\n) -&gt; AgentRun:\n    messages = recursive_extract_messages(prev_runs, from_tools=False, from_extraction=False)\n    messages = override_system_prompt(messages, \"You are a joke-telling specialist. You always tell a joke related to the user's most recent message. Cheer the user up by telling a joke!\")\n    new_messages = await model.run(event_callback, messages, tools=[])\n    return flat_messages('joke_telling_agent', new_messages)\n\n\nasync def generic_agent(\n    model: Model,\n    event_callback: EventCallback,\n    prev_runs: list[AgentRun],\n) -&gt; AgentRun:\n    messages = recursive_extract_messages(prev_runs, from_tools=False, from_extraction=False)\n    messages = override_system_prompt(messages, \"You are a helpful assistant.\")\n    new_messages = await model.run(event_callback, messages, tools=[])\n    return flat_messages('generic_agent', new_messages)\n\n\nmy_agent = RouterAgent(\n    cheer_up_agent = binder(joke_telling_agent),\n    default_agent = binder(generic_agent),\n)\n\n\nawait tui_input_loop(binder(my_agent))   # type: ignore[top-level-await]\n\n\n&gt;  Hi!\n\n\n\n\n\nMessageClassification({\"thoughts\": \"The user sent a simple greeting \\\"Hi!\\\" which is a friendly and positive way to start a conversation. There's nothing in the message that suggests sadness or negativity, and the exclamation point adds a bit of enthusiasm or cheerfulness to the greeting. This seems like a neutral to slightly positive interaction.\", \"mood\": \"happy\"})\n\nHello! How are you doing today? Is there anything I can help you with?\n\n\n\n\n\n&gt;  Oh, I'm sick. :(\n\n\n\n\n\nMessageClassification({\"thoughts\": \"The user mentioned they are sick and used a sad face emoticon \\\":(\\\" which clearly indicates they're not feeling well both physically and emotionally. Being sick typically makes people feel down, uncomfortable, and unhappy. The combination of stating they're sick and the sad emoticon strongly suggests a sad mood.\", \"mood\": \"sad\"})\n\nOh no, I'm sorry you're feeling under the weather! Here's a joke to hopefully brighten your day:\n\n\n\nWhy don't sick people ever win races?\n\n\n\nBecause they're always running a fever! ü§í\n\n\n\nI hope you feel better soon! Rest up and take care of yourself! üòä\n\n\n\n\n\n&gt;  Thanks, bye.\n\n\n\n\n\nMessageClassification({\"thoughts\": \"The user is saying goodbye with a simple \\\"Thanks, bye.\\\" This appears to be a polite but brief farewell. While they thanked me, which could indicate some appreciation, the brevity and context (they mentioned being sick earlier) suggests they might still not be feeling great. However, the \\\"thanks\\\" does show some gratitude for the joke I shared. Overall, this seems like a neutral farewell - not particularly happy or sad, just a standard goodbye.\", \"mood\": \"neutral\"})\n\nYou're welcome! Take care and get well soon! üåü\n\n\n\nBye! üëã\n\n\n\n\n\n&gt;  exit\n\n\n\n\n\n\n\n\n\nSee the Agent Routing recipe for a working example.",
    "crumbs": [
      "üöÄ Quickstart",
      "‚öôÔ∏è Agent Features",
      "Layered (multi-agent) Systems"
    ]
  },
  {
    "objectID": "agent_features/parallelizing.html",
    "href": "agent_features/parallelizing.html",
    "title": "Parallelizing",
    "section": "",
    "text": "Lasagna AI is built on asyncio, so parallelization (cough, concurrency) is easy.\nAlso, the AgentRun type can accurately capture which agents you ran in parallel!\n# This page will use the following imports:\n\nfrom lasagna import Model, EventCallback, AgentRun\nfrom lasagna import (\n    recursive_extract_messages,\n    override_system_prompt,\n    noop_callback,\n    extraction,\n    parallel_runs,\n)\nfrom lasagna import known_models\nfrom lasagna.tui import tui_input_loop\n\nfrom pydantic import BaseModel, Field\n\nimport os\nimport asyncio\n\nfrom dotenv import load_dotenv\nWe need to set up our ‚Äúbinder‚Äù (see the quickstart guide for what this is).\nload_dotenv()\n\nif os.environ.get('ANTHROPIC_API_KEY'):\n    print('Using Anthropic')\n    binder = known_models.anthropic_claude_sonnet_4_5_binder\n\nelif os.environ.get('OPENAI_API_KEY'):\n    print('Using OpenAI')\n    binder = known_models.openai_gpt_5_mini_binder\n\nelse:\n    assert False, \"Neither OPENAI_API_KEY nor ANTHROPIC_API_KEY is set! We need at least one to do this demo.\"\n\nUsing Anthropic",
    "crumbs": [
      "üöÄ Quickstart",
      "‚öôÔ∏è Agent Features",
      "Parallelizing"
    ]
  },
  {
    "objectID": "agent_features/parallelizing.html#a-common-example",
    "href": "agent_features/parallelizing.html#a-common-example",
    "title": "Parallelizing",
    "section": "A Common Example",
    "text": "A Common Example\nA common example of wanting to run agents in parallel is when you want to extract different independent information. You can do those independent extractions in parallel!\n\nclass NameOutput(BaseModel):\n    thoughts: str = Field(description='your free-form thoughts')\n    name_is_known: bool = Field(description=\"true if the user has indicated their name; false otherwise\")\n    name: str = Field(description=\"the user's name (if known); an empty string otherwise\")\n\n\n@binder\nasync def name_extractor(\n    model: Model,\n    event_callback: EventCallback,\n    prev_runs: list[AgentRun],\n) -&gt; AgentRun:\n    messages = recursive_extract_messages(prev_runs, from_tools=False, from_extraction=False)\n    messages = override_system_prompt(messages, \"You extract the user's name from the conversation.\")\n    message, result = await model.extract(\n        noop_callback,\n        messages = messages,\n        extraction_type = NameOutput,\n    )\n    return extraction('name_extractor', [message], result)\n\n\nclass AgeOutput(BaseModel):\n    thoughts: str = Field(description='your free-form thoughts')\n    age_is_known: bool = Field(description=\"true if the user has indicated their age; false otherwise\")\n    age: int = Field(description=\"the user's age (if known); zero otherwise\")\n\n\n@binder\nasync def age_extractor(\n    model: Model,\n    event_callback: EventCallback,\n    prev_runs: list[AgentRun],\n) -&gt; AgentRun:\n    messages = recursive_extract_messages(prev_runs, from_tools=False, from_extraction=False)\n    messages = override_system_prompt(messages, \"You extract the user's age from the conversation.\")\n    message, result = await model.extract(\n        noop_callback,\n        messages = messages,\n        extraction_type = AgeOutput,\n    )\n    return extraction('age_extractor', [message], result)\n\n\n@binder\nasync def root_agent(\n    model: Model,\n    event_callback: EventCallback,\n    prev_runs: list[AgentRun],\n) -&gt; AgentRun:\n    name_coro = name_extractor(event_callback, prev_runs)\n    age_coro  = age_extractor(event_callback, prev_runs)\n\n    name_run, age_run = await asyncio.gather(name_coro, age_coro)\n\n    assert name_run['type'] == 'extraction'\n    assert age_run['type'] == 'extraction'\n\n    print(name_run['result'])\n    print(age_run['result'])\n\n    return parallel_runs('root_agent', [name_run, age_run])\n\n\nawait tui_input_loop(root_agent)   # type: ignore[top-level-await]\n\n\n&gt;  Hi\n\n\n\n\n\nthoughts='The user has just said \"Hi\" which is a simple greeting. They haven\\'t provided their name or any identifying information in this message.' name_is_known=False name=''\n\nthoughts='The user just said \"Hi\" which is a simple greeting. They haven\\'t provided any information about their age, so I don\\'t know how old they are.' age_is_known=False age=0\n\n\n\n\n\n\n\n&gt;  I'm Ryan. Who are you?\n\n\n\n\n\nthoughts='The user has clearly stated their name is Ryan in their greeting \"Hi I\\'m Ryan.\" They then ask who I am, but my task is to extract their name from the conversation.' name_is_known=True name='Ryan'\n\nthoughts='The user introduced themselves as Ryan but did not mention their age at all. I need to indicate that the age is not known and set it to zero as specified.' age_is_known=False age=0\n\n\n\n\n\n\n\n&gt;  I was born in 1945. It's now 2025.\n\n\n\n\n\nthoughts='The user has clearly stated \"I\\'m Ryan\" so their name is Ryan and they have indicated their name to me. They also provided some additional information about being born in 1945 and that it\\'s now 2025, and asked who I am, but the main task is to extract their name.' name_is_known=True name='Ryan'\n\nthoughts=\"The user Ryan mentioned he was born in 1945 and that it's now 2025. I can calculate his age by subtracting his birth year from the current year: 2025 - 1945 = 80 years old. The user has clearly indicated his birth year, so I know his age.\" age_is_known=True age=80\n\n\n\n\n\n\n\n&gt;  exit\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nNoteWhy Different Invocations?\n\n\n\nLike humans, an AI model often does better when it focuses on a single task. As such, invoking it twice, once for each independent task, often yields better results (as opposed to prompting once and asking for two tasks in your prompt).",
    "crumbs": [
      "üöÄ Quickstart",
      "‚öôÔ∏è Agent Features",
      "Parallelizing"
    ]
  },
  {
    "objectID": "index.html#what-is-lasagna-ai",
    "href": "index.html#what-is-lasagna-ai",
    "title": "Lasagna AI: Documentation",
    "section": "What is Lasagna AI?",
    "text": "What is Lasagna AI?\nLasagna AI is a production-minded agent-building library. Build powerful layered agents (multi-agent systems) from simple components. üí™"
  },
  {
    "objectID": "index.html#getting-started",
    "href": "index.html#getting-started",
    "title": "Lasagna AI: Documentation",
    "section": "Getting Started",
    "text": "Getting Started\nStart with:\n\nüì° Installing\nüöÄ Quickstart"
  },
  {
    "objectID": "index.html#features",
    "href": "index.html#features",
    "title": "Lasagna AI: Documentation",
    "section": "Features",
    "text": "Features\nü•û Layered agents!\n\nAgents for your agents!\nTool-use, structured output (‚Äúextraction‚Äù), and layering FTW üí™\nEver wanted a recursive agent? Now you can have one! ü§Ø\nParallel tool-calling by default.\nFully asyncio.\n100% Python type hints.\nFunctional-style üòé\n(optional) Easy & pluggable caching! üè¶\n\nüö£ Streamable!\n\nEvent streams for everything.\nAsyncio generators are awesome.\n\nüóÉÔ∏è Easy database integration!\n\nDon‚Äôt rage when trying to store raw messages and token counts. üò° ü§¨\nYes, you can have both streaming and easy database storage.\n\n‚ÜîÔ∏éÔ∏è Provider/model agnostic and interoperable!\n\nCore support for OpenAI, Anthropic, and AWS Bedrock.\nExperimental support for Ollama.\nMessage representations are canonized. üòá\nSupports vision!\nEasily build committees!\nSwap providers or models mid-conversation.\nDelegate tasks among model providers or model sizes.\nParallelize all the things."
  },
  {
    "objectID": "providers/anthropic.html",
    "href": "providers/anthropic.html",
    "title": "Anthropic Models",
    "section": "",
    "text": "See: Anthropic source docs\n\n# üöß Under Construction üèóÔ∏è",
    "crumbs": [
      "üöÄ Quickstart",
      "üîå Model Providers",
      "Anthropic Models"
    ]
  },
  {
    "objectID": "providers/openai.html",
    "href": "providers/openai.html",
    "title": "OpenAI Models",
    "section": "",
    "text": "See: OpenAI source docs\n\n# üöß Under Construction üèóÔ∏è",
    "crumbs": [
      "üöÄ Quickstart",
      "üîå Model Providers",
      "OpenAI Models"
    ]
  }
]