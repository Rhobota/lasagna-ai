<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.33">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>The Lasagna Agent ‚Äì Lasagna AI: Documentation</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<link href="../what_is_an_agent/type_agentrun.html" rel="next">
<link href="../why_lasagna_ai/lasagna_vs_llamaindex.html" rel="prev">
<link href="../assets/Lasagna AI - Logo - Square - SMOOSHED.png" rel="icon" type="image/png">
<script src="../site_libs/quarto-html/quarto.js" type="module"></script>
<script src="../site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-ea385d0e468b0dd5ea5bf0780b1290d9.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap-67d7d124950b7fa853046764b801d6c3.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="../styles.css">
<meta property="og:title" content="The Lasagna Agent ‚Äì Lasagna AI: Documentation">
<meta property="og:description" content="">
<meta property="og:site_name" content="Lasagna AI: Documentation">
</head>

<body class="nav-sidebar docked nav-fixed quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a href="../index.html" class="navbar-brand navbar-brand-logo">
    <img src="../assets/Lasagna AI - Logo - Square - SMOOSHED.png" alt="" class="navbar-logo">
    </a>
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">Lasagna AI: Documentation</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link active" href="../quickstart.html" aria-current="page"> 
<span class="menu-text">üöÄ Quickstart</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../about.html"> 
<span class="menu-text">üí° About</span></a>
  </li>  
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/Rhobota/lasagna-ai" target="_blank"> <i class="bi bi-github" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../what_is_an_agent/agent.html">ü§ñ What is an Agent?</a></li><li class="breadcrumb-item"><a href="../what_is_an_agent/agent.html">The Lasagna Agent</a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
    </div>
  </nav>
  <div id="quarto-announcement" data-announcement-id="81bf19ec54dba8e7699631843dfb8729" class="alert alert-primary hidden"><i class="bi bi-emoji-smile quarto-announcement-icon"></i><div class="quarto-announcement-content">
<p>You found <strong>Lasagna AI</strong>!</p>
</div></div>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation docked overflow-auto">
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../installing.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">üì° Install Lasagna AI</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../quickstart.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">üöÄ Quickstart</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true">
 <span class="menu-text">‚ù§Ô∏è Why Lasagna AI?</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../why_lasagna_ai/lasagna_vs_langchain.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Lasagna vs LangChain</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../why_lasagna_ai/lasagna_vs_llamaindex.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Lasagna vs LlamaIndex</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true">
 <span class="menu-text">ü§ñ What is an Agent?</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../what_is_an_agent/agent.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">The Lasagna Agent</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../what_is_an_agent/type_agentrun.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">The <code>AgentRun</code> type</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true">
 <span class="menu-text">‚öôÔ∏è Agent Features</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../agent_features/tools.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Tool Use</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../agent_features/structured_output.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Structured Output</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../agent_features/layering.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Layered (multi-agent) Systems</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../agent_features/routing.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Agent Routing</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../agent_features/parallelizing.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Parallelizing</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../agent_features/recursive_agent.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Recursive Agent</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../agent_features/caching.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Caching Decorator</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true">
 <span class="menu-text">üòã Recipes</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../recipes/rag.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">RAG Example</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../recipes/internet_research.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Internet Research Example</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../recipes/sms.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Twilio SMS Example</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../recipes/layered_agents.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Layered Agents Example</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../recipes/committee.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Committee Example</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../recipes/vision.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Vision Example</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../recipes/swapping_providers.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Model-swap Example</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../recipes/delegating_subtasks.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Delegation Example</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../recipes/parallelize.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Parallelization Example</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="true">
 <span class="menu-text">üîå Model Providers</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../providers/openai.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">OpenAI Models</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../providers/anthropic.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Anthropic Models</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../providers/aws_bedrock.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">AWS Bedrock Models</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../providers/ollama.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Ollama Models</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../providers/nvidia.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">NVIDIA NIM/NGC Models</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" role="navigation" aria-expanded="true">
 <span class="menu-text">‚òÅÔ∏è How to Deploy</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-6" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../deployment/streaming_and_events.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Streaming &amp; Events</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../deployment/database.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Database Management</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-7" role="navigation" aria-expanded="true">
 <span class="menu-text">ü§î Misc Topics</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-7" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-7" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../misc/python_asyncio.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Intro to Python Asyncio</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../misc/python_type_hints.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Intro to Python Type Hints</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../misc/functional_programming.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Functional Programming</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../about.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">üí° About</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#what-is-an-agent" id="toc-what-is-an-agent" class="nav-link active" data-scroll-target="#what-is-an-agent">What is an <em>Agent</em>?</a>
  <ul class="collapse">
  <li><a href="#what-is-agency" id="toc-what-is-agency" class="nav-link" data-scroll-target="#what-is-agency">What is <em>Agency</em>?</a></li>
  <li><a href="#what-is-an-ai-agent" id="toc-what-is-an-ai-agent" class="nav-link" data-scroll-target="#what-is-an-ai-agent">What is an <em>AI Agent</em>?</a></li>
  <li><a href="#how-does-lasagna-ai-define-an-agent" id="toc-how-does-lasagna-ai-define-an-agent" class="nav-link" data-scroll-target="#how-does-lasagna-ai-define-an-agent">How does <em>Lasagna AI</em> define an Agent?</a></li>
  </ul></li>
  <li><a href="#the-agent-interface" id="toc-the-agent-interface" class="nav-link" data-scroll-target="#the-agent-interface">The Agent Interface</a></li>
  <li><a href="#how-do-i-write-an-agent" id="toc-how-do-i-write-an-agent" class="nav-link" data-scroll-target="#how-do-i-write-an-agent">How do I write an agent?</a>
  <ul class="collapse">
  <li><a href="#analyze-the-current-situation" id="toc-analyze-the-current-situation" class="nav-link" data-scroll-target="#analyze-the-current-situation">1. Analyze the Current Situation</a></li>
  <li><a href="#make-behavioral-decisions" id="toc-make-behavioral-decisions" class="nav-link" data-scroll-target="#make-behavioral-decisions">2. Make Behavioral Decisions</a></li>
  <li><a href="#take-action" id="toc-take-action" class="nav-link" data-scroll-target="#take-action">3. Take Action</a></li>
  <li><a href="#record-its-output" id="toc-record-its-output" class="nav-link" data-scroll-target="#record-its-output">4. Record its Output</a></li>
  </ul></li>
  <li><a href="#real-agent-examples" id="toc-real-agent-examples" class="nav-link" data-scroll-target="#real-agent-examples">Real Agent Examples</a>
  <ul class="collapse">
  <li><a href="#setup" id="toc-setup" class="nav-link" data-scroll-target="#setup">Setup</a></li>
  <li><a href="#the-conversational-agent" id="toc-the-conversational-agent" class="nav-link" data-scroll-target="#the-conversational-agent">The Conversational Agent</a></li>
  <li><a href="#the-specialist-agent" id="toc-the-specialist-agent" class="nav-link" data-scroll-target="#the-specialist-agent">The Specialist Agent</a></li>
  <li><a href="#the-information-extractor" id="toc-the-information-extractor" class="nav-link" data-scroll-target="#the-information-extractor">The Information Extractor</a></li>
  <li><a href="#the-back-on-track-agent" id="toc-the-back-on-track-agent" class="nav-link" data-scroll-target="#the-back-on-track-agent">The ‚ÄòBack on Track‚Äô Agent</a></li>
  <li><a href="#the-routing-agent" id="toc-the-routing-agent" class="nav-link" data-scroll-target="#the-routing-agent">The Routing Agent</a></li>
  <li><a href="#the-task-splitter" id="toc-the-task-splitter" class="nav-link" data-scroll-target="#the-task-splitter">The Task Splitter</a></li>
  <li><a href="#do-anything" id="toc-do-anything" class="nav-link" data-scroll-target="#do-anything">Do anything!</a></li>
  </ul></li>
  <li><a href="#why-this-design" id="toc-why-this-design" class="nav-link" data-scroll-target="#why-this-design">Why This Design?</a>
  <ul class="collapse">
  <li><a href="#pluggability" id="toc-pluggability" class="nav-link" data-scroll-target="#pluggability">üîå <strong>Pluggability</strong></a></li>
  <li><a href="#layering" id="toc-layering" class="nav-link" data-scroll-target="#layering">ü•û <strong>Layering</strong></a></li>
  <li><a href="#reusability" id="toc-reusability" class="nav-link" data-scroll-target="#reusability">üîÑ <strong>Reusability</strong></a></li>
  </ul></li>
  <li><a href="#next-steps" id="toc-next-steps" class="nav-link" data-scroll-target="#next-steps">Next Steps</a></li>
  </ul>
<div class="toc-actions"><ul><li><a href="https://github.dev/Rhobota/lasagna-ai/blob/main/docs/what_is_an_agent/agent.ipynb" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/Rhobota/lasagna-ai/blob/main/docs/what_is_an_agent/agent.ipynb" class="toc-action"><i class="bi empty"></i>View source</a></li><li><a href="https://github.com/Rhobota/lasagna-ai/issues/new" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../what_is_an_agent/agent.html">ü§ñ What is an Agent?</a></li><li class="breadcrumb-item"><a href="../what_is_an_agent/agent.html">The Lasagna Agent</a></li></ol></nav>
<div class="quarto-title">
<h1 class="title">The Lasagna Agent</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<p>In Lasagna AI, an <strong>agent</strong> is a unit of AI-powered reasoning that performs <em>specific</em> work. Agents are the building blocks of your AI system ‚Äî you compose simple agents together to create powerful multi-agent workflows.</p>
<div id="mqyo5n16yb" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># This page will use the following imports:</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> lasagna <span class="im">import</span> Model, EventCallback, AgentRun</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> lasagna <span class="im">import</span> (</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>    recursive_extract_messages,</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>    extract_last_message,</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>    override_system_prompt,</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>    flat_messages,</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>    parallel_runs,</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>    chained_runs,</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>    extraction,</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> lasagna <span class="im">import</span> known_models</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> lasagna.tui <span class="im">import</span> tui_input_loop</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os</span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> re</span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> enum <span class="im">import</span> Enum</span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pydantic <span class="im">import</span> BaseModel</span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> dotenv <span class="im">import</span> load_dotenv</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="what-is-an-agent" class="level2">
<h2 class="anchored" data-anchor-id="what-is-an-agent">What is an <em>Agent</em>?</h2>
<p>A piece of software is an ‚Äúagent‚Äù if it displays some sort of ‚Äúagency.‚Äù Circular, yes, so let‚Äôs keep going‚Ä¶</p>
<section id="what-is-agency" class="level3">
<h3 class="anchored" data-anchor-id="what-is-agency">What is <em>Agency</em>?</h3>
<p><em>Agency</em> is the ability to act on one‚Äôs own behalf. That is, software has <em>agency</em> if it is allowed to <em>decide</em> and <em>act</em> on its own.</p>
<ul>
<li>Software that computes œÄ? Not much agency. It does, and always will do, one thing.</li>
<li>Software that organizes your calendar without your input? Lots of agency!</li>
</ul>
</section>
<section id="what-is-an-ai-agent" class="level3">
<h3 class="anchored" data-anchor-id="what-is-an-ai-agent">What is an <em>AI Agent</em>?</h3>
<p>The phrase ‚ÄúAI Agent‚Äù has risen in popularity since ~2024. Typically, when people use this phrase, they mean a piece of software that uses a Large Language Model (LLM*) and has some <em>tool calling</em> capability so that it can <em>affect</em> the world (e.g.&nbsp;send emails, query for today‚Äôs news, organize your calendar, etc.)</p>
<p>This is consistent with the idea of <em>agency</em> from above. An LLM, on its own, has no <em>agency</em> (it just spits tokens at you). If you connect that <em>same</em> LLM to software functions (via <em>tool calling</em>), then suddenly the LLM gains the ability to <em>act</em>, and people start calling it ‚Äúagentic‚Äù.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
*LLM vs <code>Model</code>
</div>
</div>
<div class="callout-body-container callout-body">
<p>Lasagna AI tries not to use the term ‚ÄúLLM,‚Äù but instead uses the term <code>Model</code> to refer to generative AI models. This is merely an attempt to be more generic and avoid questions like ‚Äúhow large is large?‚Äù and ‚Äúwhat about multimodal models?‚Äù</p>
</div>
</div>
</section>
<section id="how-does-lasagna-ai-define-an-agent" class="level3">
<h3 class="anchored" data-anchor-id="how-does-lasagna-ai-define-an-agent">How does <em>Lasagna AI</em> define an Agent?</h3>
<p>Everything above ‚òùÔ∏è is too theoretical. When the rubber meets the road, what actually <em>is</em> an <strong>agent</strong> inside <em>Lasagna AI</em>?</p>
<p>In <em>Lasagna</em>, an <strong>agent</strong> is a unit of work that leverages a <code>Model</code>.</p>
<p>Think of an agent as a specialized <em>worker</em> that:</p>
<ol type="1">
<li><strong>Analyzes</strong> the current situation.</li>
<li><strong>Decides</strong> what needs to be done.</li>
<li><strong>Acts</strong> using AI models and tools.</li>
<li><strong>Records</strong> its output.</li>
</ol>
<p>In Lasagna, agents are <em>composable</em>. You begin by developing individual agents, each with a narrow focus, then you <em>compose</em> them together into a complex multi-agent system. Like humans, it‚Äôs helpful to decompose and delegate tasks amongst the group.</p>
<p>In the next section, we‚Äôll see how to write <strong>agents</strong> using Lasagna AI‚Äôs interfaces.</p>
</section>
</section>
<section id="the-agent-interface" class="level2">
<h2 class="anchored" data-anchor-id="the-agent-interface">The Agent Interface</h2>
<p>Every Lasagna agent follows the same pattern ‚Äî it‚Äôs a <em>callable</em> (either a function or a callable-object) that takes exactly <strong>three parameters</strong>:</p>
<div id="tds0cpw956o" class="cell" data-execution_count="2">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="cf">async</span> <span class="kw">def</span> my_agent(</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>    model: Model,                   <span class="co"># ‚Üê the AI model available to this agent</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>    event_callback: EventCallback,  <span class="co"># ‚Üê used for streaming and event handling</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>    prev_runs: <span class="bu">list</span>[AgentRun],      <span class="co"># ‚Üê previous work, context, or conversation history</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>) <span class="op">-&gt;</span> AgentRun:</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Agent logic goes here...</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">raise</span> <span class="pp">RuntimeError</span>(<span class="st">'not yet implemented'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Let‚Äôs understand what each parameter represents:</p>
<ul>
<li><strong><code>model</code></strong>: The AI model (like GPT-4o, Claude, etc.) that your agent can use for reasoning, text generation, or decision-making.</li>
<li><strong><code>event_callback</code></strong>: A function for handling streaming events and progress updates. This enables real-time feedback as your agent works.</li>
<li><strong><code>prev_runs</code></strong>: The history of previous work. In a conversation, this contains past messages. In a workflow, this contains results from earlier steps.</li>
</ul>
<p>The agent returns an <code>AgentRun</code> ‚Äî a structured representation of what the agent generated.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
üìå Put a pin in <code>AgentRun</code>
</div>
</div>
<div class="callout-body-container callout-body">
<p>For now, just know that <code>AgentRun</code> is a core data type. We‚Äôll explore <code>AgentRun</code> in detail in the <a href="../what_is_an_agent/type_agentrun.html">next chapter</a>!</p>
</div>
</div>
</section>
<section id="how-do-i-write-an-agent" class="level2">
<h2 class="anchored" data-anchor-id="how-do-i-write-an-agent">How do I write an agent?</h2>
<p>When you sit down to write an agent, here is what you must consider:</p>
<section id="analyze-the-current-situation" class="level3">
<h3 class="anchored" data-anchor-id="analyze-the-current-situation">1. Analyze the Current Situation</h3>
<p>Your agent must <em>examine</em> <code>prev_runs</code> to understand what has happened so far. It may find:</p>
<ul>
<li>previous messages in a conversation,</li>
<li>results from earlier agents in a workflow, and/or</li>
<li>intermediate outputs from a multi-step process.</li>
</ul>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Sometimes the ‚ÄúAnalysis‚Äù is Trivial
</div>
</div>
<div class="callout-body-container callout-body">
<p>It‚Äôs common that an agent will <em>expect</em> certain types of messages, so no real ‚Äúexamination‚Äù takes place. In those cases, the agent may simply <code>assert</code> what it expects.</p>
<p>Otherwise, the agent is free to filter/clean/reformulate/branch-off <code>prev_runs</code> in any way you see fit!</p>
</div>
</div>
</section>
<section id="make-behavioral-decisions" class="level3">
<h3 class="anchored" data-anchor-id="make-behavioral-decisions">2. Make Behavioral Decisions</h3>
<p>Your agent must <em>decide</em> what to do next. It might:</p>
<ul>
<li>generate a response using the AI <code>model</code>, or</li>
<li>use the AI <code>model</code> to extract data, or</li>
<li>pass tools to the AI <code>model</code>, or</li>
<li>split its task into multiple subtasks and delegate those to downstream agents, or</li>
<li>do <em>many</em> of the things above as many times as it chooses!</li>
</ul>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Sometimes the ‚ÄúDecision‚Äù is Trivial
</div>
</div>
<div class="callout-body-container callout-body">
<p>It‚Äôs common that an agent does <em>not</em> ‚Äúdecide‚Äù anything on-the-fly; rather, you may write your agent to <em>always do</em> one of the things above. However, you are free to write an agent that <em>does</em> decide on-the-fly (perhaps via help from the AI <code>model</code> or a downstream agent), as you see fit.</p>
</div>
</div>
</section>
<section id="take-action" class="level3">
<h3 class="anchored" data-anchor-id="take-action">3. Take Action</h3>
<p>Your agent must <em>execute</em> its decision:</p>
<ul>
<li><strong>Model interaction</strong>: Invoke the AI <code>model</code> to generate text, reason about problems, or extract structured outputs.</li>
<li><strong>Tool usage</strong>: Send emails, query a database, etc.</li>
<li><strong>Agent delegation</strong>: Invoke downstream agents to handle subtasks.</li>
</ul>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Good ol‚Äô Programming Time
</div>
</div>
<div class="callout-body-container callout-body">
<p>This is good-ol‚Äô hands-on-the-keyboard write-Python-code. This is you writing code to (1) invoke the AI <code>model</code> with the correct inputs, (2) grab the AI response and make use of it, (3) connect your agents together, and (4) connect your agents to the rest of your software stack. Get to it!</p>
</div>
</div>
</section>
<section id="record-its-output" class="level3">
<h3 class="anchored" data-anchor-id="record-its-output">4. Record its Output</h3>
<p>Your agent must <em>construct</em> and <em>return</em> an <code>AgentRun</code> that contains:</p>
<ul>
<li>any new information that it generated, and/or</li>
<li>results from sub-agents it coordinated.</li>
</ul>
<div class="callout callout-style-default callout-warning callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
This is a critical step!
</div>
</div>
<div class="callout-body-container callout-body">
<p>The <code>AgentRun</code> you return here will be passed as input to other agents (or to your same agent, in the case of multi-turn chat). It‚Äôs <em>critical</em> that you record everything that happened and return it!</p>
</div>
</div>
</section>
</section>
<section id="real-agent-examples" class="level2">
<h2 class="anchored" data-anchor-id="real-agent-examples">Real Agent Examples</h2>
<p>Let‚Äôs look at some <strong>real</strong> examples to see agents in action.</p>
<section id="setup" class="level3">
<h3 class="anchored" data-anchor-id="setup">Setup</h3>
<p>Before we write and run some agents, we need to set up our ‚Äúbinder‚Äù (see the <a href="../quickstart.html">quickstart guide</a> for what this is).</p>
<div id="24107132-fa62-4eef-b641-359a4e0b1704" class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>load_dotenv()</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> os.environ.get(<span class="st">'OPENAI_API_KEY'</span>):</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">'Using OpenAI'</span>)</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>    binder <span class="op">=</span> known_models.openai_gpt_4o_binder</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a><span class="cf">elif</span> os.environ.get(<span class="st">'ANTHROPIC_API_KEY'</span>):</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">'Using Anthropic'</span>)</span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>    binder <span class="op">=</span> known_models.anthropic_claude_sonnet_4_binder</span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span>:</span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">assert</span> <span class="va">False</span>, <span class="st">"Neither OPENAI_API_KEY nor ANTHROPIC_API_KEY is set! We need at least one to do this demo."</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Using OpenAI</code></pre>
</div>
</div>
</section>
<section id="the-conversational-agent" class="level3">
<h3 class="anchored" data-anchor-id="the-conversational-agent">The Conversational Agent</h3>
<p>This is the simplest type of agent ‚Äî it uses the message history to generate a new text response:</p>
<div id="11a76b04-26e3-4296-8f50-e0391af3a366" class="cell" data-execution_count="4">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="cf">async</span> <span class="kw">def</span> chat_agent(</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>    model: Model,</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>    event_callback: EventCallback,</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>    prev_runs: <span class="bu">list</span>[AgentRun],</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>) <span class="op">-&gt;</span> AgentRun:</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Extract all previous messages from the conversation:</span></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>    messages <span class="op">=</span> recursive_extract_messages(prev_runs, from_tools<span class="op">=</span><span class="va">False</span>, from_extraction<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Use the model to generate a _new_ response:</span></span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>    new_messages <span class="op">=</span> <span class="cf">await</span> model.run(event_callback, messages, tools<span class="op">=</span>[])</span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Wrap the new messages into an `AgentRun` result:</span></span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> flat_messages(<span class="st">'chat_agent'</span>, new_messages)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="tnlh8nkl1o" class="cell" data-execution_count="5">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="cf">await</span> tui_input_loop(binder(chat_agent))   <span class="co"># type: ignore[top-level-await]</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdin">
<div class="ansi-escaped-output">
<pre><span class="ansi-green-fg ansi-bold">&gt;  Hi, my name is Ryan.
</span></pre>
</div>
</div>
<div class="cell-output cell-output-stdout">
<div class="ansi-escaped-output">
<pre>Hi Ryan! Nice to meet you. How can I help you today?
</pre>
</div>
</div>
<div class="cell-output cell-output-stdin">
<div class="ansi-escaped-output">
<pre><span class="ansi-green-fg ansi-bold">&gt;  What is my name?
</span></pre>
</div>
</div>
<div class="cell-output cell-output-stdout">
<div class="ansi-escaped-output">
<pre>Your name is Ryan! üòä
</pre>
</div>
</div>
<div class="cell-output cell-output-stdin">
<div class="ansi-escaped-output">
<pre><span class="ansi-green-fg ansi-bold">&gt;  exit
</span></pre>
</div>
</div>
<div class="cell-output cell-output-stdout">
<div class="ansi-escaped-output">
<pre></pre>
</div>
</div>
</div>
</section>
<section id="the-specialist-agent" class="level3">
<h3 class="anchored" data-anchor-id="the-specialist-agent">The Specialist Agent</h3>
<p>Agents can be specialized for particular tasks. Here‚Äôs an agent that focuses on providing helpful coding advice:</p>
<div id="fcb6728e-f852-4f5e-b533-1873a052a5a3" class="cell" data-execution_count="6">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>CODING_SYSTEM_PROMPT <span class="op">=</span> <span class="st">"""</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="st">You are a helpful coding assistant.</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="st">Provide clear, practical advice with code examples when appropriate.</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a><span class="st">Focus on best practices and explain your reasoning.</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a><span class="st">"""</span>.strip()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="ac767793-50bf-4ecb-9267-233a51e0e480" class="cell" data-execution_count="7">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="cf">async</span> <span class="kw">def</span> coding_advisor(</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>    model: Model,</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>    event_callback: EventCallback,</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>    prev_runs: <span class="bu">list</span>[AgentRun],</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>) <span class="op">-&gt;</span> AgentRun:</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Extract all previous messages from the conversation:</span></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>    messages <span class="op">=</span> recursive_extract_messages(prev_runs, from_tools<span class="op">=</span><span class="va">False</span>, from_extraction<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Generate a response with an OVERRIDDEN system prompt!</span></span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>    modified_messages <span class="op">=</span> override_system_prompt(messages, CODING_SYSTEM_PROMPT)</span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a>    new_messages <span class="op">=</span> <span class="cf">await</span> model.run(event_callback, modified_messages, tools<span class="op">=</span>[])</span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Wrap the new messages into an `AgentRun` result:</span></span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> flat_messages(<span class="st">'coding_advisor'</span>, new_messages)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="offgo6balkj" class="cell" data-execution_count="8">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="cf">await</span> tui_input_loop(binder(coding_advisor))   <span class="co"># type: ignore[top-level-await]</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdin">
<div class="ansi-escaped-output">
<pre><span class="ansi-green-fg ansi-bold">&gt;  Who are you? (answer briefly)
</span></pre>
</div>
</div>
<div class="cell-output cell-output-stdout">
<div class="ansi-escaped-output">
<pre>I‚Äôm a coding assistant here to help you with programming questions, code problems, and learning best practices. How can I help?
</pre>
</div>
</div>
<div class="cell-output cell-output-stdin">
<div class="ansi-escaped-output">
<pre><span class="ansi-green-fg ansi-bold">&gt;  How do I add numbers in Python? (answer in 1 sentence)
</span></pre>
</div>
</div>
<div class="cell-output cell-output-stdout">
<div class="ansi-escaped-output">
<pre>To add numbers in Python, use the `+` operator, like `result = num1 + num2`.
</pre>
</div>
</div>
<div class="cell-output cell-output-stdin">
<div class="ansi-escaped-output">
<pre><span class="ansi-green-fg ansi-bold">&gt;  exit
</span></pre>
</div>
</div>
<div class="cell-output cell-output-stdout">
<div class="ansi-escaped-output">
<pre></pre>
</div>
</div>
</div>
</section>
<section id="the-information-extractor" class="level3">
<h3 class="anchored" data-anchor-id="the-information-extractor">The Information Extractor</h3>
<p>Let‚Äôs make an agent that does <strong>structured output</strong> to <em>extract</em> information from the user‚Äôs message. In particular, we‚Äôll have this agent classify the user‚Äôs message (i.e.&nbsp;it is ‚Äúextracting‚Äù the classification, if you will).</p>
<div id="cf224901-b74f-49a5-95e2-074c14b6f2ce" class="cell" data-execution_count="9">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>INTENT_CLASSIFIER_SYSTEM_PROMPT <span class="op">=</span> <span class="st">"""</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="st">Your job is to classify the user's message into one of the following categories:</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a><span class="st"> - `small_talk`: Comments like "hi", "how are you?", etc.</span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a><span class="st"> - `programming`: Questions or comments about programming languages, libraries, etc.</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a><span class="st"> - `other`: Any message that is not small talk and not programming.</span></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a><span class="st">"""</span>.strip()</span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a><span class="co"># In a production-grade system, you'd probably expand your system prompt to</span></span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a><span class="co"># be more thorough; we're going for minimal here to keep this demo short.</span></span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> Category(Enum):</span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>    small_talk <span class="op">=</span> <span class="st">'small_talk'</span></span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a>    programming <span class="op">=</span> <span class="st">'programming'</span></span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a>    other <span class="op">=</span> <span class="st">'other'</span></span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> CategoryOutput(BaseModel):</span>
<span id="cb10-17"><a href="#cb10-17" aria-hidden="true" tabindex="-1"></a>    thoughts: <span class="bu">str</span></span>
<span id="cb10-18"><a href="#cb10-18" aria-hidden="true" tabindex="-1"></a>    category: Category</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="94b9bee6-9795-43c4-8375-5b00ae442c2e" class="cell" data-execution_count="10">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="cf">async</span> <span class="kw">def</span> intent_classifier(</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>    model: Model,</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>    event_callback: EventCallback,</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>    prev_runs: <span class="bu">list</span>[AgentRun],</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>) <span class="op">-&gt;</span> AgentRun:</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Get **ONLY** the last message from the conversation so far:</span></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>    <span class="co">#    (Just for demo-purposes, to show you can do whatever you want with</span></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>    <span class="co">#     `prev_runs` üòÅ. A production-grade intent classifier would consider</span></span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>    <span class="co">#     more than just the last message.)</span></span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>    last_message <span class="op">=</span> extract_last_message(prev_runs, from_tools<span class="op">=</span><span class="va">False</span>, from_extraction<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Generate a structured output response with an OVERRIDDEN system prompt!</span></span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a>    messages <span class="op">=</span> override_system_prompt([last_message], INTENT_CLASSIFIER_SYSTEM_PROMPT)</span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a>    new_message, result <span class="op">=</span> <span class="cf">await</span> model.extract(event_callback, messages, CategoryOutput)</span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a>    <span class="cf">assert</span> <span class="bu">isinstance</span>(result, CategoryOutput)</span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-17"><a href="#cb11-17" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Wrap the new messages into an `AgentRun` result:</span></span>
<span id="cb11-18"><a href="#cb11-18" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> extraction(<span class="st">'intent_classifier'</span>, [new_message], result)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="b8843b12-5cb7-4ed3-acef-cbf16ae087f0" class="cell" data-execution_count="11">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="cf">await</span> tui_input_loop(binder(intent_classifier))   <span class="co"># type: ignore[top-level-await]</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdin">
<div class="ansi-escaped-output">
<pre><span class="ansi-green-fg ansi-bold">&gt;  Hi!
</span></pre>
</div>
</div>
<div class="cell-output cell-output-stdout">
<div class="ansi-escaped-output">
<pre><span class="ansi-red-fg">CategoryOutput(</span><span class="ansi-red-fg">{"</span><span class="ansi-red-fg">thought</span><span class="ansi-red-fg">s</span><span class="ansi-red-fg">":"</span><span class="ansi-red-fg">The</span><span class="ansi-red-fg"> user</span><span class="ansi-red-fg"> is</span><span class="ansi-red-fg"> greeting</span><span class="ansi-red-fg"> with</span><span class="ansi-red-fg"> a</span><span class="ansi-red-fg"> simple</span><span class="ansi-red-fg"> '</span><span class="ansi-red-fg">Hi</span><span class="ansi-red-fg">!',</span><span class="ansi-red-fg"> which</span><span class="ansi-red-fg"> is</span><span class="ansi-red-fg"> small</span><span class="ansi-red-fg"> talk</span><span class="ansi-red-fg">.","</span><span class="ansi-red-fg">category</span><span class="ansi-red-fg">":"</span><span class="ansi-red-fg">small</span><span class="ansi-red-fg">_t</span><span class="ansi-red-fg">alk</span><span class="ansi-red-fg">"}</span><span class="ansi-red-fg">)

</span>
</pre>
</div>
</div>
<div class="cell-output cell-output-stdin">
<div class="ansi-escaped-output">
<pre><span class="ansi-green-fg ansi-bold">&gt;  Sup?
</span></pre>
</div>
</div>
<div class="cell-output cell-output-stdout">
<div class="ansi-escaped-output">
<pre><span class="ansi-red-fg">CategoryOutput(</span><span class="ansi-red-fg">{"</span><span class="ansi-red-fg">thought</span><span class="ansi-red-fg">s</span><span class="ansi-red-fg">":"</span><span class="ansi-red-fg">The</span><span class="ansi-red-fg"> message</span><span class="ansi-red-fg"> is</span><span class="ansi-red-fg"> a</span><span class="ansi-red-fg"> casual</span><span class="ansi-red-fg"> greeting</span><span class="ansi-red-fg">.","</span><span class="ansi-red-fg">category</span><span class="ansi-red-fg">":"</span><span class="ansi-red-fg">small</span><span class="ansi-red-fg">_t</span><span class="ansi-red-fg">alk</span><span class="ansi-red-fg">"}</span><span class="ansi-red-fg">)

</span>
</pre>
</div>
</div>
<div class="cell-output cell-output-stdin">
<div class="ansi-escaped-output">
<pre><span class="ansi-green-fg ansi-bold">&gt;  What is Python?
</span></pre>
</div>
</div>
<div class="cell-output cell-output-stdout">
<div class="ansi-escaped-output">
<pre><span class="ansi-red-fg">CategoryOutput(</span><span class="ansi-red-fg">{"</span><span class="ansi-red-fg">thought</span><span class="ansi-red-fg">s</span><span class="ansi-red-fg">":"</span><span class="ansi-red-fg">The</span><span class="ansi-red-fg"> user</span><span class="ansi-red-fg"> is</span><span class="ansi-red-fg"> asking</span><span class="ansi-red-fg"> about</span><span class="ansi-red-fg"> Python</span><span class="ansi-red-fg">,</span><span class="ansi-red-fg"> which</span><span class="ansi-red-fg"> is</span><span class="ansi-red-fg"> a</span><span class="ansi-red-fg"> programming</span><span class="ansi-red-fg"> language</span><span class="ansi-red-fg">.","</span><span class="ansi-red-fg">category</span><span class="ansi-red-fg">":"</span><span class="ansi-red-fg">program</span><span class="ansi-red-fg">ming</span><span class="ansi-red-fg">"}</span><span class="ansi-red-fg">)

</span>
</pre>
</div>
</div>
<div class="cell-output cell-output-stdin">
<div class="ansi-escaped-output">
<pre><span class="ansi-green-fg ansi-bold">&gt;  What is 2+2?
</span></pre>
</div>
</div>
<div class="cell-output cell-output-stdout">
<div class="ansi-escaped-output">
<pre><span class="ansi-red-fg">CategoryOutput(</span><span class="ansi-red-fg">{"</span><span class="ansi-red-fg">thought</span><span class="ansi-red-fg">s</span><span class="ansi-red-fg">":"</span><span class="ansi-red-fg">The</span><span class="ansi-red-fg"> user</span><span class="ansi-red-fg"> is</span><span class="ansi-red-fg"> asking</span><span class="ansi-red-fg"> a</span><span class="ansi-red-fg"> basic</span><span class="ansi-red-fg"> math</span><span class="ansi-red-fg"> question</span><span class="ansi-red-fg">.","</span><span class="ansi-red-fg">category</span><span class="ansi-red-fg">":"</span><span class="ansi-red-fg">other</span><span class="ansi-red-fg">"}</span><span class="ansi-red-fg">)

</span>
</pre>
</div>
</div>
<div class="cell-output cell-output-stdin">
<div class="ansi-escaped-output">
<pre><span class="ansi-green-fg ansi-bold">&gt;  exit
</span></pre>
</div>
</div>
<div class="cell-output cell-output-stdout">
<div class="ansi-escaped-output">
<pre></pre>
</div>
</div>
</div>
</section>
<section id="the-back-on-track-agent" class="level3">
<h3 class="anchored" data-anchor-id="the-back-on-track-agent">The ‚ÄòBack on Track‚Äô Agent</h3>
<p>This agent is pretty useless on its own, but you‚Äôll see soon why we‚Äôre creating it. It just tells the user to get back on track!</p>
<div id="5caf5a42-f514-4b34-80e3-55caa4dac78c" class="cell" data-execution_count="12">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>BACK_ON_TRACK_SYSTEM_PROMPT <span class="op">=</span> <span class="st">"""</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="st">The user's message has been deemed to be off-topic.</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a><span class="st">Please politely tell them that their message is off-topic.</span></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a><span class="st">Do not respond to their question or their request. Just politely</span></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a><span class="st">tell them they are off-topic and need to return to the topic</span></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a><span class="st">at-hand.</span></span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a><span class="st">"""</span>.strip()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="430071f2-60b4-4d0d-a3d1-6e952b46633e" class="cell" data-execution_count="13">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="cf">async</span> <span class="kw">def</span> back_on_track(</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>    model: Model,</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>    event_callback: EventCallback,</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>    prev_runs: <span class="bu">list</span>[AgentRun],</span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>) <span class="op">-&gt;</span> AgentRun:</span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>    last_message <span class="op">=</span> extract_last_message(prev_runs, from_tools<span class="op">=</span><span class="va">False</span>, from_extraction<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>    messages <span class="op">=</span> override_system_prompt(</span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>        [last_message],</span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a>        BACK_ON_TRACK_SYSTEM_PROMPT,</span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> flat_messages(</span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a>        <span class="st">'back_on_track'</span>,</span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a>        <span class="cf">await</span> model.run(event_callback, messages, tools<span class="op">=</span>[]),</span>
<span id="cb14-14"><a href="#cb14-14" aria-hidden="true" tabindex="-1"></a>    )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="8cfa7ba1-ac85-45a1-9952-4d4c96c5183b" class="cell" data-execution_count="14">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="cf">await</span> tui_input_loop(binder(back_on_track))   <span class="co"># type: ignore[top-level-await]</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdin">
<div class="ansi-escaped-output">
<pre><span class="ansi-green-fg ansi-bold">&gt;  Hi!
</span></pre>
</div>
</div>
<div class="cell-output cell-output-stdout">
<div class="ansi-escaped-output">
<pre>Hello! It seems your message is off-topic. Let's return to the topic at hand. How can I assist you with that?
</pre>
</div>
</div>
<div class="cell-output cell-output-stdin">
<div class="ansi-escaped-output">
<pre><span class="ansi-green-fg ansi-bold">&gt;  exit
</span></pre>
</div>
</div>
<div class="cell-output cell-output-stdout">
<div class="ansi-escaped-output">
<pre></pre>
</div>
</div>
</div>
</section>
<section id="the-routing-agent" class="level3">
<h3 class="anchored" data-anchor-id="the-routing-agent">The Routing Agent</h3>
<p>Now, we‚Äôll put all the pieces together by making a <strong>routing agent</strong> that uses <strong>all four</strong> agents above!</p>
<div id="bdb0e673-a73c-477c-8e5b-07f842c34baf" class="cell" data-execution_count="15">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="cf">async</span> <span class="kw">def</span> router(</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>    model: Model,</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>    event_callback: EventCallback,</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>    prev_runs: <span class="bu">list</span>[AgentRun],</span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>) <span class="op">-&gt;</span> AgentRun:</span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Decide which downstream agent to use, based on the user's intent:</span></span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>    bound_intent_classifier <span class="op">=</span> binder(intent_classifier)</span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a>    classification_run <span class="op">=</span> <span class="cf">await</span> bound_intent_classifier(event_callback, prev_runs)</span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">assert</span> classification_run[<span class="st">'type'</span>] <span class="op">==</span> <span class="st">'extraction'</span></span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a>    classification_result <span class="op">=</span> classification_run[<span class="st">'result'</span>]</span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">assert</span> <span class="bu">isinstance</span>(classification_result, CategoryOutput)</span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> classification_result.category <span class="op">==</span> Category.small_talk:</span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true" tabindex="-1"></a>        downstream_agent <span class="op">=</span> binder(chat_agent)</span>
<span id="cb16-14"><a href="#cb16-14" aria-hidden="true" tabindex="-1"></a>    <span class="cf">elif</span> classification_result.category <span class="op">==</span> Category.programming:</span>
<span id="cb16-15"><a href="#cb16-15" aria-hidden="true" tabindex="-1"></a>        downstream_agent <span class="op">=</span> binder(coding_advisor)</span>
<span id="cb16-16"><a href="#cb16-16" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb16-17"><a href="#cb16-17" aria-hidden="true" tabindex="-1"></a>        downstream_agent <span class="op">=</span> binder(back_on_track)</span>
<span id="cb16-18"><a href="#cb16-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-19"><a href="#cb16-19" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Delegate to the downstream agent!</span></span>
<span id="cb16-20"><a href="#cb16-20" aria-hidden="true" tabindex="-1"></a>    downstream_run <span class="op">=</span> <span class="cf">await</span> downstream_agent(event_callback, prev_runs)</span>
<span id="cb16-21"><a href="#cb16-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-22"><a href="#cb16-22" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Wrap *everything* that happened above into the return:</span></span>
<span id="cb16-23"><a href="#cb16-23" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> chained_runs(<span class="st">'router'</span>, [classification_run, downstream_run])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cbd2ba67-1c00-4ce5-be97-b62bdc4db220" class="cell" data-execution_count="16">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="cf">await</span> tui_input_loop(binder(router))   <span class="co"># type: ignore[top-level-await]</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdin">
<div class="ansi-escaped-output">
<pre><span class="ansi-green-fg ansi-bold">&gt;  Hi!
</span></pre>
</div>
</div>
<div class="cell-output cell-output-stdout">
<div class="ansi-escaped-output">
<pre><span class="ansi-red-fg">CategoryOutput(</span><span class="ansi-red-fg">{"</span><span class="ansi-red-fg">thought</span><span class="ansi-red-fg">s</span><span class="ansi-red-fg">":"</span><span class="ansi-red-fg">The</span><span class="ansi-red-fg"> user</span><span class="ansi-red-fg"> just</span><span class="ansi-red-fg"> greeted</span><span class="ansi-red-fg"> me</span><span class="ansi-red-fg">,</span><span class="ansi-red-fg"> which</span><span class="ansi-red-fg"> is</span><span class="ansi-red-fg"> considered</span><span class="ansi-red-fg"> small</span><span class="ansi-red-fg"> talk</span><span class="ansi-red-fg">.","</span><span class="ansi-red-fg">category</span><span class="ansi-red-fg">":"</span><span class="ansi-red-fg">small</span><span class="ansi-red-fg">_t</span><span class="ansi-red-fg">alk</span><span class="ansi-red-fg">"}</span><span class="ansi-red-fg">)

</span>Hello! üòä How can I assist you today?
</pre>
</div>
</div>
<div class="cell-output cell-output-stdin">
<div class="ansi-escaped-output">
<pre><span class="ansi-green-fg ansi-bold">&gt;  What is Python? (answer briefly)
</span></pre>
</div>
</div>
<div class="cell-output cell-output-stdout">
<div class="ansi-escaped-output">
<pre><span class="ansi-red-fg">CategoryOutput(</span><span class="ansi-red-fg">{"</span><span class="ansi-red-fg">thought</span><span class="ansi-red-fg">s</span><span class="ansi-red-fg">":"</span><span class="ansi-red-fg">The</span><span class="ansi-red-fg"> question</span><span class="ansi-red-fg"> is</span><span class="ansi-red-fg"> directly</span><span class="ansi-red-fg"> about</span><span class="ansi-red-fg"> Python</span><span class="ansi-red-fg">,</span><span class="ansi-red-fg"> a</span><span class="ansi-red-fg"> programming</span><span class="ansi-red-fg"> language</span><span class="ansi-red-fg">,</span><span class="ansi-red-fg"> so</span><span class="ansi-red-fg"> it</span><span class="ansi-red-fg"> fits</span><span class="ansi-red-fg"> the</span><span class="ansi-red-fg"> programming</span><span class="ansi-red-fg"> category</span><span class="ansi-red-fg">.","</span><span class="ansi-red-fg">category</span><span class="ansi-red-fg">":"</span><span class="ansi-red-fg">program</span><span class="ansi-red-fg">ming</span><span class="ansi-red-fg">"}</span><span class="ansi-red-fg">)

</span>Python is a high-level, general-purpose programming language known for its simplicity, readability, and versatility. It supports multiple programming paradigms, including procedural, object-oriented, and functional programming. Python is widely used for web development, data science, artificial intelligence, automation, and much more, thanks to its extensive standard library and vibrant ecosystem of third-party packages.
</pre>
</div>
</div>
<div class="cell-output cell-output-stdin">
<div class="ansi-escaped-output">
<pre><span class="ansi-green-fg ansi-bold">&gt;  What is 2+2?
</span></pre>
</div>
</div>
<div class="cell-output cell-output-stdout">
<div class="ansi-escaped-output">
<pre><span class="ansi-red-fg">CategoryOutput(</span><span class="ansi-red-fg">{"</span><span class="ansi-red-fg">thought</span><span class="ansi-red-fg">s</span><span class="ansi-red-fg">":"</span><span class="ansi-red-fg">The</span><span class="ansi-red-fg"> message</span><span class="ansi-red-fg"> is</span><span class="ansi-red-fg"> a</span><span class="ansi-red-fg"> general</span><span class="ansi-red-fg">,</span><span class="ansi-red-fg"> non</span><span class="ansi-red-fg">-program</span><span class="ansi-red-fg">ming</span><span class="ansi-red-fg"> question</span><span class="ansi-red-fg"> related</span><span class="ansi-red-fg"> to</span><span class="ansi-red-fg"> arithmetic</span><span class="ansi-red-fg">.","</span><span class="ansi-red-fg">category</span><span class="ansi-red-fg">":"</span><span class="ansi-red-fg">other</span><span class="ansi-red-fg">"}</span><span class="ansi-red-fg">)

</span>I'm sorry, but your message is off-topic. Please return to the topic at hand.
</pre>
</div>
</div>
<div class="cell-output cell-output-stdin">
<div class="ansi-escaped-output">
<pre><span class="ansi-green-fg ansi-bold">&gt;  How are you today? (also what is 2+2)
</span></pre>
</div>
</div>
<div class="cell-output cell-output-stdout">
<div class="ansi-escaped-output">
<pre><span class="ansi-red-fg">CategoryOutput(</span><span class="ansi-red-fg">{"</span><span class="ansi-red-fg">thought</span><span class="ansi-red-fg">s</span><span class="ansi-red-fg">":"</span><span class="ansi-red-fg">The</span><span class="ansi-red-fg"> message</span><span class="ansi-red-fg"> contains</span><span class="ansi-red-fg"> a</span><span class="ansi-red-fg"> small</span><span class="ansi-red-fg"> talk</span><span class="ansi-red-fg"> element</span><span class="ansi-red-fg"> but</span><span class="ansi-red-fg"> also</span><span class="ansi-red-fg"> includes</span><span class="ansi-red-fg"> a</span><span class="ansi-red-fg"> simple</span><span class="ansi-red-fg"> math</span><span class="ansi-red-fg"> question</span><span class="ansi-red-fg"> which</span><span class="ansi-red-fg"> doesn't</span><span class="ansi-red-fg"> relate</span><span class="ansi-red-fg"> to</span><span class="ansi-red-fg"> programming</span><span class="ansi-red-fg">.","</span><span class="ansi-red-fg">category</span><span class="ansi-red-fg">":"</span><span class="ansi-red-fg">small</span><span class="ansi-red-fg">_t</span><span class="ansi-red-fg">alk</span><span class="ansi-red-fg">"}</span><span class="ansi-red-fg">)

</span>I'm just a program, so I don‚Äôt have feelings, but thank you for asking! üòä As for your question:  

**2 + 2 = 4**! üéâ Let me know if you have more questions!
</pre>
</div>
</div>
<div class="cell-output cell-output-stdin">
<div class="ansi-escaped-output">
<pre><span class="ansi-green-fg ansi-bold">&gt;  exit
</span></pre>
</div>
</div>
<div class="cell-output cell-output-stdout">
<div class="ansi-escaped-output">
<pre></pre>
</div>
</div>
</div>
<div class="callout callout-style-default callout-warning callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
üö® Hacked!
</div>
</div>
<div class="callout-body-container callout-body">
<p>Did you notice above how we prompt-hacked our simple AI system? <strong>YIKES!</strong> (Look closely, we were able to get it to answer our <code>2 + 2</code> question on the second attempt above, by ‚Äúhiding‚Äù the question in a small-talk message.)</p>
<p>This is a good time to call out that AI models can (and will!) make mistakes. Prompt engineering helps, but even the most well-tuned prompting cannot protect your AI system from malicious users.</p>
<p>Design your AI systems accordingly, and consult best-practice literature. The most important thing: Design your AI system so that it does no damage even <em>if</em> (or <em>when</em>) it misbehaves.</p>
</div>
</div>
</section>
<section id="the-task-splitter" class="level3">
<h3 class="anchored" data-anchor-id="the-task-splitter">The Task Splitter</h3>
<p>Another common task is for an agent to split work and delegate to multiple downstream agents. Let‚Äôs do that next!</p>
<p>We‚Äôll use a silly example, for simplicity and brevity, where we‚Äôll split the user‚Äôs message into individual sentences, then prompt an AI <code>model</code> one-at-a-time on each individual sentence. While this is a silly example, it shows how you can split up a problem for multiple downstream subagents.</p>
<div id="f1721848-54a8-4ffd-b9a7-7887b1e13a57" class="cell" data-execution_count="17">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="cf">async</span> <span class="kw">def</span> splitter(</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>    model: Model,</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>    event_callback: EventCallback,</span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>    prev_runs: <span class="bu">list</span>[AgentRun],</span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>) <span class="op">-&gt;</span> AgentRun:</span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>    <span class="co"># We'll only look at the most recent message:</span></span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>    last_message <span class="op">=</span> extract_last_message(prev_runs, from_tools<span class="op">=</span><span class="va">False</span>, from_extraction<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">assert</span> last_message[<span class="st">'role'</span>] <span class="op">==</span> <span class="st">'human'</span></span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">assert</span> last_message[<span class="st">'text'</span>]</span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a>    <span class="co"># We'll split the most recent message into sentences:</span></span>
<span id="cb18-12"><a href="#cb18-12" aria-hidden="true" tabindex="-1"></a>    <span class="co">#    (This is **not** a robust way to do it, but we're keeping the demo simple.)</span></span>
<span id="cb18-13"><a href="#cb18-13" aria-hidden="true" tabindex="-1"></a>    sentences <span class="op">=</span> re.split(<span class="vs">r'</span><span class="pp">[</span><span class="ch">\.\?\!</span><span class="pp">]</span><span class="vs"> '</span>, last_message[<span class="st">'text'</span>])</span>
<span id="cb18-14"><a href="#cb18-14" aria-hidden="true" tabindex="-1"></a>    sentences_as_agentruns <span class="op">=</span> [</span>
<span id="cb18-15"><a href="#cb18-15" aria-hidden="true" tabindex="-1"></a>        flat_messages(<span class="st">'splitter'</span>, [{</span>
<span id="cb18-16"><a href="#cb18-16" aria-hidden="true" tabindex="-1"></a>            <span class="st">'role'</span>: <span class="st">'human'</span>,</span>
<span id="cb18-17"><a href="#cb18-17" aria-hidden="true" tabindex="-1"></a>            <span class="st">'text'</span>: sentence,</span>
<span id="cb18-18"><a href="#cb18-18" aria-hidden="true" tabindex="-1"></a>        }])</span>
<span id="cb18-19"><a href="#cb18-19" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> sentence <span class="kw">in</span> sentences</span>
<span id="cb18-20"><a href="#cb18-20" aria-hidden="true" tabindex="-1"></a>    ]</span>
<span id="cb18-21"><a href="#cb18-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-22"><a href="#cb18-22" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Have the `chat_agent` respond to each sentence:</span></span>
<span id="cb18-23"><a href="#cb18-23" aria-hidden="true" tabindex="-1"></a>    <span class="co">#    (Again, not particularly useful, but good for a brief demo.)</span></span>
<span id="cb18-24"><a href="#cb18-24" aria-hidden="true" tabindex="-1"></a>    bound_chat_agent <span class="op">=</span> binder(chat_agent)</span>
<span id="cb18-25"><a href="#cb18-25" aria-hidden="true" tabindex="-1"></a>    downstream_runs: <span class="bu">list</span>[AgentRun] <span class="op">=</span> []</span>
<span id="cb18-26"><a href="#cb18-26" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> task_input <span class="kw">in</span> sentences_as_agentruns:</span>
<span id="cb18-27"><a href="#cb18-27" aria-hidden="true" tabindex="-1"></a>        this_run <span class="op">=</span> <span class="cf">await</span> bound_chat_agent(event_callback, [task_input])</span>
<span id="cb18-28"><a href="#cb18-28" aria-hidden="true" tabindex="-1"></a>        downstream_runs.append(this_run)</span>
<span id="cb18-29"><a href="#cb18-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-30"><a href="#cb18-30" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Wrap *everything* that happened above into the return:</span></span>
<span id="cb18-31"><a href="#cb18-31" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> parallel_runs(<span class="st">'splitter'</span>, downstream_runs)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="974bc078-75fd-4958-ade4-d46b14cf0ae7" class="cell" data-execution_count="18">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="cf">await</span> tui_input_loop(binder(splitter))   <span class="co"># type: ignore[top-level-await]</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdin">
<div class="ansi-escaped-output">
<pre><span class="ansi-green-fg ansi-bold">&gt;  Hi. What's up? How are you? What's 2+2?
</span></pre>
</div>
</div>
<div class="cell-output cell-output-stdout">
<div class="ansi-escaped-output">
<pre>Hello! How can I assist you today? üòäNot much, just here and ready to help! What's on your mind? üòäI'm just a virtual assistant, so I don't have feelings, but thanks for asking! How can I assist you today?2 + 2 = 4
</pre>
</div>
</div>
<div class="cell-output cell-output-stdin">
<div class="ansi-escaped-output">
<pre><span class="ansi-green-fg ansi-bold">&gt;  Thanks! What did I just say?
</span></pre>
</div>
</div>
<div class="cell-output cell-output-stdout">
<div class="ansi-escaped-output">
<pre>You're welcome! Do you need help with anything? üòäI can't recall or access past interactions in this chat. Could you please repeat or clarify what you said?
</pre>
</div>
</div>
<div class="cell-output cell-output-stdin">
<div class="ansi-escaped-output">
<pre><span class="ansi-green-fg ansi-bold">&gt;  exit
</span></pre>
</div>
</div>
<div class="cell-output cell-output-stdout">
<div class="ansi-escaped-output">
<pre></pre>
</div>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
What happened?
</div>
</div>
<div class="callout-body-container callout-body">
<p>In the conversation above, when I said ‚ÄúWhat did I just say?‚Äù, the AI model didn‚Äôt <em>see</em> the conversation history. Why not? It‚Äôs because of how we wrote our agent ‚Äî we did not pass the whole conversation to the AI model!</p>
<p><strong>Exercise for the reader:</strong> How can you change the agent so that the AI <em>sees</em> the whole conversation history?</p>
</div>
</div>
</section>
<section id="do-anything" class="level3">
<h3 class="anchored" data-anchor-id="do-anything">Do anything!</h3>
<p>It‚Äôs up to you how to write your multi-agent AI system. You can mix-and-match ideas, include lots of behaviors in a <em>single</em> agent, or split up tasks among <em>multiple</em> agents. You can have ‚Äúmeta agents‚Äù that plan work for other agents, or ‚Äúmeta meta agents‚Äù that plan work for your ‚Äúmeta agents‚Äù. As long as it is <em>safe</em> and <em>works</em>, go for it!</p>
</section>
</section>
<section id="why-this-design" class="level2">
<h2 class="anchored" data-anchor-id="why-this-design">Why This Design?</h2>
<p>Lasagna‚Äôs agent design provides several key benefits:</p>
<section id="pluggability" class="level3">
<h3 class="anchored" data-anchor-id="pluggability">üîå <strong>Pluggability</strong></h3>
<p>Every agent follows the same interface, so you can:</p>
<ul>
<li>swap one agent for another,</li>
<li>combine agents from different sources, and</li>
<li>test agents in isolation.</li>
</ul>
</section>
<section id="layering" class="level3">
<h3 class="anchored" data-anchor-id="layering">ü•û <strong>Layering</strong></h3>
<p>You can compose agents at any level:</p>
<ul>
<li>Use simple agents as building blocks.</li>
<li>Combine them into more complex workflows.</li>
<li>Build entire systems from agent compositions.</li>
</ul>
</section>
<section id="reusability" class="level3">
<h3 class="anchored" data-anchor-id="reusability">üîÑ <strong>Reusability</strong></h3>
<p>Write an agent once, use it everywhere:</p>
<ul>
<li>as a standalone agent,</li>
<li>as part of a larger workflow, or</li>
<li>as a specialist in a multi-agent system.</li>
</ul>
</section>
</section>
<section id="next-steps" class="level2">
<h2 class="anchored" data-anchor-id="next-steps">Next Steps</h2>
<p>Now that you understand what agents are and how they work conceptually, you‚Äôre ready to dive deeper into the technical details.</p>
<p>In the <a href="../what_is_an_agent/type_agentrun.html">next section</a>, we‚Äôll explore the <code>AgentRun</code> data structure in detail ‚Äî the standardized format that enables all this agent composition and layering.</p>
<p>You‚Äôll learn about:</p>
<ul>
<li>The four types of <code>AgentRun</code>.</li>
<li>How to work with the recursive data structure.</li>
<li>Helper functions for common patterns.</li>
<li>Advanced features like cost tracking and serialization.</li>
</ul>
<p>For more advanced agent patterns and real-world examples, check out:</p>
<ul>
<li><a href="../agent_features/tools.html">Tool Use</a> ‚Äî Agents that interact with external systems</li>
<li><a href="../agent_features/structured_output.html">Structured Output</a> ‚Äî Agents that extract structured data</li>
<li><a href="../agent_features/layering.html">Layering</a> ‚Äî Complex multi-agent compositions</li>
</ul>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "Óßã";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp("https:\/\/lasagna-ai\.rhobota\.com");
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="../why_lasagna_ai/lasagna_vs_llamaindex.html" class="pagination-link" aria-label="Lasagna vs LlamaIndex">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text">Lasagna vs LlamaIndex</span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="../what_is_an_agent/type_agentrun.html" class="pagination-link" aria-label="The `AgentRun` type">
        <span class="nav-page-text">The <code>AgentRun</code> type</span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
      &nbsp;
    </div>   
    <div class="nav-footer-center">
<p>Copyright ¬© 2025 (<a href="https://github.com/Rhobota/lasagna-ai/blob/main/LICENSE.txt">MIT License</a>)</p>
<div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.dev/Rhobota/lasagna-ai/blob/main/docs/what_is_an_agent/agent.ipynb" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/Rhobota/lasagna-ai/blob/main/docs/what_is_an_agent/agent.ipynb" class="toc-action"><i class="bi empty"></i>View source</a></li><li><a href="https://github.com/Rhobota/lasagna-ai/issues/new" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></div>
    <div class="nav-footer-right">
      &nbsp;
    </div>
  </div>
</footer>




</body></html>